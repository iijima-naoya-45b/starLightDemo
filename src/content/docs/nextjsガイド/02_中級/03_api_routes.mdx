---
title: "Next.jsのAPIルート"
label: "Next.jsのAPIルート"
---

## 🤝 Next.jsのAPIルート

Next.jsのAPIルートは、フロントエンドとバックエンドの機能を一つのプロジェクト内で統合できる強力な機能です。これにより、Express.jsやFastAPIのような別のサーバーを構築することなく、サーバーサイドのロジックを簡単に実装できます。これは、Next.jsが単なるフロントエンドフレームワークではなく、フルスタックフレームワークとして機能する大きな理由の一つです。

### 1. APIルートの作成

APIルートは、`pages/api`（Pages Router）または`app/api`（App Router）ディレクトリ内にファイルを作成することで定義されます。これらのディレクトリ内のファイルは、対応するパスへのAPIエンドポイントになります。

#### Pages Router (`pages/api`)

`pages/api`ディレクトリ内の各ファイルがAPIエンドポイントになります。

##### 例: `/pages/api/hello.ts`

```typescript
// pages/api/hello.ts
import { NextApiRequest, NextApiResponse } from 'next';

export default function handler(req: NextApiRequest, res: NextApiResponse) {
  if (req.method === 'GET') {
    res.status(200).json({ message: 'Hello from API!' });
  } else {
    res.status(405).json({ message: 'Method Not Allowed' });
  }
}
```

- `req`: incoming request object
- `res`: server response object

このコードは、GETリクエストを受け付け、Method Not Allowedエラーを返すシンプルなAPIです。

#### App Router (`app/api`)

App Routerでは、`app/api`ディレクトリ内の各ルートセグメントに`route.ts`ファイルを作成します。これにより、HTTPメソッド（GET, POST, PUTなど）ごとに専用の関数を定義できます。

##### 例: `/app/api/hello/route.ts`

```typescript
// app/api/hello/route.ts
import { NextResponse } from 'next/server';

export async function GET() {
  return NextResponse.json({ message: 'Hello from App Router!' });
}

export async function POST() {
  return NextResponse.json({ message: 'POST request received.' });
}
```

- `NextResponse`: 新しいApp Routerで推奨されるレスポンスオブジェクトで、より柔軟なレスポンス制御が可能です。
- `HTTPメソッド関数`: 各HTTPメソッドに対応する関数をエクスポートすることで、ルーティングが自動的に処理されます。

### 2. APIルートの活用：フルスタック開発の実現

APIルートの真価は、フロントエンドとバックエンドのシームレスな統合にあります。

- **データベースとの連携**: APIルート内でデータベースに接続し、データの取得、更新、削除を行うことができます。これにより、クライアントは直接データベースにアクセスすることなく、安全にデータをやり取りできます。

- **外部APIとの通信**: 外部のAPIを呼び出してデータを取得し、加工してからフロントエンドに渡すことができます。これにより、機密情報（APIキーなど）をクライアント側に公開することなく処理できます。

- **認証ロジックの実装**: ユーザー認証やセッション管理などのサーバーサイドロジックをAPIルート内に実装できます。

このように、Next.jsはAPIルートを提供することで、単一のリポジトリ内でフロントエンドとバックエンドの両方を効率的に管理できるフルスタック開発の環境を構築します。これにより、プロジェクトの複雑さを軽減し、開発スピードを向上させることができます。
