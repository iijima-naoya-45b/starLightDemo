---
title: "フォルダ構成"
label: "フォルダ構成"
---

## 📂 Next.jsのフォルダ構成：状態管理の統合

Next.jsプロジェクトのフォルダ構成は、状態管理ライブラリを導入することでさらに複雑になります。クリーンアーキテクチャの原則と、機能ベースのBulletproof Reactの思想を組み合わせることで、状態管理コードを整理し、保守性とスケーラビリティを維持できます。

### 1. 概念的なレイヤーの分離 🏛️

クリーンアーキテクチャでは、コードを以下の3つのレイヤーに分離します。この階層構造により、外側のレイヤー（UI）は内側のレイヤー（データ）に依存しますが、その逆はありません。

- **UI層（プレゼンテーション）** 🖥️
  - ユーザーインターフェース（UI）の表示と入力処理を担当します。Next.jsでは、`app/`ディレクトリ内のコンポーネントやページがこれに該当します。

- **アプリケーション層（ビジネスロジック）** 🛠️
  - アプリケーション固有の機能やルールを定義します。ユーザー作成や注文処理といった、具体的なビジネスロジックがここに集約されます。

- **データアクセス層（インフラストラクチャ）** 💾
  - データベース、外部API、ファイルシステムなどのデータソースとのやり取りを扱います。この層は、データ永続化の詳細を抽象化します。

### 2. フォルダ構成への適用 📁

これらのレイヤーを具体的なNext.jsのフォルダ構成に落とし込むには、機能ベースのBulletproof Reactの思想が役立ちます。

#### コアディレクトリ

- **`app/`**
  - Next.jsのルーティングとUI層を担います。ここには、ページ (`page.tsx`) や共有レイアウト (`layout.tsx`) など、ユーザーに直接表示されるコードを配置します。ビジネスロジックはここには含めず、シンプルに保ちます。

- **`src/`**
  - プロジェクトの主要なコードを格納する推奨ディレクトリです。この中に、機能や共通コードを分離します。

#### 分離されたレイヤー

- **`src/features/`（アプリケーション層）**
  - アプリケーションの主要な機能（例：auth、user、blog）をフォルダごとに整理します。各機能フォルダ内には、その機能に特化したコンポーネント、フック、API呼び出しなどが含まれます。

```
/src/features/auth/
├── components/
├── hooks/
└── api/
```

- **`src/lib/`（データアクセス層）**
  - データベース接続、外部APIクライアント、認証ライブラリなど、アプリケーション全体で再利用されるインフラストラクチャ関連のコードを配置します。

```
/src/lib/
├── db.ts             // データベース接続
├── auth.ts           // 認証ヘルパー
└── utils.ts          // 汎用ユーティリティ
```

- **`src/components/`（UI層の共有コンポーネント）**
  - アプリケーションの複数の場所で再利用される、汎用的なUIコンポーネント（例：`Button.tsx`、`Modal.tsx`）を配置します。

- **`src/styles/`**
  - グローバルなスタイルやテーマを定義します。

### 3. 状態管理の統合 💾

状態管理コードを導入する際は、そのコードをUIから分離し、アプリケーション層に配置するのがベストプラクティスです。

#### 機能ごとの状態管理

特定の機能に関連する状態は、その機能のディレクトリ内に配置します。

例: `features/cart/` ディレクトリ

```
/src/features/cart/
├── components/
│   └── CartDisplay.tsx
├── store/          // 状態管理コードを配置
│   ├── cartSlice.ts
│   └── cartSelector.ts
└── hooks/
    └── useCart.ts
```

#### グローバルな状態管理

アプリケーション全体で共有される、どの機能にも属さない状態（例：テーマ設定、言語設定）は、`src/store`のようなルートレベルのディレクトリに配置します。

例: `src/store/` ディレクトリ

```
/src/store/
├── theme/
│   └── themeSlice.ts
├── user/
│   └── userSlice.ts
└── index.ts
```

### 4. まとめ：なぜこの構成が優れているのか？ 💡

このアプローチは、以下の点でアプリケーションの品質を向上させます。

- **責務の分離**: UI、ビジネスロジック、状態管理、データアクセスが明確に分離されます。これにより、開発者は関心のあるレイヤーに集中できます。

- **再利用性**: 状態管理のロジックはUIから独立しているため、異なるUIコンポーネントから同じ状態管理ロジックを再利用できます。

- **テストの容易性**: 各レイヤーが独立しているため、UIやデータ層に依存することなく、状態管理ロジックを単独でテストできます。

- **スケーラビリティ**: 新しい機能を追加する際、既存の機能に影響を与えることなく、新しい`features`ディレクトリと関連する状態管理コードを追加できます。

このようなフォルダ構成は、初期のセットアップに少し時間がかかりますが、長期的に見ると、チーム開発や大規模なプロジェクトにおいて、コードの管理と保守を大幅に簡素化します。