---
title: "tRPCã¨ã¯"
label: "tRPCã¨ã¯"
---

## ğŸ”· tRPCã¨ã¯

`tRPC`ã¯ã€TypeScriptãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã®`RPC`ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã™ã€‚ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ã®`å‹å®‰å…¨æ€§`ã‚’æä¾›ã—ã€TypeScriptã®å‹ã‚·ã‚¹ãƒ†ãƒ ã‚’æ´»ç”¨ã—ã¦`API`ã‚’æ§‹ç¯‰ã§ãã¾ã™ã€‚

### ğŸ¯ ãªãœtRPCãŒå¿…è¦ãªã®ã‹

#### âŒ å¾“æ¥ã®APIé–‹ç™ºã®å•é¡Œ

**âŒ å•é¡Œã®ã‚ã‚‹å®Ÿè£…:**

```typescript
// ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: APIã®å‹ãŒä¸æ˜ç¢º
const response = await fetch('/api/users/1');
const user = await response.json();
// å•é¡Œ: userã®å‹ãŒä¸æ˜ç¢ºã€å®Ÿè¡Œæ™‚ã‚¨ãƒ©ãƒ¼ã®ãƒªã‚¹ã‚¯

// ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰: å‹ã®å®šç¾©ãŒé‡è¤‡
interface User {
  id: number;
  name: string;
  email: string;
}

app.get('/api/users/:id', (req, res) => {
  const user: User = getUserById(req.params.id);
  res.json(user);
});
```

**âš ï¸ å½±éŸ¿:**
- âŒ å‹ã®ä¸ä¸€è‡´
- âš ï¸ å®Ÿè¡Œæ™‚ã‚¨ãƒ©ãƒ¼
- ğŸ“‰ é–‹ç™ºåŠ¹ç‡ã®ä½ä¸‹

#### âœ… tRPCã«ã‚ˆã‚‹è§£æ±º

**âœ… æ”¹å–„ã•ã‚ŒãŸå®Ÿè£…:**

```typescript
// ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰: å‹å®‰å…¨ãªAPIå®šç¾©
import { initTRPC } from '@trpc/server';
import { z } from 'zod';

const t = initTRPC.context().create();

export const appRouter = t.router({
  getUser: t.procedure
    .input(z.object({ id: z.number() }))
    .query(({ input }) => {
      return getUserById(input.id);
    }),
  
  createUser: t.procedure
    .input(z.object({
      name: z.string(),
      email: z.string().email(),
    }))
    .mutation(({ input }) => {
      return createUser(input);
    }),
});

export type AppRouter = typeof appRouter;
```

```typescript
// ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: å‹å®‰å…¨ãªAPIå‘¼ã³å‡ºã—
import { createTRPCProxyClient, httpBatchLink } from '@trpc/client';
import type { AppRouter } from './server';

const trpc = createTRPCProxyClient<AppRouter>({
  links: [
    httpBatchLink({
      url: 'http://localhost:3000/trpc',
    }),
  ],
});

// å‹å®‰å…¨ãªAPIå‘¼ã³å‡ºã—
const user = await trpc.getUser.query({ id: 1 });
// userã®å‹ãŒè‡ªå‹•çš„ã«æ¨è«–ã•ã‚Œã‚‹
```

**âœ… ãƒ¡ãƒªãƒƒãƒˆ:**
- âœ… ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ã®`å‹å®‰å…¨æ€§`
- âœ… å‹ã®è‡ªå‹•æ¨è«–
- âœ… å®Ÿè¡Œæ™‚ã‚¨ãƒ©ãƒ¼ã®å‰Šæ¸›
- ğŸ“ˆ é–‹ç™ºåŠ¹ç‡ã®å‘ä¸Š

### ğŸ¯ tRPCã®ç‰¹å¾´

#### âœ… 1. ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ã®å‹å®‰å…¨æ€§

**ğŸ“‹ å®šç¾©:**
ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§å®šç¾©ã—ãŸå‹ãŒã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ã‚‚è‡ªå‹•çš„ã«åˆ©ç”¨ã§ãã¾ã™ã€‚

```typescript
// ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§å®šç¾©
export const appRouter = t.router({
  getUser: t.procedure
    .input(z.object({ id: z.number() }))
    .query(({ input }) => {
      // input.idã¯numberå‹ã¨ã—ã¦æ¨è«–ã•ã‚Œã‚‹
      return getUserById(input.id);
    }),
});

// ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ä½¿ç”¨
const user = await trpc.getUser.query({ id: 1 });
// userã®å‹ãŒè‡ªå‹•çš„ã«æ¨è«–ã•ã‚Œã‚‹
```

**âš ï¸ å‹å®‰å…¨æ€§ã®èª¤è§£:**
TypeScriptã®å‹ã¯å®Ÿè¡Œæ™‚ã«æ¶ˆãˆã¾ã™ã€‚  
ã€Œå‹å®‰å…¨ã ã‹ã‚‰å®‰å¿ƒã€ã¯å¹»æƒ³ã§ã™ã€‚**å®Ÿè¡Œæ™‚ã®é˜²å¾¡ã¯åˆ¥é€”å¿…è¦**ã§ã™ã€‚

**âœ… å®Ÿè¡Œæ™‚ã®é˜²å¾¡ï¼ˆZodã§ã‚µãƒ‹ã‚¿ã‚¤ã‚ºï¼‰:**

```typescript
const createUserSchema = z
  .object({
    name: z.string().min(1),
    email: z.string().email(),
    age: z.number().min(0).max(150),
  })
  .strict()
  .transform((input) => ({
    ...input,
    email: input.email.toLowerCase().trim(),
  }));
```

- **.strict()**: æœªçŸ¥ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’æ’é™¤ã™ã‚‹  
- **.transform()**: å…¥åŠ›ã‚’æ­£è¦åŒ–ã—ã¦ã‚µãƒ‹ã‚¿ã‚¤ã‚ºã™ã‚‹  

ãƒ•ãƒ­ãƒ³ãƒˆã‹ã‚‰ã®`input`ã‚’ç›²ä¿¡ã›ãšã€**ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§å¿…ãšæ•´å½¢**ã—ã¾ã™ã€‚

#### âœ… 2. Zodã«ã‚ˆã‚‹ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

**ğŸ“‹ å®šç¾©:**
`Zod`ã‚¹ã‚­ãƒ¼ãƒã‚’ä½¿ç”¨ã—ã¦ã€å…¥åŠ›ã®`ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³`ã¨å‹å®šç¾©ã‚’åŒæ™‚ã«è¡Œã„ã¾ã™ã€‚

```typescript
import { z } from 'zod';

const createUserSchema = z.object({
  name: z.string().min(1),
  email: z.string().email(),
  age: z.number().min(0).max(150),
});

export const appRouter = t.router({
  createUser: t.procedure
    .input(createUserSchema)
    .mutation(({ input }) => {
      // inputã¯createUserSchemaã®å‹ã¨ã—ã¦æ¨è«–ã•ã‚Œã‚‹
      // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã‚µãƒ‹ã‚¿ã‚¤ã‚ºãŒè‡ªå‹•çš„ã«å®Ÿè¡Œã•ã‚Œã‚‹
      return createUser(input);
    }),
});
```

#### âš ï¸ 2.5 å¯†çµåˆã®ç½ ï¼ˆDTOã‚’æŒŸã‚€ï¼‰

ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®DBã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’**ãã®ã¾ã¾è¿”ã™ã®ã¯æ‚ªæ‰‹**ã§ã™ã€‚  
å†…éƒ¨æ§‹é€ ãŒå¤‰ã‚ã‚‹ãŸã³ã«ãƒ•ãƒ­ãƒ³ãƒˆãŒå£Šã‚Œã¾ã™ã€‚

**âœ… DTOã‚’æŒŸã‚€:**

```typescript
type UserDto = {
  id: number;
  name: string;
  email: string;
};

const toUserDto = (user: UserEntity): UserDto => ({
  id: user.id,
  name: user.name,
  email: user.email,
});

getUser: t.procedure
  .input(z.object({ id: z.number() }))
  .query(async ({ input }) => {
    const user = await getUserById(input.id);
    return toUserDto(user);
  }),
```

`export type AppRouter`ã¯ä¾¿åˆ©ã§ã™ãŒã€**å†…éƒ¨æ§‹é€ ã®éœ²å‡ºã‚’æ­£å½“åŒ–ã—ã¾ã›ã‚“**ã€‚

#### ğŸ“‹ 3. ãƒ—ãƒ­ã‚·ãƒ¼ã‚¸ãƒ£ã®ç¨®é¡

**ğŸ“– Queryï¼ˆèª­ã¿å–ã‚Šï¼‰:**

```typescript
getUser: t.procedure
  .input(z.object({ id: z.number() }))
  .query(({ input }) => {
    return getUserById(input.id);
  }),
```

**âœï¸ Mutationï¼ˆæ›¸ãè¾¼ã¿ï¼‰:**

```typescript
createUser: t.procedure
  .input(z.object({ name: z.string(), email: z.string() }))
  .mutation(({ input }) => {
    return createUser(input);
  }),
```

#### âš ï¸ 3.5 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®ç›²ç‚¹ï¼ˆãƒãƒƒãƒå‡¦ç†ã®å‰¯ä½œç”¨ï¼‰

`httpBatchLink`ã¯é­”æ³•ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚  
1ã¤ã®é‡ã„ã‚¯ã‚¨ãƒªãŒ**å…¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’é…å»¶**ã•ã›ã¾ã™ã€‚

**å¯¾ç­–:**
- é‡ã„å‡¦ç†ã¯ãƒãƒƒãƒå¯¾è±¡ã‹ã‚‰é™¤å¤–ã™ã‚‹  
- `httpBatchLink`ã¨é€šå¸¸ãƒªãƒ³ã‚¯ã‚’**åˆ†é›¢**ã™ã‚‹  
- å„ªå…ˆåº¦ã®é«˜ã„ã‚¯ã‚¨ãƒªã¯**å˜ç‹¬ãƒªãƒ³ã‚¯**ã§å‡¦ç†ã™ã‚‹

### tRPCã®å®Ÿè£…ä¾‹

#### Next.jsã§ã®å®Ÿè£…

**ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆAPI Routeï¼‰:**

```typescript
// pages/api/trpc/[trpc].ts
import { createNextApiHandler } from '@trpc/server/adapters/next';
import { appRouter } from '../../../server/routers/_app';

export default createNextApiHandler({
  router: appRouter,
  createContext: () => ({}),
});
```

**ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰:**

```typescript
// utils/trpc.ts
import { createTRPCNext } from '@trpc/next';
import type { AppRouter } from '../server/routers/_app';

export const trpc = createTRPCNext<AppRouter>({
  config() {
    return {
      url: '/api/trpc',
    };
  },
});

// ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã®ä½¿ç”¨
function UserProfile({ userId }: { userId: number }) {
  const { data: user, isLoading } = trpc.getUser.useQuery({ id: userId });
  
  if (isLoading) {
    return <div>Loading...</div>;
  }
  
  return <div>{user.name}</div>;
}
```

#### ğŸ”¥ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®è§£åƒåº¦ã‚’ä¸Šã’ã‚‹

**TRPCErrorã§æ§‹é€ åŒ–ã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼ã‚’è¿”ã™**ã“ã¨ã§ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ãŒæ©Ÿæ¢°çš„ã«åˆ¤åˆ¥ã§ãã¾ã™ã€‚

```typescript
import { TRPCError } from '@trpc/server';

getUser: t.procedure
  .input(z.object({ id: z.number() }))
  .query(async ({ input }) => {
    const user = await getUserById(input.id);
    if (!user) {
      throw new TRPCError({
        code: 'NOT_FOUND',
        message: `User ${input.id} not found`,
      });
    }
    return user;
  }),
```

**ä½¿ã†ã¹ãã‚³ãƒ¼ãƒ‰ä¾‹:**
- `BAD_REQUEST`: å…¥åŠ›ä¸æ­£  
- `UNAUTHORIZED`: èªè¨¼ä¸è¶³  
- `FORBIDDEN`: æ¨©é™ä¸è¶³  
- `NOT_FOUND`: å­˜åœ¨ã—ãªã„  

#### Expressã§ã®å®Ÿè£…

**ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰:**

```typescript
// server.ts
import express from 'express';
import { createExpressMiddleware } from '@trpc/server/adapters/express';
import { appRouter } from './routers/_app';

const app = express();

app.use(
  '/trpc',
  createExpressMiddleware({
    router: appRouter,
    createContext: () => ({}),
  })
);

app.listen(3000);
```

**ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰:**

```typescript
// client.ts
import { createTRPCProxyClient, httpBatchLink } from '@trpc/client';
import type { AppRouter } from './server/routers/_app';

const trpc = createTRPCProxyClient<AppRouter>({
  links: [
    httpBatchLink({
      url: 'http://localhost:3000/trpc',
    }),
  ],
});

// ä½¿ç”¨
const user = await trpc.getUser.query({ id: 1 });
```

### âš–ï¸ tRPC vs GraphQL vs RESTful API

#### ğŸ“Š æ¯”è¼ƒè¡¨

| é …ç›® | tRPC | GraphQL | RESTful API |
|------|------|---------|-------------|
| `å‹å®‰å…¨æ€§` | ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ | é™å®šçš„ | ãªã— |
| å­¦ç¿’ã‚³ã‚¹ãƒˆ | ä¸­ | é«˜ | ä½ |
| `ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹` | é«˜ã„ | ä¸­ç¨‹åº¦ | ä¸­ç¨‹åº¦ |
| ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ | TypeScriptå¿…é ˆ | è¨€èªéä¾å­˜ | è¨€èªéä¾å­˜ |
| `ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³` | `Zod`çµ±åˆ | ã‚¹ã‚­ãƒ¼ãƒå®šç¾© | æ‰‹å‹• |

#### ğŸ¯ ä½¿ã„åˆ†ã‘

**âœ… tRPCã‚’ä½¿ã†ã¹ãå ´åˆ:**
- ğŸ”· TypeScriptãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ
- âœ… ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ã®`å‹å®‰å…¨æ€§`ãŒå¿…è¦
- ğŸ”„ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¨ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãŒåŒã˜ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹
- ğŸ“ˆ é–‹ç™ºåŠ¹ç‡ã‚’é‡è¦–

**âœ… GraphQLã‚’ä½¿ã†ã¹ãå ´åˆ:**
- ğŸ“Š è¤‡é›‘ãªãƒ‡ãƒ¼ã‚¿å–å¾—ãŒå¿…è¦
- ğŸ”„ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒå¤šæ§˜ãªãƒ‡ãƒ¼ã‚¿ã‚’è¦æ±‚
- ğŸŒ è¨€èªéä¾å­˜ãŒå¿…è¦

**âœ… RESTful APIã‚’ä½¿ã†ã¹ãå ´åˆ:**
- ğŸ“ ã‚·ãƒ³ãƒ—ãƒ«ãª`API`
- ğŸŒ åºƒãã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹å½¢å¼ãŒå¿…è¦
- ğŸŒ è¨€èªéä¾å­˜ãŒå¿…è¦

### ğŸ¯ ã¾ã¨ã‚

`tRPC`ã®ãƒã‚¤ãƒ³ãƒˆï¼š

- âœ… **ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ã®å‹å®‰å…¨æ€§**: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§å‹ã‚’å…±æœ‰
- âœ… **Zodçµ±åˆ**: `ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³`ã¨å‹å®šç¾©ã‚’åŒæ™‚ã«
- ğŸ“ˆ **é–‹ç™ºåŠ¹ç‡**: å‹ã®è‡ªå‹•æ¨è«–ã«ã‚ˆã‚Šé–‹ç™ºåŠ¹ç‡ãŒå‘ä¸Š
- ğŸ”· **TypeScriptãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ**: TypeScriptã®å‹ã‚·ã‚¹ãƒ†ãƒ ã‚’æœ€å¤§é™ã«æ´»ç”¨

é©åˆ‡ã«`tRPC`ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€å‹å®‰å…¨ã§åŠ¹ç‡çš„ãª`API`é–‹ç™ºãŒã§ãã¾ã™ã€‚

