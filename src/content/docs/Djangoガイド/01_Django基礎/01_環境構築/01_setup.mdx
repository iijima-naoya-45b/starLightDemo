---
title: Django環境構築完全ガイド
sidebar:
    label: Djangoの環境構築
---

# Django環境構築完全ガイド

Djangoプロジェクトの環境構築から、実務で使えるベストプラクティスまで詳しく解説します。

## 1. Pythonのインストールとバージョン確認

### Pythonのバージョン要件

Djangoは、Python 3.8以上をサポートしています。最新の安定版を使用することを推奨します。

```bash
# Pythonのバージョン確認
python --version
# または
python3 --version

# 推奨: Python 3.11以上
```

### pyenvを使用したPythonバージョン管理（推奨）

```bash
# pyenvのインストール（macOS）
brew install pyenv

# pyenvのインストール（Linux）
curl https://pyenv.run | bash

# Python 3.11のインストール
pyenv install 3.11.5

# プロジェクトディレクトリでPythonバージョンを設定
pyenv local 3.11.5
```

## 2. 仮想環境の作成と有効化

### 仮想環境とは

仮想環境は、プロジェクトごとに独立したPython環境を作成する仕組みです。これにより、異なるプロジェクトで異なるパッケージバージョンを使用できます。

### 仮想環境の作成

```bash
# プロジェクトディレクトリの作成
mkdir myproject
cd myproject

# 仮想環境の作成
python -m venv venv
```

### 仮想環境の有効化

```bash
# macOS / Linux
source venv/bin/activate

# Windows (コマンドプロンプト)
venv\Scripts\activate

# Windows (PowerShell)
venv\Scripts\Activate.ps1
```

### 仮想環境の無効化

```bash
deactivate
```

## 3. Djangoのインストール

### 基本的なインストール

```bash
# 最新版のインストール
pip install django

# 特定バージョンのインストール
pip install django==4.2.7
```

### requirements.txtの作成

```bash
# requirements.txtの作成
pip freeze > requirements.txt

# 他の環境でのインストール
pip install -r requirements.txt
```

### 実務でのベストプラクティス

```txt
# requirements.txt
Django==4.2.7
djangorestframework==3.14.0
psycopg2-binary==2.9.9
python-decouple==3.8
django-cors-headers==4.3.0
```

### 開発環境と本番環境の分離

```txt
# requirements/base.txt
Django==4.2.7
djangorestframework==3.14.0
psycopg2-binary==2.9.9

# requirements/dev.txt
-r base.txt
django-debug-toolbar==4.2.0
pytest-django==4.7.0
black==23.11.0
flake8==6.1.0

# requirements/prod.txt
-r base.txt
gunicorn==21.2.0
whitenoise==6.6.0
```

## 4. Djangoプロジェクトの作成

### プロジェクトの作成

```bash
# 現在のディレクトリにプロジェクトを作成
django-admin startproject myproject .

# プロジェクト名のディレクトリを作成
django-admin startproject myproject
```

### プロジェクト構造

```
myproject/
├── manage.py
├── myproject/
│   ├── __init__.py
│   ├── settings.py
│   ├── urls.py
│   ├── wsgi.py
│   └── asgi.py
└── venv/
```

### アプリケーションの作成

```bash
# アプリケーションの作成
python manage.py startapp myapp
```

### アプリケーションの登録

```python
# settings.py
INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'myapp',  # 作成したアプリケーションを追加
]
```

## 5. データベースの設定

### SQLite（開発環境）

```python
# settings.py
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': BASE_DIR / 'db.sqlite3',
    }
}
```

### PostgreSQL（本番環境）

```bash
# PostgreSQLのインストール
# macOS
brew install postgresql

# Ubuntu
sudo apt-get install postgresql postgresql-contrib

# psycopg2のインストール
pip install psycopg2-binary
```

```python
# settings.py
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': 'mydb',
        'USER': 'myuser',
        'PASSWORD': 'mypassword',
        'HOST': 'localhost',
        'PORT': '5432',
    }
}
```

### 環境変数の使用（推奨）

```bash
# .envファイルの作成
pip install python-decouple
```

```python
# settings.py
from decouple import config

DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': config('DB_NAME'),
        'USER': config('DB_USER'),
        'PASSWORD': config('DB_PASSWORD'),
        'HOST': config('DB_HOST', default='localhost'),
        'PORT': config('DB_PORT', default='5432'),
    }
}
```

```env
# .env
DB_NAME=mydb
DB_USER=myuser
DB_PASSWORD=mypassword
DB_HOST=localhost
DB_PORT=5432
```

## 6. マイグレーションの実行

```bash
# マイグレーションファイルの作成
python manage.py makemigrations

# マイグレーションの適用
python manage.py migrate

# マイグレーションの状態確認
python manage.py showmigrations
```

## 7. スーパーユーザーの作成

```bash
# スーパーユーザーの作成
python manage.py createsuperuser

# 対話形式で以下を入力:
# Username: admin
# Email address: admin@example.com
# Password: ********
# Password (again): ********
```

## 8. 開発用サーバーの起動

```bash
# デフォルトポート（8000）で起動
python manage.py runserver

# カスタムポートで起動
python manage.py runserver 8080

# すべてのIPアドレスからアクセス可能にする
python manage.py runserver 0.0.0.0:8000
```

## 9. 実務でのベストプラクティス

### プロジェクト構造（推奨）

```
myproject/
├── manage.py
├── requirements/
│   ├── base.txt
│   ├── dev.txt
│   └── prod.txt
├── .env
├── .gitignore
├── myproject/
│   ├── __init__.py
│   ├── settings/
│   │   ├── __init__.py
│   │   ├── base.py
│   │   ├── development.py
│   │   └── production.py
│   ├── urls.py
│   ├── wsgi.py
│   └── asgi.py
├── apps/
│   ├── accounts/
│   ├── blog/
│   └── api/
└── static/
└── media/
```

### 設定ファイルの分割

```python
# settings/base.py
import os
from pathlib import Path
from decouple import config

BASE_DIR = Path(__file__).resolve().parent.parent.parent

SECRET_KEY = config('SECRET_KEY')
DEBUG = config('DEBUG', default=False, cast=bool)

INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
]

MIDDLEWARE = [
    'django.middleware.security.SecurityMiddleware',
    'django.contrib.sessions.middleware.SessionMiddleware',
    'django.middleware.common.CommonMiddleware',
    'django.middleware.csrf.CsrfViewMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
]

ROOT_URLCONF = 'myproject.urls'

WSGI_APPLICATION = 'myproject.wsgi.application'

# データベース設定
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': config('DB_NAME'),
        'USER': config('DB_USER'),
        'PASSWORD': config('DB_PASSWORD'),
        'HOST': config('DB_HOST', default='localhost'),
        'PORT': config('DB_PORT', default='5432'),
    }
}

# 国際化設定
LANGUAGE_CODE = 'ja'
TIME_ZONE = 'Asia/Tokyo'
USE_I18N = True
USE_TZ = True

# 静的ファイル設定
STATIC_URL = '/static/'
STATIC_ROOT = BASE_DIR / 'staticfiles'

MEDIA_URL = '/media/'
MEDIA_ROOT = BASE_DIR / 'media'

# デフォルトの主キーフィールド
DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'
```

```python
# settings/development.py
from .base import *

DEBUG = True

INSTALLED_APPS += [
    'debug_toolbar',
]

MIDDLEWARE += [
    'debug_toolbar.middleware.DebugToolbarMiddleware',
]

# 開発環境用のデータベース設定
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': BASE_DIR / 'db.sqlite3',
    }
}

# デバッグツールバーの設定
INTERNAL_IPS = ['127.0.0.1']
```

```python
# settings/production.py
from .base import *

DEBUG = False

ALLOWED_HOSTS = config('ALLOWED_HOSTS', cast=lambda v: [s.strip() for s in v.split(',')])

# セキュリティ設定
SECURE_SSL_REDIRECT = True
SESSION_COOKIE_SECURE = True
CSRF_COOKIE_SECURE = True
SECURE_BROWSER_XSS_FILTER = True
SECURE_CONTENT_TYPE_NOSNIFF = True

# 静的ファイルの配信（WhiteNoise）
STATICFILES_STORAGE = 'whitenoise.storage.CompressedManifestStaticFilesStorage'
```

### .gitignoreの設定

```gitignore
# .gitignore
# Python
__pycache__/
*.py[cod]
*$py.class
*.so
.Python
venv/
env/
ENV/

# Django
*.log
local_settings.py
db.sqlite3
db.sqlite3-journal
/media
/staticfiles

# 環境変数
.env
.env.local

# IDE
.vscode/
.idea/
*.swp
*.swo

# OS
.DS_Store
Thumbs.db
```

## 10. よくある問題と解決策

### 問題1: 仮想環境が認識されない

**原因:**
- 仮想環境が有効化されていない
- パスが正しく設定されていない

**解決策:**
```bash
# 仮想環境の再作成
rm -rf venv
python -m venv venv
source venv/bin/activate  # macOS/Linux
# または
venv\Scripts\activate  # Windows
```

### 問題2: マイグレーションエラー

**原因:**
- データベースが正しく設定されていない
- マイグレーションファイルに問題がある

**解決策:**
```bash
# マイグレーションの状態確認
python manage.py showmigrations

# 特定のアプリのマイグレーションをリセット（開発環境のみ）
python manage.py migrate myapp zero
python manage.py makemigrations myapp
python manage.py migrate myapp
```

これで、Djangoの環境構築の基礎知識と実務での使い方を理解できるようになりました。