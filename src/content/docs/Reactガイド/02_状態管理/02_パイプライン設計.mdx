---
title: "ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³è¨­è¨ˆ"
label: "ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³è¨­è¨ˆ"
---

## ğŸ”„ ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³è¨­è¨ˆï¼šReactã§ã®å®Ÿè£…

ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³è¨­è¨ˆã®è©³ç´°ã«ã¤ã„ã¦ã¯ã€[è¨­è¨ˆã‚¬ã‚¤ãƒ‰ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³è¨­è¨ˆ](../../../è¨­è¨ˆã‚¬ã‚¤ãƒ‰/02_apiè¨­è¨ˆ/04_ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³è¨­è¨ˆ)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€Reactç‰¹æœ‰ã®å®Ÿè£…ä¾‹ã‚’ä¸­å¿ƒã«èª¬æ˜ã—ã¾ã™ã€‚

### Reactã§ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³è¨­è¨ˆã®å®Ÿè£…

Reactã§ã¯ã€`useEffect`ã¨`useState`ã‚’æ´»ç”¨ã—ã¦ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³è¨­è¨ˆã‚’å®Ÿè£…ã§ãã¾ã™ã€‚

---

## Reactã§ã®å®Ÿè£…ä¾‹

### Schemaå±¤ã€DTOå±¤ã€Formå±¤ã®å®Ÿè£…

å„å±¤ã®è©³ç´°ãªå®Ÿè£…ã«ã¤ã„ã¦ã¯ã€[è¨­è¨ˆã‚¬ã‚¤ãƒ‰ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³è¨­è¨ˆ](../../../è¨­è¨ˆã‚¬ã‚¤ãƒ‰/02_apiè¨­è¨ˆ/04_ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³è¨­è¨ˆ)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### Pageå±¤: å¸ä»¤å¡”ã¨ã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã€Formã¸é…åˆ†

**å½¹å‰²**: ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã€é©åˆ‡ãªå±¤ã‚’çµŒç”±ã—ã¦ãƒ•ã‚©ãƒ¼ãƒ ã«æ¸¡ã™ã€‚

### æ±ç”¨çš„ãªå®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ï¼‰

```typescript
// hooks/useFormData.ts
import { useEffect, useState } from 'react';

/**
 * æ±ç”¨çš„ãªãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ•ãƒƒã‚¯ï¼ˆã‚¸ã‚§ãƒãƒªã‚¯ã‚¹ï¼‰
 * @param fetchFn - APIã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹é–¢æ•°
 * @param apiToDto - APIå‹ã‚’DTOå‹ã«å¤‰æ›ã™ã‚‹é–¢æ•°
 * @param dtoToForm - DTOå‹ã‚’ãƒ•ã‚©ãƒ¼ãƒ å‹ã«å¤‰æ›ã™ã‚‹é–¢æ•°
 * @param params - fetchFnã«æ¸¡ã™ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
 * @returns ãƒ•ã‚©ãƒ¼ãƒ åˆæœŸå€¤ã€ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã€ã‚¨ãƒ©ãƒ¼çŠ¶æ…‹
 */
export function useFormData<TApi, TDto, TForm, TParams>(
  fetchFn: (params: TParams) => Promise<TApi>,
  apiToDto: (api: TApi) => TDto,
  dtoToForm: (dto: TDto) => TForm,
  params: TParams
) {
  const [formInitialValues, setFormInitialValues] = useState<TForm | null>(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<Error | null>(null);

  useEffect(() => {
    async function loadData() {
      try {
        setLoading(true);
        setError(null);

        // 1. APIå±¤: unknown -> Strict Schema
        const apiData = await fetchFn(params);

        // 2. DTOå±¤: APIå‹ -> UIå‹
        const dto = apiToDto(apiData);

        // 3. Formå±¤: DTOå‹ -> Formå‹
        const initialValues = dtoToForm(dto);
        setFormInitialValues(initialValues);
      } catch (err) {
        const error = err instanceof Error ? err : new Error('Failed to load data');
        setError(error);
        console.error('Failed to load data:', {
          functionName: 'useFormData',
          error: error,
          params: params,
        });
      } finally {
        setLoading(false);
      }
    }

    loadData();
  }, [fetchFn, apiToDto, dtoToForm, params]);

  return { formInitialValues, loading, error };
}
```

### å®Ÿè£…ä¾‹ï¼ˆUserå‹ã‚’ä½¿ç”¨ã—ãŸå…·ä½“ä¾‹ï¼‰

```typescript
// components/UserEditPage.tsx
'use client';

import { fetchUser } from '@/api/schema/userSchema';
import { userApiToDto } from '@/types/user';
import { userDtoToFormInput, type UserFormInput } from '@/components/UserForm/schema';
import UserForm from '@/components/UserForm/UserForm';
import { useFormData } from '@/hooks/useFormData';
import { updateUser } from '@/lib/api/userApi';

type UserEditPageProps = {
  userId: number;
};

export default function UserEditPage({ userId }: UserEditPageProps) {
  const { formInitialValues, loading, error } = useFormData(
    fetchUser,
    userApiToDto,
    userDtoToFormInput,
    userId
  );

  if (loading) return <div>èª­ã¿è¾¼ã¿ä¸­...</div>;
  if (error) return <div>ã‚¨ãƒ©ãƒ¼: {error.message}</div>;
  if (!formInitialValues) return <div>ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</div>;

  return (
    <div>
      <h1>ãƒ¦ãƒ¼ã‚¶ãƒ¼ç·¨é›†</h1>
      <UserForm
        initialValues={formInitialValues}
        userId={userId}
        onSubmit={updateUser}
      />
    </div>
  );
}
```

### ä»–ã®å‹ã§ã®ä½¿ç”¨ä¾‹ï¼ˆProductå‹ï¼‰

```typescript
// components/ProductEditPage.tsx
'use client';

import { fetchProduct } from '@/api/schema/productSchema';
import { productApiToDto } from '@/types/product';
import { productDtoToFormInput, type ProductFormInput } from '@/components/ProductForm/schema';
import ProductForm from '@/components/ProductForm/ProductForm';
import { useFormData } from '@/hooks/useFormData';
import { updateProduct } from '@/lib/api/productApi';

type ProductEditPageProps = {
  productId: number;
};

export default function ProductEditPage({ productId }: ProductEditPageProps) {
  const { formInitialValues, loading, error } = useFormData(
    fetchProduct,
    productApiToDto,
    productDtoToFormInput,
    productId
  );

  if (loading) return <div>èª­ã¿è¾¼ã¿ä¸­...</div>;
  if (error) return <div>ã‚¨ãƒ©ãƒ¼: {error.message}</div>;
  if (!formInitialValues) return <div>å•†å“ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</div>;

  return (
    <div>
      <h1>å•†å“ç·¨é›†</h1>
      <ProductForm
        initialValues={formInitialValues}
        productId={productId}
        onSubmit={updateProduct}
      />
    </div>
  );
}
```

### APIå‘¼ã³å‡ºã—é–¢æ•°ã§ã®å®Ÿè£…ï¼ˆæ±ç”¨é–¢æ•°ã‚’ä½¿ç”¨ï¼‰

```typescript
// lib/api/userApi.ts
import { updateAction } from '@/utils/actionUtils';
import { userFormInputToApiRequest } from '@/components/UserForm/schema';
import { createUserApiSchema } from '@/components/UserForm/schema';
import { userApiSchema } from '@/api/schema/userSchema';
import type { UserFormInput } from '@/components/UserForm/schema';
import type { UserApiResponse } from '@/api/schema/userSchema';

// æ±ç”¨é–¢æ•°ã‚’ä½¿ç”¨ã—ãŸæ›´æ–°é–¢æ•°
export async function updateUser(
  userId: number,
  formData: UserFormInput
): Promise<UserApiResponse> {
  return updateAction(
    `https://api.example.com/users/${userId}`,
    formData,
    userFormInputToApiRequest,
    createUserApiSchema,
    userApiSchema,
    'PUT'
  );
}
```

### ä»–ã®å‹ã§ã®ä½¿ç”¨ä¾‹ï¼ˆProductå‹ï¼‰

```typescript
// lib/api/productApi.ts
import { createAction, updateAction } from '@/utils/actionUtils';
import { productFormInputToApiRequest } from '@/components/ProductForm/schema';
import { createProductApiSchema } from '@/components/ProductForm/schema';
import { productApiSchema } from '@/api/schema/productSchema';
import type { ProductFormInput } from '@/components/ProductForm/schema';
import type { ProductApiResponse } from '@/api/schema/productSchema';

// å•†å“ä½œæˆé–¢æ•°
export async function createProduct(
  formData: ProductFormInput
): Promise<ProductApiResponse> {
  return createAction(
    'https://api.example.com/products',
    formData,
    productFormInputToApiRequest,
    createProductApiSchema,
    productApiSchema
  );
}

// å•†å“æ›´æ–°é–¢æ•°
export async function updateProduct(
  productId: number,
  formData: ProductFormInput
): Promise<ProductApiResponse> {
  return updateAction(
    `https://api.example.com/products/${productId}`,
    formData,
    productFormInputToApiRequest,
    createProductApiSchema,
    productApiSchema,
    'PUT'
  );
}
```

### React Hook Formã§ã®å®Ÿè£…

```typescript
// components/UserForm/UserForm.tsx
'use client';

import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import {
  userFormSchema,
  type UserFormInput,
  userFormInputToApiRequest,
} from './schema';
import { updateUser } from '@/lib/api/userApi';

type UserFormProps = {
  initialValues: UserFormInput;
  userId: number;
  onSubmit: (userId: number, data: UserFormInput) => Promise<void>;
};

export default function UserForm({
  initialValues,
  userId,
  onSubmit,
}: UserFormProps) {
  const {
    register,
    handleSubmit,
    formState: { errors, isSubmitting },
  } = useForm<UserFormInput>({
    resolver: zodResolver(userFormSchema), // Zodã§ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    defaultValues: initialValues,
  });

  const onSubmitHandler = async (data: UserFormInput) => {
    await onSubmit(userId, data);
  };

  return (
    <form onSubmit={handleSubmit(onSubmitHandler)}>
      <div>
        <label htmlFor="firstName">åå‰</label>
        <input
          id="firstName"
          {...register('firstName')}
          aria-invalid={errors.firstName ? 'true' : 'false'}
        />
        {errors.firstName && (
          <span role="alert" className="error">
            {errors.firstName.message}
          </span>
        )}
      </div>

      <div>
        <label htmlFor="lastName">å§“</label>
        <input
          id="lastName"
          {...register('lastName')}
          aria-invalid={errors.lastName ? 'true' : 'false'}
        />
        {errors.lastName && (
          <span role="alert" className="error">
            {errors.lastName.message}
          </span>
        )}
      </div>

      <div>
        <label htmlFor="email">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
        <input
          id="email"
          type="email"
          {...register('email')}
          aria-invalid={errors.email ? 'true' : 'false'}
        />
        {errors.email && (
          <span role="alert" className="error">
            {errors.email.message}
          </span>
        )}
      </div>

      <button type="submit" disabled={isSubmitting}>
        {isSubmitting ? 'é€ä¿¡ä¸­...' : 'é€ä¿¡'}
      </button>
    </form>
  );
}
```

### React Queryã‚’ä½¿ã£ãŸå®Ÿè£…ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒãƒ³ã‚°ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã®å®Ÿè£…ä¾‹ï¼š

```typescript
// components/UserEditPageWithQuery.tsx
'use client';

import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { fetchUser } from '@/api/schema/userSchema';
import { userApiToDto } from '@/types/user';
import { userDtoToFormInput } from '@/components/UserForm/schema';
import UserForm from '@/components/UserForm/UserForm';
import { updateUser } from '@/lib/api/userApi';

type UserEditPageProps = {
  userId: number;
};

export default function UserEditPageWithQuery({ userId }: UserEditPageProps) {
  const queryClient = useQueryClient();

  // ãƒ‡ãƒ¼ã‚¿å–å¾—
  const { data: apiUser, isLoading, error } = useQuery({
    queryKey: ['user', userId],
    queryFn: () => fetchUser(userId),
  });

  // ãƒ‡ãƒ¼ã‚¿æ›´æ–°
  const mutation = useMutation({
    mutationFn: (formData: UserFormInput) => updateUser(userId, formData),
    onSuccess: () => {
      // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ç„¡åŠ¹åŒ–ã—ã¦å†å–å¾—
      queryClient.invalidateQueries({ queryKey: ['user', userId] });
    },
  });

  if (isLoading) return <div>èª­ã¿è¾¼ã¿ä¸­...</div>;
  if (error) return <div>ã‚¨ãƒ©ãƒ¼: {error.message}</div>;
  if (!apiUser) return <div>ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</div>;

  // 1. DTOå±¤: APIå‹ -> UIå‹
  const user = userApiToDto(apiUser);

  // 2. Formå±¤: DTOå‹ -> Formå‹
  const formInitialValues = userDtoToFormInput(user);

  return (
    <div>
      <h1>ãƒ¦ãƒ¼ã‚¶ãƒ¼ç·¨é›†</h1>
      <UserForm
        initialValues={formInitialValues}
        userId={userId}
        onSubmit={mutation.mutateAsync}
      />
      {mutation.isError && (
        <div className="error">
          ã‚¨ãƒ©ãƒ¼: {mutation.error instanceof Error ? mutation.error.message : 'äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼'}
        </div>
      )}
      {mutation.isSuccess && (
        <div className="success">ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’æ›´æ–°ã—ã¾ã—ãŸ</div>
      )}
    </div>
  );
}
```

---

## ğŸ ã¾ã¨ã‚

ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³è¨­è¨ˆã®è©³ç´°ãªèª¬æ˜ã€ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ã®å…¨ä½“åƒã€å„å±¤ã®è²¬å‹™ã€ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã«ã¤ã„ã¦ã¯ã€[è¨­è¨ˆã‚¬ã‚¤ãƒ‰ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³è¨­è¨ˆ](../../../è¨­è¨ˆã‚¬ã‚¤ãƒ‰/02_apiè¨­è¨ˆ/04_ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³è¨­è¨ˆ)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### Reactã§ã®ãƒã‚¤ãƒ³ãƒˆ

1. **useEffectã¨useStateã®æ´»ç”¨**: ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã§ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã€å‹å¤‰æ›ã‚’è¡Œã†
2. **React Hook Formã®æ´»ç”¨**: ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã¨çŠ¶æ…‹ç®¡ç†ã‚’React Hook Formã§å‡¦ç†
3. **React Queryã®æ´»ç”¨ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰**: ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒãƒ³ã‚°ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°ã‚„ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’ç°¡æ½”ã«å®Ÿè£…ã§ãã‚‹
4. **ã€Œé€†æ–¹å‘ã€ã®æ´—æµ„**: APIã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’ã‚‚ã‚‰ã†æ™‚ã¯`zod.parse`ã—ã¦ã„ã¾ã™ãŒã€**APIã«ãƒ‡ãƒ¼ã‚¿ã‚’é€ã‚‹ç›´å‰ã«ã‚‚`zod.parse`ã§æ´—æµ„**ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€DTOã‹ã‚‰ãƒ•ã‚©ãƒ¼ãƒ ã«å¤‰æ›ã—ãŸéš›ã®ã‚´ãƒŸãƒ‡ãƒ¼ã‚¿ãŒAPIã«é£›ã¶ã®ã‚’é˜²ã’ã¾ã™ã€‚ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¯ä¸Šä½å±¤ï¼ˆErrorBoundaryã€Actionã®å…±é€šã‚­ãƒ£ãƒƒãƒæ©Ÿæ§‹ï¼‰ã§å‡¦ç†ã—ã¾ã™ã€‚
5. **MSWã¨ã®é€£æº**: é–‹ç™ºç’°å¢ƒã§ã¯[MSWï¼ˆãƒ¢ãƒƒã‚¯ã‚µãƒ¼ãƒ“ã‚¹ãƒ¯ãƒ¼ã‚«ãƒ¼ï¼‰](../../../è¨­è¨ˆã‚¬ã‚¤ãƒ‰/02_apiè¨­è¨ˆ/05_msw_ãƒ¢ãƒƒã‚¯ã‚µãƒ¼ãƒ“ã‚¹ãƒ¯ãƒ¼ã‚«ãƒ¼)ã‚’ä½¿ç”¨ã—ã¦APIã‚’ãƒ¢ãƒƒã‚¯

ã“ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³è¨­è¨ˆã‚’å®ˆã‚‹ã“ã¨ã§ã€APIã¨UIã®è²¬å‹™ãŒæ˜ç¢ºã«åˆ†é›¢ã•ã‚Œã€ä¿å®ˆæ€§ã®é«˜ã„Reactã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ§‹ç¯‰ã§ãã¾ã™ã€‚
