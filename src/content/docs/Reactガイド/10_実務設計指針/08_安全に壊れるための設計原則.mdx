---
title: "å®‰å…¨ã«å£Šã‚Œã‚‹ãŸã‚ã®è¨­è¨ˆåŸå‰‡"
label: "å®‰å…¨ã«å£Šã‚Œã‚‹ãŸã‚ã®è¨­è¨ˆåŸå‰‡"
---

## å®‰å…¨ã«å£Šã‚Œã‚‹ãŸã‚ã®è¨­è¨ˆåŸå‰‡

ã€Œæ­£å¸¸ã«å‹•ãã€ã‚ˆã‚Šã‚‚ã€Œç•°å¸¸æ™‚ã«å®‰å…¨ã«å£Šã‚Œã‚‹ã€ã“ã¨ã‚’å„ªå…ˆã™ã‚‹è¨­è¨ˆåŸå‰‡ã‚’è©³ã—ãè§£èª¬ã—ã¾ã™ã€‚

> **ğŸ“š Error Boundaryã®è©³ç´°**: ã€Œå®‰å…¨ã«å£Šã‚Œã‚‹ã€ãŸã‚ã«ã¯ã€Error BoundaryãŒä¸å¯æ¬ ã§ã™ã€‚è©³ç´°ã«ã¤ã„ã¦ã¯ã€[ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã®Error Boundary](/Reactã‚¬ã‚¤ãƒ‰/03_ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹/01_ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–#ã‚¨ãƒ©ãƒ¼å¢ƒç•Œerror-boundary-lazyã§ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã®å‡¦ç†)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### å¢ƒç•Œé˜²å¾¡ (Boundary Defense)

å¤–éƒ¨(APIãƒ»DOMãƒ»ãƒ¦ãƒ¼ã‚¶å…¥åŠ›)ã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿ã¯å¸¸ã«æ±šæŸ“ã•ã‚Œã¦ã„ã‚‹ã¨ä»®å®šã—ã€å‹ãƒ»å½¢å¼ãƒ»ç¯„å›²ã‚’æ¤œæŸ»ã—ã¦ã‹ã‚‰ãƒ­ã‚¸ãƒƒã‚¯ã«æ¸¡ã™ã€‚

> **ã€ã¾ã•ã‹ã‚Šã€‘ã‚¹ã‚­ãƒ¼ãƒé§†å‹•ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**: Vanilla JSã®ã‚ˆã†ãªæ‰‹å‹•ãƒã‚§ãƒƒã‚¯ã‚’ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã«æ›¸ãã®ã¯éåŠ¹ç‡ã§ã™ã€‚ç¾ä»£ã®Reacté–‹ç™ºã§ã¯**ã€Œã‚¹ã‚­ãƒ¼ãƒé§†å‹•ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã€**ãŒæ¨™æº–ã§ã™ã€‚Zodã‚„Valibotã®ã‚ˆã†ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã„ã€**ã€Œå‹å®šç¾©ã¨ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä¸€ä½“åŒ–ã€**ã•ã›ã‚‹ã¹ãã§ã™ã€‚

#### å®Ÿè£…ä¾‹

```typescript
// âŒ æ‚ªã„ä¾‹: ç„¡é˜²å‚™ãªå…¥åŠ›å—ä»˜
function Component({ data }: { data: any }) {
  // å•é¡Œ: å‹ãƒã‚§ãƒƒã‚¯ãªã—ã€ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãªã—
  return <div>{data.value + data.amount}</div>;
}

// âŒ åŠ›æŠ€ã™ãã‚‹ä¾‹: æ‰‹å‹•ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆä¿å®ˆä¸èƒ½ï¼‰
interface ComponentProps {
  data: {
    value: number;
    amount: number;
  };
}

function validateProps(props: unknown): ComponentProps {
  if (typeof props !== 'object' || props === null) {
    throw new Error('Invalid props');
  }
  
  const obj = props as Record<string, unknown>;
  
  if (typeof obj.data !== 'object' || obj.data === null) {
    throw new Error('Invalid data');
  }
  
  const data = obj.data as Record<string, unknown>;
  
  if (typeof data.value !== 'number' || typeof data.amount !== 'number') {
    throw new Error('Invalid data types');
  }
  
  return {
    data: {
      value: data.value,
      amount: data.amount,
    },
  };
}

function Component(props: unknown) {
  const validated = validateProps(props);
  return <div>{validated.data.value + validated.data.amount}</div>;
}
```

**å•é¡Œç‚¹:**
- æ‰‹å‹•ãƒã‚§ãƒƒã‚¯ãŒç…©é›‘ã§ä¿å®ˆä¸èƒ½
- å‹å®šç¾©ã¨ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãŒåˆ†é›¢ã—ã¦ã„ã‚‹
- ã‚¹ã‚­ãƒ¼ãƒãŒå¢—ãˆã‚‹ãŸã³ã«ã‚³ãƒ¼ãƒ‰ãŒè‚¥å¤§åŒ–ã™ã‚‹

**âœ… å®Ÿå‹™çš„ãªå¢ƒç•Œé˜²å¾¡: ã‚¹ã‚­ãƒ¼ãƒé§†å‹•ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆZodï¼‰**

```tsx
import { z } from 'zod';

// ã‚¹ã‚­ãƒ¼ãƒå®šç¾©: å‹å®šç¾©ã¨ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãŒä¸€ä½“åŒ–
const DataSchema = z.object({
  value: z.number(),
  amount: z.number().positive(), // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ«ã‚‚å®šç¾©
});

type Data = z.infer<typeof DataSchema>;

function Component({ rawData }: { rawData: unknown }) {
  // ãƒ‘ãƒ¼ã‚¹ã«å¤±æ•—ã—ãŸã‚‰ã€Œå®‰å…¨ã«å£Šã‚Œã‚‹ï¼ˆError Boundaryã¸æŠ•ã’ã‚‹ï¼‰ã€
  const data = DataSchema.parse(rawData);
  
  return <div>{data.value + data.amount}</div>;
}
```

**åˆ©ç‚¹:**
- **å‹å®šç¾©ã¨ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®ä¸€ä½“åŒ–**: ã‚¹ã‚­ãƒ¼ãƒã‚’å®šç¾©ã™ã‚‹ã ã‘ã§ã€å‹ã¨ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãŒè‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹
- **ä¿å®ˆæ€§**: ã‚¹ã‚­ãƒ¼ãƒãŒå¢—ãˆã¦ã‚‚ã‚³ãƒ¼ãƒ‰ãŒã‚·ãƒ³ãƒ—ãƒ«
- **ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**: è©³ç´°ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹
- **å†åˆ©ç”¨æ€§**: ã‚¹ã‚­ãƒ¼ãƒã¯è¤‡æ•°ã®å ´æ‰€ã§å†åˆ©ç”¨å¯èƒ½

**å®Ÿè·µä¾‹: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¨Error Boundary**

```tsx
import { z } from 'zod';
import { ErrorBoundary } from 'react-error-boundary';

const DataSchema = z.object({
  value: z.number(),
  amount: z.number().positive(),
});

function DataComponent({ rawData }: { rawData: unknown }) {
  // ãƒ‘ãƒ¼ã‚¹ã«å¤±æ•—ã—ãŸã‚‰Errorã‚’throwï¼ˆError BoundaryãŒã‚­ãƒ£ãƒƒãƒï¼‰
  const data = DataSchema.parse(rawData);
  
  return <div>{data.value + data.amount}</div>;
}

function ErrorFallback({ error, resetErrorBoundary }: { 
  error: Error; 
  resetErrorBoundary: () => void;
}) {
  return (
    <div className="error-boundary">
      <h2>ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</h2>
      <p>ãƒ‡ãƒ¼ã‚¿ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚</p>
      <button onClick={resetErrorBoundary}>å†è©¦è¡Œ</button>
    </div>
  );
}

function App() {
  const rawData: unknown = { value: 100, amount: 50 };
  
  return (
    <ErrorBoundary FallbackComponent={ErrorFallback}>
      <DataComponent rawData={rawData} />
    </ErrorBoundary>
  );
}
```

**ãªãœé‡è¦ã‹:**
- **å‹å®‰å…¨æ€§**: TypeScriptã®å‹ã‚·ã‚¹ãƒ†ãƒ ã§å‹ãƒã‚§ãƒƒã‚¯
- **ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**: å½¢å¼ãƒ»ç¯„å›²ã‚’æ¤œæŸ»ï¼ˆZodã§è‡ªå‹•ç”Ÿæˆï¼‰
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: XSSã€ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ãªã©ã®æ”»æ’ƒã‚’é˜²æ­¢
- **ä¿å®ˆæ€§**: ã‚¹ã‚­ãƒ¼ãƒé§†å‹•ã§ä¿å®ˆãŒå®¹æ˜“

### å‰¯ä½œç”¨ã®å±€æ‰€åŒ–

DOMæ›´æ–°ãƒ»APIå‘¼ã³å‡ºã—ãƒ»ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æ“ä½œãªã©ã®å‰¯ä½œç”¨ã‚’ãƒ­ã‚¸ãƒƒã‚¯ã®æœ«å°¾ã«é›†ç´„ã—ã€ãã‚Œä»¥å‰ã‚’çŠ¶æ…‹ã‚’æŒãŸãªã„ç´”ç²‹å‡¦ç†ã¨ã—ã¦ä¿ã¤ã€‚

> **ã€ã¾ã•ã‹ã‚Šã€‘Stateã®åŒæœŸã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³**: Propsã‹ã‚‰æ´¾ç”Ÿã™ã‚‹ãƒ‡ãƒ¼ã‚¿ï¼ˆfilterçµæœãªã©ï¼‰ã‚’`useState` + `useEffect`ã§ç®¡ç†ã™ã‚‹ã¨ã€**ã€Œ2å›ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã€**ãŒç™ºç”Ÿã—ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ä½ä¸‹ã¨ãƒã‚°ã®æ¸©åºŠã«ãªã‚Šã¾ã™ã€‚ã€Œè¨ˆç®—ã§ãã‚‹ã‚‚ã®ã¯Stateã«å…¥ã‚Œãªã„ã€ã€‚ã¾ãšã¯ã€Œç´”ç²‹ãªè¨ˆç®—ã€ã¨ã—ã¦renderé–¢æ•°å†…ã§å®Œçµã•ã›ã‚‹ã®ãŒReactã®åŸºæœ¬ã§ã™ã€‚

#### å®Ÿè£…ä¾‹

```typescript
// âŒ æ‚ªã„ä¾‹: å‰¯ä½œç”¨ãŒæ•£åœ¨
function Component({ items }: { items: Item[] }) {
  const [filtered, setFiltered] = useState<Item[]>([]);
  
  useEffect(() => {
    // å‰¯ä½œç”¨1: ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
    const filtered = items.filter(item => item.active);
    setFiltered(filtered);
    
    // ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆå‰¯ä½œç”¨ãŒæ··åœ¨ï¼‰
    if (filtered.length > 100) {
      // å‰¯ä½œç”¨2: ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æ“ä½œ
      localStorage.setItem('largeData', JSON.stringify(filtered));
    }
    
    // å‰¯ä½œç”¨3: DOMæ›´æ–°
    document.title = `Items: ${filtered.length}`;
  }, [items]);
  
  return <div>{filtered.length}</div>;
}
```

**âŒ Stateã®åŒæœŸã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³: Propsã‹ã‚‰æ´¾ç”Ÿã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’useState + useEffectã§ç®¡ç†**

```tsx
function Component({ items }: { items: Item[] }) {
  const [filtered, setFiltered] = useState<Item[]>([]);
  
  useEffect(() => {
    // å•é¡Œ: Propsã‹ã‚‰æ´¾ç”Ÿã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’Stateã§ç®¡ç†
    // ã“ã‚Œã«ã‚ˆã‚Šã€Œ2å›ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã€ãŒç™ºç”Ÿã™ã‚‹
    const filtered = items.filter(item => item.active);
    setFiltered(filtered);
  }, [items]);
  
  return <div>{filtered.length}</div>;
}

// å•é¡Œç‚¹:
// 1. 2å›ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãŒç™ºç”Ÿï¼ˆåˆå›ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° â†’ useEffect â†’ setState â†’ å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ï¼‰
// 2. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®ä½ä¸‹
// 3. ãƒã‚°ã®æ¸©åºŠï¼ˆStateã¨Propsã®ä¸æ•´åˆã®å¯èƒ½æ€§ï¼‰
```

**âœ… è‰¯ã„ä¾‹: å‰¯ä½œç”¨ã®å±€æ‰€åŒ–ï¼ˆè¨ˆç®—ã§ãã‚‹ã‚‚ã®ã¯Stateã«å…¥ã‚Œãªã„ï¼‰**

```tsx
function filterItems(items: Item[]): Item[] {
  // ç´”ç²‹é–¢æ•°: å‰¯ä½œç”¨ãªã—
  return items.filter(item => item.active);
}

function Component({ items }: { items: Item[] }) {
  // 1. ç´”ç²‹ãªè¨ˆç®—ï¼ˆãƒ¡ãƒ¢åŒ–ã§æœ€é©åŒ–ï¼‰
  const filtered = useMemo(() => filterItems(items), [items]);
  
  // 2. å‰¯ä½œç”¨ã¯ã‚¤ãƒ™ãƒ³ãƒˆã‚„useEffectã§ã€Œå¤–ã€ã¸
  useEffect(() => {
    // å‰¯ä½œç”¨ã®é›†ç´„: ã™ã¹ã¦ã®å‰¯ä½œç”¨ã‚’æœ«å°¾ã«
    saveToStorageIfNeeded(filtered);
    updateDocumentTitle(filtered.length);
  }, [filtered]);
  
  return <div>{filtered.length}</div>;
}

function saveToStorageIfNeeded(items: Item[]) {
  if (items.length > 100) {
    localStorage.setItem('largeData', JSON.stringify(items));
  }
}

function updateDocumentTitle(count: number) {
  document.title = `Items: ${count}`;
}
```

**é‡è¦ãªãƒã‚¤ãƒ³ãƒˆ:**

- **è¨ˆç®—ã§ãã‚‹ã‚‚ã®ã¯Stateã«å…¥ã‚Œãªã„**: Propsã‹ã‚‰æ´¾ç”Ÿã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã¯ã€`useMemo`ã§è¨ˆç®—ã™ã‚‹
- **å‰¯ä½œç”¨ã®å±€æ‰€åŒ–**: å‰¯ä½œç”¨ã¯`useEffect`ã‚„ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã§ã€Œå¤–ã€ã¸åˆ†é›¢
- **ç´”ç²‹é–¢æ•°ã®å„ªå…ˆ**: ã¾ãšã¯ç´”ç²‹ãªè¨ˆç®—ã¨ã—ã¦renderé–¢æ•°å†…ã§å®Œçµã•ã›ã‚‹

**ãªãœé‡è¦ã‹:**
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: ä¸è¦ãªå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’é˜²ã
- **ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§**: ç´”ç²‹é–¢æ•°ã¯å˜ä½“ãƒ†ã‚¹ãƒˆãŒå®¹æ˜“
- **å¯èª­æ€§**: å‰¯ä½œç”¨ãŒæ˜ç¢ºã«åˆ†é›¢ã•ã‚Œã‚‹
- **ãƒ‡ãƒãƒƒã‚°å®¹æ˜“æ€§**: å‰¯ä½œç”¨ã®ç™ºç”Ÿç®‡æ‰€ãŒæ˜ç¢º
- **ãƒã‚°ã®é˜²æ­¢**: Stateã¨Propsã®ä¸æ•´åˆã‚’é˜²ã

### ä¾å­˜ã®éš”é›¢

ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ãŒç‰¹å®šãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚„Reactã®ä»•æ§˜ã«ä¾å­˜ã—ãªã„ã‚ˆã†ã€æŠ½è±¡åŒ–ã™ã‚‹ã€‚

> **ã€ã¾ã•ã‹ã‚Šã€‘Reactã®ä¸–ç•Œã§ã®ä¾å­˜ã®éš”é›¢**: ã‚¯ãƒ©ã‚¹ã‚„ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’æ˜ç¤ºçš„ã«æ³¨å…¥ã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘çš„ãªDIï¼ˆä¾å­˜æ€§æ³¨å…¥ï¼‰ã¯ã€ã‚³ãƒ¼ãƒ‰ã‚’è¤‡é›‘ã«ã™ã‚‹ã ã‘ã§æ•¬é ã•ã‚ŒãŒã¡ã§ã™ã€‚Reactã«ãŠã‘ã‚‹ã€Œéš”é›¢ã€ã®æ­£è§£ã¯**ã€Œã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã¸ã®éš è”½ã€**ã¨**ã€ŒMSWï¼ˆMock Service Workerï¼‰ã€**ã§ã™ã€‚

#### âŒ ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³: Java/C#çš„ãªä¾å­˜æ€§æ³¨å…¥

```typescript
// âŒ å•é¡Œã®ã‚ã‚‹ä¾‹: ã‚¯ãƒ©ã‚¹ãƒ™ãƒ¼ã‚¹ã®DIï¼ˆJava/C#çš„ï¼‰
interface DataRepository {
  fetchData(): Promise<Data[]>;
}

class ApiDataRepository implements DataRepository {
  async fetchData(): Promise<Data[]> {
    const res = await fetch('/api/data');
    return res.json();
  }
}

class MockDataRepository implements DataRepository {
  async fetchData(): Promise<Data[]> {
    return [{ id: 1, name: 'Mock Data' }];
  }
}

function useData(repository: DataRepository) {
  const [data, setData] = useState<Data[]>([]);
  
  useEffect(() => {
    repository.fetchData().then(setData);
  }, [repository]);
  
  return data;
}

function Component() {
  const repository = new ApiDataRepository();
  const data = useData(repository);
  
  return <div>{data.length}</div>;
}

// å•é¡Œç‚¹:
// - ã‚¯ãƒ©ã‚¹ãƒ™ãƒ¼ã‚¹ã®DIã¯Reactã§ã¯æ•¬é ã•ã‚ŒãŒã¡
// - ã‚³ãƒ¼ãƒ‰ãŒè¤‡é›‘ã«ãªã‚‹
// - ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«repositoryã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ãŒå¿…è¦
```

#### âœ… å®Ÿå‹™çš„ãªè§£æ±ºç­–: ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã¨MSW

**1. ãƒ­ã‚¸ãƒƒã‚¯ã®éš”é›¢: ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã¸ã®éš è”½**

```tsx
// hooks/useData.ts
// ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯: ãã®ä¸­èº«ãŒfetchãªã®ã‹axiosãªã®ã‹ã‚’ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«çŸ¥ã‚‰ã›ãªã„
export function useData() {
  const [data, setData] = useState<Data[]>([]);
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<Error | null>(null);
  
  useEffect(() => {
    setIsLoading(true);
    setError(null);
    
    fetch('/api/data')
      .then(response => {
        if (!response.ok) {
          throw new Error('Failed to fetch');
        }
        return response.json();
      })
      .then(data => {
        setData(data);
        setIsLoading(false);
      })
      .catch(error => {
        setError(error);
        setIsLoading(false);
      });
  }, []);
  
  return { data, isLoading, error };
}

// ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ: ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã‚’ä½¿ç”¨
function Component() {
  const { data, isLoading, error } = useData();
  
  if (isLoading) return <div>Loading...</div>;
  if (error) return <div>Error: {error.message}</div>;
  
  return <div>{data.length}</div>;
}
```

**2. ãƒ†ã‚¹ãƒˆã®éš”é›¢: MSWï¼ˆMock Service Workerï¼‰**

> **ğŸ“š MSWã®è©³ç´°**: MSWã®è©³ç´°ã«ã¤ã„ã¦ã¯ã€[è¨­è¨ˆã‚¬ã‚¤ãƒ‰ã®MSW](/è¨­è¨ˆã‚¬ã‚¤ãƒ‰/02_APIè¨­è¨ˆ/05_MSW_ãƒ¢ãƒƒã‚¯ã‚µãƒ¼ãƒ“ã‚¹ãƒ¯ãƒ¼ã‚«ãƒ¼)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

```tsx
// mocks/handlers.ts
import { http, HttpResponse } from 'msw';

export const handlers = [
  http.get('/api/data', () => {
    return HttpResponse.json([
      { id: 1, name: 'Mock Data 1' },
      { id: 2, name: 'Mock Data 2' },
    ]);
  }),
];

// ãƒ†ã‚¹ãƒˆ: ã‚³ãƒ¼ãƒ‰ã‚’ãƒ¢ãƒƒã‚¯ç”¨ã«æ›¸ãæ›ãˆã‚‹ã®ã§ã¯ãªãã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å±¤ã§ãƒ¢ãƒƒã‚¯
import { render, screen, waitFor } from '@testing-library/react';
import { setupServer } from 'msw/node';
import { handlers } from '../mocks/handlers';
import Component from './Component';

const server = setupServer(...handlers);

beforeAll(() => server.listen());
afterEach(() => server.resetHandlers());
afterAll(() => server.close());

test('displays data', async () => {
  render(<Component />);
  
  // MSWãŒãƒ¢ãƒƒã‚¯ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã™ã¾ã§å¾…ã¤
  await waitFor(() => {
    expect(screen.getByText(/mock data/i)).toBeInTheDocument();
  });
});
```

**åˆ©ç‚¹:**
- **å®Ÿè£…è©³ç´°ã‚’ãƒ†ã‚¹ãƒˆã—ãªã„**: ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã®ä¸­èº«ï¼ˆfetch/axiosï¼‰ã‚’çŸ¥ã‚‰ã›ãªã„
- **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å±¤ã§ãƒ¢ãƒƒã‚¯**: ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãæ›ãˆãšã«ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å±¤ã§ãƒ¢ãƒƒã‚¯
- **RTLã®æ€æƒ³ã«åˆè‡´**: ã€Œå®Ÿè£…è©³ç´°ã‚’ãƒ†ã‚¹ãƒˆã—ãªã„ã€ã¨ã„ã†React Testing Libraryã®æ€æƒ³ã«åˆè‡´
- **ä¿å®ˆæ€§**: ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã®å®Ÿè£…ãŒå¤‰ã‚ã£ã¦ã‚‚ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯å¤‰æ›´ä¸è¦

**ãªãœé‡è¦ã‹:**
- **äº¤æ›å®¹æ˜“æ€§**: APIã‚’å¤‰æ›´ã—ã¦ã‚‚ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã¯å¤‰æ›´ä¸è¦ï¼ˆã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯å†…ã§å®Œçµï¼‰
- **ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§**: MSWã§ç°¡å˜ã«ãƒ†ã‚¹ãƒˆå¯èƒ½ï¼ˆå®Ÿè£…è©³ç´°ã‚’ãƒ†ã‚¹ãƒˆã—ãªã„ï¼‰
- **ä¿å®ˆæ€§**: ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®å¤‰æ›´ã«å¼·ã„ï¼ˆã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã§æŠ½è±¡åŒ–ï¼‰
- **Reactã‚‰ã—ã•**: ã‚¯ãƒ©ã‚¹ãƒ™ãƒ¼ã‚¹ã®DIã§ã¯ãªãã€ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã§æŠ½è±¡åŒ–

### Error Boundary: å®‰å…¨ã«å£Šã‚Œã‚‹ãŸã‚ã®å¿…é ˆè¦ç´ 

> **ã€ã¾ã•ã‹ã‚Šã€‘ã€Œå®‰å…¨ã«å£Šã‚Œã‚‹ã€ãŸã‚ã®æœ€å¤§ã®æ¬ è½**: å¢ƒç•Œé˜²å¾¡ã§`throw Error`ã—ã¦ã‚‚ã€ãã‚Œã‚’å—ã‘æ­¢ã‚ã‚‹Error BoundaryãŒãªã‘ã‚Œã°ã€ã‚¢ãƒ—ãƒªå…¨ä½“ãŒçœŸã£ç™½ï¼ˆãƒ›ãƒ¯ã‚¤ãƒˆã‚¢ã‚¦ãƒˆï¼‰ã«ãªã‚Šã¾ã™ã€‚ã“ã‚Œã¯ã€Œå®‰å…¨ãªå£Šã‚Œæ–¹ã€ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

**ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå˜ä½ã§Error Boundaryã‚’è¨­ç½®ã—ã€ä¸€éƒ¨ãŒå£Šã‚Œã¦ã‚‚ä»–ã®æ©Ÿèƒ½ï¼ˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚„ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰ã¯ç”Ÿãæ®‹ã‚‹ã‚ˆã†ã«ã™ã‚‹**ã“ã¨ãŒã€ã€Œå®‰å…¨ã«å£Šã‚Œã‚‹ã€ãŸã‚ã®æœ€å¤§ã®åŸå‰‡ã§ã™ã€‚

#### å®Ÿè£…ä¾‹

```tsx
import { ErrorBoundary } from 'react-error-boundary';
import { z } from 'zod';

const DataSchema = z.object({
  value: z.number(),
  amount: z.number().positive(),
});

function DataComponent({ rawData }: { rawData: unknown }) {
  // ãƒ‘ãƒ¼ã‚¹ã«å¤±æ•—ã—ãŸã‚‰Errorã‚’throwï¼ˆError BoundaryãŒã‚­ãƒ£ãƒƒãƒï¼‰
  const data = DataSchema.parse(rawData);
  
  return <div>{data.value + data.amount}</div>;
}

function ErrorFallback({ error, resetErrorBoundary }: { 
  error: Error; 
  resetErrorBoundary: () => void;
}) {
  return (
    <div className="error-boundary">
      <h2>ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</h2>
      <p>ãƒ‡ãƒ¼ã‚¿ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚</p>
      <p>ã‚¨ãƒ©ãƒ¼è©³ç´°: {error.message}</p>
      <button onClick={resetErrorBoundary}>å†è©¦è¡Œ</button>
    </div>
  );
}

function App() {
  const rawData: unknown = { value: 100, amount: 50 };
  
  return (
    <div>
      {/* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³: Error Boundaryã®å¤–å´ï¼ˆå¸¸ã«è¡¨ç¤ºã•ã‚Œã‚‹ï¼‰ */}
      <Navigation />
      
      {/* ãƒ‡ãƒ¼ã‚¿ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ: Error Boundaryã§å›²ã‚€ï¼ˆå£Šã‚Œã¦ã‚‚ä»–ã¯ç”Ÿãæ®‹ã‚‹ï¼‰ */}
      <ErrorBoundary
        FallbackComponent={ErrorFallback}
        onError={(error, errorInfo) => {
          // ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’é€ä¿¡ï¼ˆSentryãªã©ï¼‰
          console.error('Error caught by boundary:', error, errorInfo);
        }}
      >
        <DataComponent rawData={rawData} />
      </ErrorBoundary>
      
      {/* ãƒ•ãƒƒã‚¿ãƒ¼: Error Boundaryã®å¤–å´ï¼ˆå¸¸ã«è¡¨ç¤ºã•ã‚Œã‚‹ï¼‰ */}
      <Footer />
    </div>
  );
}
```

**è¨­è¨ˆãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ã®æŒ‡æ‘˜æ–‡ä¾‹:**

```
ã€æŒ‡æ‘˜ã€‘ãƒ›ãƒ¯ã‚¤ãƒˆã‚¢ã‚¦ãƒˆã®ãƒªã‚¹ã‚¯ãŒã‚ã‚Šã¾ã™ã€‚
ã€å•é¡Œã€‘ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼æ™‚ã«Errorã‚’throwã—ã¦ã„ã¾ã™ãŒã€ã‚­ãƒ£ãƒƒãƒã™ã‚‹ä»•çµ„ã¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚
ã€å½±éŸ¿ã€‘ã‚¢ãƒ—ãƒªå…¨ä½“ãŒã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ“ä½œä¸èƒ½ã«ãªã‚Šã¾ã™ã€‚
ã€æ¨å¥¨ã€‘é‡è¦ãªæ©Ÿèƒ½å˜ä½ã§Error Boundaryã‚’è¨­ç½®ã—ã€ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯UIã‚’è¡¨ç¤ºã•ã›ã¦ãã ã•ã„ã€‚
```

**ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹:**

1. **æ©Ÿèƒ½å˜ä½ã§Error Boundaryã‚’è¨­ç½®**: é‡è¦ãªæ©Ÿèƒ½å˜ä½ã§Error Boundaryã‚’è¨­ç½®ã—ã€ä¸€éƒ¨ãŒå£Šã‚Œã¦ã‚‚ä»–ã®æ©Ÿèƒ½ã¯ç”Ÿãæ®‹ã‚‹ã‚ˆã†ã«ã™ã‚‹
2. **ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’é€ä¿¡**: ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã€ã‚¨ãƒ©ãƒ¼å ±å‘Šã‚µãƒ¼ãƒ“ã‚¹ï¼ˆSentryãªã©ï¼‰ã«é€ä¿¡ã™ã‚‹
3. **å†è©¦è¡Œæ©Ÿèƒ½ã‚’æä¾›**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå†è©¦è¡Œã§ãã‚‹ãƒœã‚¿ãƒ³ã‚’æä¾›ã™ã‚‹
4. **ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**: æŠ€è¡“çš„ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ã¯ãªãã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«åˆ†ã‹ã‚Šã‚„ã™ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹

> **ğŸ“š Error Boundaryã®è©³ç´°**: Error Boundaryã®è©³ç´°ãªå®Ÿè£…æ–¹æ³•ã«ã¤ã„ã¦ã¯ã€[ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã®Error Boundary](/Reactã‚¬ã‚¤ãƒ‰/03_ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹/01_ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–#ã‚¨ãƒ©ãƒ¼å¢ƒç•Œerror-boundary-lazyã§ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã®å‡¦ç†)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### ã¾ã¨ã‚

å®‰å…¨ã«å£Šã‚Œã‚‹ãŸã‚ã®è¨­è¨ˆåŸå‰‡ã®ãƒã‚¤ãƒ³ãƒˆï¼š

- **å¢ƒç•Œé˜²å¾¡**: å¤–éƒ¨ãƒ‡ãƒ¼ã‚¿ã¯å¸¸ã«æ±šæŸ“ã•ã‚Œã¦ã„ã‚‹ã¨ä»®å®šã—ã€**ã‚¹ã‚­ãƒ¼ãƒé§†å‹•ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆZodï¼‰**ã§å‹ãƒ»å½¢å¼ãƒ»ç¯„å›²ã‚’æ¤œæŸ»
- **å‰¯ä½œç”¨ã®å±€æ‰€åŒ–**: å‰¯ä½œç”¨ã‚’ãƒ­ã‚¸ãƒƒã‚¯ã®æœ«å°¾ã«é›†ç´„ã—ã€ç´”ç²‹å‡¦ç†ã¨åˆ†é›¢ï¼ˆ**è¨ˆç®—ã§ãã‚‹ã‚‚ã®ã¯Stateã«å…¥ã‚Œãªã„**ï¼‰
- **ä¾å­˜ã®éš”é›¢**: **ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã¸ã®éš è”½**ã¨**MSW**ã§æŠ½è±¡åŒ–ï¼ˆã‚¯ãƒ©ã‚¹ãƒ™ãƒ¼ã‚¹ã®DIã§ã¯ãªãï¼‰
- **Error Boundary**: ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå˜ä½ã§Error Boundaryã‚’è¨­ç½®ã—ã€ä¸€éƒ¨ãŒå£Šã‚Œã¦ã‚‚ä»–ã®æ©Ÿèƒ½ã¯ç”Ÿãæ®‹ã‚‹ã‚ˆã†ã«ã™ã‚‹

ã“ã‚Œã‚‰ã®åŸå‰‡ã«ã‚ˆã‚Šã€ã€Œç•°å¸¸æ™‚ã«å®‰å…¨ã«å£Šã‚Œã‚‹ã€å …ç‰¢ãªã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã§ãã¾ã™ã€‚
