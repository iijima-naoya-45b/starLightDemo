---
title: "ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–"
label: "ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–"
---

## âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

Spring Bootã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®`ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹`ã‚’å‘ä¸Šã•ã›ã‚‹ãŸã‚ã®æ§˜ã€…ãªæ‰‹æ³•ã«ã¤ã„ã¦è§£èª¬ã—ã¾ã™ã€‚

### ğŸ’¾ ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°

#### ğŸ“‹ Spring Cacheã®è¨­å®š

```java
@Configuration
@EnableCaching
public class CacheConfig {
    
    @Bean
    public CacheManager cacheManager() {
        RedisCacheManager.Builder builder = RedisCacheManager
            .RedisCacheManagerBuilder
            .fromConnectionFactory(redisConnectionFactory())
            .cacheDefaults(cacheConfiguration());
        
        return builder.build();
    }
    
    private RedisCacheConfiguration cacheConfiguration() {
        return RedisCacheConfiguration.defaultCacheConfig()
            .entryTtl(Duration.ofMinutes(10))
            .serializeKeysWith(RedisSerializationContext.SerializationPair
                .fromSerializer(new StringRedisSerializer()))
            .serializeValuesWith(RedisSerializationContext.SerializationPair
                .fromSerializer(new GenericJackson2JsonRedisSerializer()));
    }
}
```

#### ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ä½¿ç”¨

```java
@Service
public class UserService {
    
    @Autowired
    private UserRepository userRepository;
    
    @Cacheable(value = "users", key = "#id")
    public User findById(Long id) {
        return userRepository.findById(id).orElseThrow();
    }
    
    @CacheEvict(value = "users", key = "#user.id")
    public User updateUser(User user) {
        return userRepository.save(user);
    }
    
    @CacheEvict(value = "users", allEntries = true)
    public void clearAllCache() {
        // ã™ã¹ã¦ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢
    }
    
    @CachePut(value = "users", key = "#user.id")
    public User saveUser(User user) {
        return userRepository.save(user);
    }
}
```

### éåŒæœŸå‡¦ç†

#### @Asyncã®ä½¿ç”¨

```java
@Configuration
@EnableAsync
public class AsyncConfig {
    
    @Bean(name = "taskExecutor")
    public Executor taskExecutor() {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
        executor.setCorePoolSize(5);
        executor.setMaxPoolSize(10);
        executor.setQueueCapacity(100);
        executor.setThreadNamePrefix("async-");
        executor.initialize();
        return executor;
    }
}

@Service
public class EmailService {
    
    @Async("taskExecutor")
    public CompletableFuture<Void> sendEmail(String to, String subject, String body) {
        // ãƒ¡ãƒ¼ãƒ«é€ä¿¡å‡¦ç†
        return CompletableFuture.completedFuture(null);
    }
    
    @Async
    public void sendNotification(String message) {
        // é€šçŸ¥é€ä¿¡å‡¦ç†
    }
}
```

#### CompletableFutureã®ä½¿ç”¨

```java
@Service
public class OrderService {
    
    @Autowired
    private PaymentService paymentService;
    
    @Autowired
    private InventoryService inventoryService;
    
    @Autowired
    private ShippingService shippingService;
    
    public OrderResult processOrder(Order order) {
        CompletableFuture<PaymentResult> paymentFuture = 
            CompletableFuture.supplyAsync(() -> paymentService.process(order));
        
        CompletableFuture<InventoryResult> inventoryFuture = 
            CompletableFuture.supplyAsync(() -> inventoryService.reserve(order));
        
        CompletableFuture<ShippingResult> shippingFuture = 
            paymentFuture.thenCompose(payment -> 
                inventoryFuture.thenCompose(inventory -> 
                    CompletableFuture.supplyAsync(() -> 
                        shippingService.schedule(order)
                    )
                )
            );
        
        return shippingFuture.join();
    }
}
```

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒªã®æœ€é©åŒ–

#### ãƒãƒƒãƒå‡¦ç†

```java
@Service
@Transactional
public class UserService {
    
    @Autowired
    private UserRepository userRepository;
    
    public void saveUsersInBatch(List<User> users) {
        int batchSize = 50;
        for (int i = 0; i < users.size(); i += batchSize) {
            List<User> batch = users.subList(i, Math.min(i + batchSize, users.size()));
            userRepository.saveAll(batch);
            userRepository.flush();
            userRepository.clear();
        }
    }
}
```

**application.properties:**

```properties
spring.jpa.properties.hibernate.jdbc.batch_size=50
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
```

#### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã®ä½¿ç”¨

```java
public interface UserSummary {
    String getName();
    String getEmail();
}

@Repository
public interface UserRepository extends JpaRepository<User, Long> {
    @Query("SELECT u.name as name, u.email as email FROM User u")
    List<UserSummary> findAllSummaries();
}
```

#### ãƒšãƒ¼ã‚¸ãƒ³ã‚°ã®æœ€é©åŒ–

```java
@Service
public class UserService {
    
    @Autowired
    private UserRepository userRepository;
    
    public Page<UserDTO> getUsers(int page, int size) {
        Pageable pageable = PageRequest.of(page, size);
        return userRepository.findAll(pageable)
            .map(this::convertToDTO);
    }
    
    // ã‚«ã‚¦ãƒ³ãƒˆã‚¯ã‚¨ãƒªã‚’æœ€é©åŒ–
    @Query(value = "SELECT u FROM User u",
           countQuery = "SELECT COUNT(u.id) FROM User u")
    Page<User> findAllOptimized(Pageable pageable);
}
```

### ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ¼ãƒ«ã®è¨­å®š

**application.properties:**

```properties
# HikariCPã®è¨­å®š
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000
```

### ãƒ­ã‚®ãƒ³ã‚°ã®æœ€é©åŒ–

```xml
<!-- logback-spring.xml -->
<configuration>
    <appender name="FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>logs/application.log</file>
        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <fileNamePattern>logs/application-%d{yyyy-MM-dd}.log</fileNamePattern>
            <maxHistory>30</maxHistory>
        </rollingPolicy>
        <encoder>
            <pattern>%d{yyyy-MM-dd HH:mm:ss} - %msg%n</pattern>
        </encoder>
    </appender>
    
    <logger name="org.hibernate.SQL" level="DEBUG"/>
    <logger name="org.hibernate.type.descriptor.sql.BasicBinder" level="TRACE"/>
    
    <root level="INFO">
        <appender-ref ref="FILE"/>
    </root>
</configuration>
```

### ã¾ã¨ã‚

ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã®ãƒã‚¤ãƒ³ãƒˆï¼š

- **ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°**: é »ç¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥
- **éåŒæœŸå‡¦ç†**: æ™‚é–“ã®ã‹ã‹ã‚‹å‡¦ç†ã‚’éåŒæœŸã§å®Ÿè¡Œ
- **ã‚¯ã‚¨ãƒªæœ€é©åŒ–**: ãƒãƒƒãƒå‡¦ç†ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã€ãƒšãƒ¼ã‚¸ãƒ³ã‚°
- **ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ¼ãƒ«**: é©åˆ‡ãªãƒ—ãƒ¼ãƒ«ã‚µã‚¤ã‚ºã®è¨­å®š
- **ãƒ­ã‚®ãƒ³ã‚°**: é©åˆ‡ãªãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã®è¨­å®š

ã“ã‚Œã‚‰ã®æœ€é©åŒ–ã«ã‚ˆã‚Šã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’å¤§å¹…ã«å‘ä¸Šã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚


