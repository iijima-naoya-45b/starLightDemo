---
title: "ãƒ†ã‚¹ãƒˆ"
label: "ãƒ†ã‚¹ãƒˆ"
---

## ğŸ§ª Spring Bootã§ã®ãƒ†ã‚¹ãƒˆ

Spring Bootã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ†ã‚¹ãƒˆã¯ã€JUnit 5ã¨Spring Testãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’ä½¿ç”¨ã—ã¦å®Ÿè£…ã—ã¾ã™ã€‚ã“ã®ç« ã§ã¯ã€æ§˜ã€…ãªç¨®é¡ã®ãƒ†ã‚¹ãƒˆã®æ›¸ãæ–¹ã«ã¤ã„ã¦è©³ã—ãè§£èª¬ã—ã¾ã™ã€‚

### ğŸ“‹ ãƒ†ã‚¹ãƒˆã®ç¨®é¡

#### ğŸ§ª 1. ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ

å˜ä¸€ã®ã‚¯ãƒ©ã‚¹ã‚„ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚ä¾å­˜é–¢ä¿‚ã¯ãƒ¢ãƒƒã‚¯ã§ç½®ãæ›ãˆã¾ã™ã€‚

```java
@ExtendWith(MockitoExtension.class)
class UserServiceTest {
    
    @Mock
    private UserRepository userRepository;
    
    @InjectMocks
    private UserService userService;
    
    @Test
    void testFindById() {
        // Given
        Long userId = 1L;
        User user = new User();
        user.setId(userId);
        user.setName("Test User");
        
        when(userRepository.findById(userId)).thenReturn(Optional.of(user));
        
        // When
        UserDTO result = userService.findById(userId);
        
        // Then
        assertThat(result).isNotNull();
        assertThat(result.getId()).isEqualTo(userId);
        assertThat(result.getName()).isEqualTo("Test User");
        verify(userRepository).findById(userId);
    }
    
    @Test
    void testFindByIdNotFound() {
        // Given
        Long userId = 999L;
        when(userRepository.findById(userId)).thenReturn(Optional.empty());
        
        // When & Then
        assertThatThrownBy(() -> userService.findById(userId))
            .isInstanceOf(ResourceNotFoundException.class)
            .hasMessageContaining("User");
    }
}
```

#### 2. çµ±åˆãƒ†ã‚¹ãƒˆ

è¤‡æ•°ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’çµ„ã¿åˆã‚ã›ã¦ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚

```java
@SpringBootTest
@Transactional
class UserServiceIntegrationTest {
    
    @Autowired
    private UserService userService;
    
    @Autowired
    private UserRepository userRepository;
    
    @Test
    void testCreateUser() {
        // Given
        UserCreateRequest request = new UserCreateRequest();
        request.setName("Test User");
        request.setEmail("test@example.com");
        request.setPassword("password123");
        
        // When
        UserDTO result = userService.create(request);
        
        // Then
        assertThat(result).isNotNull();
        assertThat(result.getId()).isNotNull();
        assertThat(result.getName()).isEqualTo("Test User");
        assertThat(result.getEmail()).isEqualTo("test@example.com");
        
        // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
        Optional<User> savedUser = userRepository.findById(result.getId());
        assertThat(savedUser).isPresent();
        assertThat(savedUser.get().getName()).isEqualTo("Test User");
    }
}
```

#### 3. Webå±¤ã®ãƒ†ã‚¹ãƒˆ

ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚

```java
@WebMvcTest(UserController.class)
class UserControllerTest {
    
    @Autowired
    private MockMvc mockMvc;
    
    @MockBean
    private UserService userService;
    
    @Autowired
    private ObjectMapper objectMapper;
    
    @Test
    void testGetUser() throws Exception {
        // Given
        Long userId = 1L;
        UserDTO userDTO = new UserDTO();
        userDTO.setId(userId);
        userDTO.setName("Test User");
        userDTO.setEmail("test@example.com");
        
        when(userService.findById(userId)).thenReturn(userDTO);
        
        // When & Then
        mockMvc.perform(get("/api/users/{id}", userId))
            .andExpect(status().isOk())
            .andExpect(jsonPath("$.id").value(userId))
            .andExpect(jsonPath("$.name").value("Test User"))
            .andExpect(jsonPath("$.email").value("test@example.com"));
    }
    
    @Test
    void testCreateUser() throws Exception {
        // Given
        UserCreateRequest request = new UserCreateRequest();
        request.setName("New User");
        request.setEmail("new@example.com");
        request.setPassword("password123");
        
        UserDTO createdUser = new UserDTO();
        createdUser.setId(1L);
        createdUser.setName("New User");
        createdUser.setEmail("new@example.com");
        
        when(userService.create(any(UserCreateRequest.class))).thenReturn(createdUser);
        
        // When & Then
        mockMvc.perform(post("/api/users")
                .contentType(MediaType.APPLICATION_JSON)
                .content(objectMapper.writeValueAsString(request)))
            .andExpect(status().isCreated())
            .andExpect(jsonPath("$.id").value(1L))
            .andExpect(jsonPath("$.name").value("New User"));
    }
    
    @Test
    void testCreateUserValidationError() throws Exception {
        // Given
        UserCreateRequest request = new UserCreateRequest();
        // å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¨­å®šã—ãªã„
        
        // When & Then
        mockMvc.perform(post("/api/users")
                .contentType(MediaType.APPLICATION_JSON)
                .content(objectMapper.writeValueAsString(request)))
            .andExpect(status().isBadRequest());
    }
}
```

#### 4. ãƒªãƒã‚¸ãƒˆãƒªå±¤ã®ãƒ†ã‚¹ãƒˆ

ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚

```java
@DataJpaTest
@AutoConfigureTestDatabase(replace = AutoConfigureTestDatabase.Replace.NONE)
class UserRepositoryTest {
    
    @Autowired
    private UserRepository userRepository;
    
    @Autowired
    private TestEntityManager entityManager;
    
    @Test
    void testFindByEmail() {
        // Given
        User user = new User();
        user.setName("Test User");
        user.setEmail("test@example.com");
        user.setPassword("password");
        entityManager.persistAndFlush(user);
        
        // When
        Optional<User> found = userRepository.findByEmail("test@example.com");
        
        // Then
        assertThat(found).isPresent();
        assertThat(found.get().getEmail()).isEqualTo("test@example.com");
    }
    
    @Test
    void testExistsByEmail() {
        // Given
        User user = new User();
        user.setName("Test User");
        user.setEmail("test@example.com");
        user.setPassword("password");
        entityManager.persistAndFlush(user);
        
        // When
        boolean exists = userRepository.existsByEmail("test@example.com");
        
        // Then
        assertThat(exists).isTrue();
    }
}
```

### ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®æº–å‚™

#### @Sqlã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨

```java
@SpringBootTest
@Sql(scripts = "/test-data.sql", executionPhase = Sql.ExecutionPhase.BEFORE_TEST_METHOD)
@Sql(scripts = "/cleanup.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)
class UserServiceTest {
    // ãƒ†ã‚¹ãƒˆãƒ¡ã‚½ãƒƒãƒ‰
}
```

#### @TestConfigurationã‚’ä½¿ç”¨

```java
@SpringBootTest
class UserServiceTest {
    
    @TestConfiguration
    static class TestConfig {
        @Bean
        @Primary
        public EmailService mockEmailService() {
            return mock(EmailService.class);
        }
    }
    
    @Autowired
    private UserService userService;
    
    // ãƒ†ã‚¹ãƒˆãƒ¡ã‚½ãƒƒãƒ‰
}
```

### ãƒ¢ãƒƒã‚¯ã®ä½¿ç”¨

#### Mockitoã‚’ä½¿ç”¨ã—ãŸãƒ¢ãƒƒã‚¯

```java
@ExtendWith(MockitoExtension.class)
class UserServiceTest {
    
    @Mock
    private UserRepository userRepository;
    
    @Mock
    private EmailService emailService;
    
    @InjectMocks
    private UserService userService;
    
    @Test
    void testCreateUser() {
        // Given
        UserCreateRequest request = new UserCreateRequest();
        request.setName("Test User");
        request.setEmail("test@example.com");
        request.setPassword("password123");
        
        User savedUser = new User();
        savedUser.setId(1L);
        savedUser.setName("Test User");
        savedUser.setEmail("test@example.com");
        
        when(userRepository.existsByEmail("test@example.com")).thenReturn(false);
        when(userRepository.save(any(User.class))).thenReturn(savedUser);
        doNothing().when(emailService).sendWelcomeEmail(anyString());
        
        // When
        UserDTO result = userService.create(request);
        
        // Then
        assertThat(result).isNotNull();
        assertThat(result.getId()).isEqualTo(1L);
        verify(userRepository).existsByEmail("test@example.com");
        verify(userRepository).save(any(User.class));
        verify(emailService).sendWelcomeEmail("test@example.com");
    }
}
```

### ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³

#### AssertJã‚’ä½¿ç”¨ï¼ˆæ¨å¥¨ï¼‰

```java
import static org.assertj.core.api.Assertions.*;

@Test
void testAssertions() {
    String name = "Test User";
    
    // åŸºæœ¬çš„ãªã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³
    assertThat(name).isEqualTo("Test User");
    assertThat(name).isNotBlank();
    assertThat(name).contains("Test");
    
    // ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³
    List<String> names = Arrays.asList("Alice", "Bob", "Charlie");
    assertThat(names).hasSize(3);
    assertThat(names).contains("Alice", "Bob");
    assertThat(names).doesNotContain("David");
    
    // ä¾‹å¤–ã®ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³
    assertThatThrownBy(() -> {
        throw new IllegalArgumentException("Invalid argument");
    }).isInstanceOf(IllegalArgumentException.class)
      .hasMessageContaining("Invalid");
}
```

### ãƒ†ã‚¹ãƒˆãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½¿ç”¨

ãƒ†ã‚¹ãƒˆå°‚ç”¨ã®è¨­å®šã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```java
@SpringBootTest
@ActiveProfiles("test")
class UserServiceTest {
    // ãƒ†ã‚¹ãƒˆãƒ¡ã‚½ãƒƒãƒ‰
}
```

**application-test.properties:**

```properties
spring.datasource.url=jdbc:h2:mem:testdb
spring.datasource.driver-class-name=org.h2.Driver
spring.jpa.hibernate.ddl-auto=create-drop
spring.jpa.show-sql=true
```

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ

```java
@Test
void testPerformance() {
    long startTime = System.currentTimeMillis();
    
    // ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®å‡¦ç†
    userService.processLargeDataSet();
    
    long duration = System.currentTimeMillis() - startTime;
    assertThat(duration).isLessThan(1000);  // 1ç§’ä»¥å†…ã«å®Œäº†ã™ã‚‹ã“ã¨
}
```

### ã¾ã¨ã‚

Spring Bootã§ã®ãƒ†ã‚¹ãƒˆã¯ã€ä»¥ä¸‹ã®æ–¹æ³•ã§å®Ÿè£…ã§ãã¾ã™ï¼š

- **ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ**: å˜ä¸€ã®ã‚¯ãƒ©ã‚¹ã‚„ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ãƒ†ã‚¹ãƒˆ
- **çµ±åˆãƒ†ã‚¹ãƒˆ**: è¤‡æ•°ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’çµ„ã¿åˆã‚ã›ã¦ãƒ†ã‚¹ãƒˆ
- **Webå±¤ãƒ†ã‚¹ãƒˆ**: ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ãƒ†ã‚¹ãƒˆ
- **ãƒªãƒã‚¸ãƒˆãƒªå±¤ãƒ†ã‚¹ãƒˆ**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹ã‚’ãƒ†ã‚¹ãƒˆ
- **ãƒ¢ãƒƒã‚¯ã®ä½¿ç”¨**: ä¾å­˜é–¢ä¿‚ã‚’ãƒ¢ãƒƒã‚¯ã§ç½®ãæ›ãˆ
- **ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®æº–å‚™**: @Sqlã‚„@TestConfigurationã‚’ä½¿ç”¨

é©åˆ‡ãªãƒ†ã‚¹ãƒˆã‚’æ›¸ãã“ã¨ã§ã€ã‚³ãƒ¼ãƒ‰ã®å“è³ªã¨ä¿¡é ¼æ€§ã‚’å‘ä¸Šã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚


