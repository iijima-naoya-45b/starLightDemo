---
title: Playwrightの構文
sidebar:
    label: 構文
---

## Playwrightの基本構文 🧪
Playwrightのテストは、`@playwright/test`という組み込みのテストランナーを使用して記述します。これにより、テストの構造化とアサーションが簡単になります。

### テストの作成
テストは**`test`関数で定義し、検証には`expect`関数**を使用します。`page`オブジェクトは、ブラウザ操作（ページの移動、クリック、入力など）を行うための中心的な役割を果たします。

```javascript
const { test, expect } = require('@playwright/test');

test('基本テスト：ページのタイトルを検証', async ({ page }) => {
  await page.goto('https://example.com');
  // ページのタイトルを検証します
  await expect(page).toHaveTitle(/Example Domain/);
});
```

`expect(page).toHaveTitle()`のように、アサーションは非常に読みやすく設計されています。

### 高度なテストシナリオ 🎯
Playwrightは、複雑なユーザーインタラクションを簡単に再現できます。

#### ユーザー操作の再現
`page.click()`, `page.fill()`, `page.press()`といったメソッドを使用して、クリック、テキスト入力、キーボード操作をシミュレートします。

```javascript
test('複雑なユーザーインタラクション', async ({ page }) => {
  await page.goto('https://playwright.dev/login');
  // フォームにユーザー名とパスワードを入力
  await page.fill('#username', 'testuser');
  await page.fill('#password', 'password123');
  // ログインボタンをクリック
  await page.click('#login-button');
  
  // ログイン後のウェルカムメッセージを検証
  const welcomeMessage = await page.locator('#welcome-message');
  await expect(welcomeMessage).toHaveText('Welcome, testuser!');
});
```

### CI/CD統合 🤝
Playwrightは、GitHub ActionsなどのCI/CDプラットフォームに簡単に統合できます。CI/CDパイプラインにテストを組み込むことで、コードが変更されるたびに自動でテストが実行され、デプロイ前にバグを発見できます。

#### GitHub Actionsの設定例
`.github/workflows/playwright.yml`ファイルを作成し、以下の内容を記述します。

```yaml
name: Playwright Tests

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
      - name: Install dependencies
        run: npm install
      - name: Install Playwright browsers
        run: npx playwright install --with-deps
      - name: Run Playwright tests
        run: npx playwright test
      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: playwright-report
          path: playwright-report/
          retention-days: 30
```

このワークフローは、`push`または`pull_request`が発生するたびに自動でテストを実行し、テスト結果のレポートをアップロードします。

### デバッグとトラブルシューティング 🐞
Playwrightには、テストのデバッグを助ける強力なツールが組み込まれています。

#### Playwright UI
`npx playwright test --ui`コマンドを実行すると、GUIでテストをステップ実行したり、DOMスナップショットを確認したりできます。

#### コードの一時停止
`page.pause()`をテストコードに挿入することで、特定の場所でテスト実行を一時停止し、ブラウザ上で要素の状態などを手動で確認できます。

```javascript
test('デバッグテスト', async ({ page }) => {
  await page.goto('https://example.com');
  await page.pause(); // ここでテストが一時停止
  // 手動で操作を確認後、ターミナルでresume
});
```

### パフォーマンス最適化 ⚡️
テストの実行時間を短縮し、効率を向上させるための手法です。

#### 並列テスト実行
Playwrightはデフォルトで並列実行をサポートしています。設定ファイル`playwright.config.js`で`workers`の数を調整できます。

```javascript
// playwright.config.js
module.exports = {
  // 並列実行するworkerの数を指定
  workers: process.env.CI ? 2 : undefined,
};
```

CI環境では`workers`の数を明示的に指定することで、CIサーバーのリソースを最大限に活用できます。

#### テストの分離
各テストケースは独立して実行されるように設計します。これにより、並列実行の効果が最大化されます。

### セキュリティテスト 🔐
Playwrightは、Webアプリケーションのセキュリティテストにも利用できます。

#### ユーザー認証のテスト
認証APIが正しく動作するか、不正な認証情報が拒否されるかをテストします。

```javascript
test('不正なログイン', async ({ page }) => {
  await page.goto('https://playwright.dev/login');
  await page.fill('#username', 'invalid-user');
  await page.fill('#password', 'wrong-password');
  await page.click('#login-button');
  
  // エラーメッセージが表示されることを検証
  const errorMessage = await page.locator('.error-message');
  await expect(errorMessage).toBeVisible();
});
```

#### APIリクエストの検証
`page.route()`メソッドを使って、特定のリクエストをインターセプトし、レスポンスを検証することも可能です。これにより、アプリケーションが機密データを正しく扱っているかをテストできます。