---
title: "Vercelã¨Render.comã®æ¯”è¼ƒè©•ä¾¡"
label: "Vercelã¨Render.comã®æ¯”è¼ƒè©•ä¾¡"
---

## âš–ï¸ Vercelã¨Render.comã®æ¯”è¼ƒè©•ä¾¡

åˆ†æ•£ã‚·ã‚¹ãƒ†ãƒ ãƒ»ã‚¯ãƒ©ã‚¦ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®è¦³ç‚¹ã‹ã‚‰ã€`Vercel`ã¨`Render.com`ã®æ¯”è¼ƒè©•ä¾¡ã‚’è¡Œã„ã¾ã™ã€‚

### ğŸ¯ çµè«–

**âš ï¸ `Vercel`ã¯ã€`ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³`å†…ã§å¤–éƒ¨`API`ã‚’å‘¼ã¶è¨­è¨ˆã‚„ã€é•·æ™‚é–“å®Ÿè¡ŒãŒå¿…è¦ãªéåŒæœŸå‡¦ç†ã«ã¯ä¸å‘ãã§ã™ã€‚`Outboxãƒ‘ã‚¿ãƒ¼ãƒ³`ãªã©ã®é©åˆ‡ãªè¨­è¨ˆã«ã‚ˆã‚Šä¸€éƒ¨ã®å•é¡Œã¯è§£æ±ºã§ãã¾ã™ãŒã€ãƒ—ãƒ­ã‚»ã‚¹å¯¿å‘½ã®åˆ¶ç´„ã‚„å†å®Ÿè¡Œã®ä¸ç¢ºå®Ÿæ€§ã«ã‚ˆã‚Šã€`Render.com`ãªã©ã®å¸¸é§ç’°å¢ƒãŒé©åˆ‡ãªã‚±ãƒ¼ã‚¹ãŒã‚ã‚Šã¾ã™ã€‚**

**âœ… `Render.com`ã¯ã€å¸¸é§ãƒ—ãƒ­ã‚»ã‚¹ã¨`Worker`ã«ã‚ˆã‚‹éåŒæœŸå‡¦ç†ãŒå¯èƒ½ãªãŸã‚ã€`ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³è¨­è¨ˆ`ã‚„`å†ªç­‰æ€§`ãŒé‡è¦ãªã‚·ã‚¹ãƒ†ãƒ ã«é©ã—ã¦ã„ã¾ã™ã€‚ãŸã ã—ã€`ã‚³ã‚¹ãƒˆ`ã¨`ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£`ã®ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ã‚’è€ƒæ…®ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚**

### åˆ¤æ–­ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ

```
1. ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å†…ã§å¤–éƒ¨APIã‚’å‘¼ã‚“ã§ã„ã‚‹ã‹ï¼Ÿ
   â†’ YES: Render.comã‚’æ¤œè¨ï¼ˆæ§‹é€ æ”¹å–„å¾Œã‚‚Vercelã¯å›°é›£ï¼‰
   â†’ NO: æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã¸

2. é•·æ™‚é–“å®Ÿè¡Œï¼ˆ5åˆ†ä»¥ä¸Šï¼‰ã®éåŒæœŸå‡¦ç†ãŒå¿…è¦ã‹ï¼Ÿ
   â†’ YES: Render.comã‚’æ¤œè¨
   â†’ NO: æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã¸

3. ãƒ—ãƒ­ã‚»ã‚¹çŠ¶æ…‹ã‚’ä¿æŒã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã‹ï¼Ÿ
   â†’ YES: Render.comã‚’æ¤œè¨
   â†’ NO: æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã¸

4. Outboxãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å®Ÿè£…ã§ãã‚‹ã‹ï¼Ÿ
   â†’ YES: Vercelã§ã‚‚å¯èƒ½ï¼ˆãŸã ã—åˆ¶ç´„ã‚ã‚Šï¼‰
   â†’ NO: Render.comã‚’æ¤œè¨

5. ã‚³ã‚¹ãƒˆã‚’æœ€å„ªå…ˆã™ã‚‹ã‹ï¼Ÿ
   â†’ YES: Vercelã‚’æ¤œè¨ï¼ˆæ§‹é€ æ”¹å–„å¿…é ˆï¼‰
   â†’ NO: Render.comã‚’æ¤œè¨

6. ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£ã‚’æœ€å„ªå…ˆã™ã‚‹ã‹ï¼Ÿ
   â†’ YES: Vercelã‚’æ¤œè¨ï¼ˆæ§‹é€ æ”¹å–„å¿…é ˆï¼‰
   â†’ NO: Render.comã‚’æ¤œè¨
```

### 1. ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å†…ã§å¤–éƒ¨APIã‚’å‘¼ã‚“ã§ã¯ã„ã‘ãªã„ç†ç”±

#### å•é¡Œã®ã‚ã‚‹å®Ÿè£…

**å•é¡Œã®ã‚ã‚‹ã‚³ãƒ¼ãƒ‰:**

```typescript
// âŒ æ‚ªã„ä¾‹: ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å†…ã§å¤–éƒ¨APIã‚’å‘¼ã¶
async function createOrder(orderData: OrderData) {
  return await db.transaction(async (tx) => {
    // 1. æ³¨æ–‡ã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜
    const order = await tx.order.create({ data: orderData });
    
    // 2. ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å†…ã§å¤–éƒ¨APIã‚’å‘¼ã¶ï¼ˆå•é¡Œï¼‰
    const paymentResult = await fetch('https://payment-api.example.com/charge', {
      method: 'POST',
      body: JSON.stringify({ orderId: order.id, amount: orderData.amount }),
    });
    
    if (!paymentResult.ok) {
      throw new Error('Payment failed');
    }
    
    // 3. æ±ºæ¸ˆçµæœã‚’ä¿å­˜
    await tx.payment.create({ data: { orderId: order.id, status: 'completed' } });
    
    return order;
  });
}
```

**å•é¡Œç‚¹:**

1. **ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®é•·æ™‚é–“ä¿æŒ**: å¤–éƒ¨APIã®å¿œç­”ã‚’å¾…ã¤é–“ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒ­ãƒƒã‚¯ãŒä¿æŒã•ã‚Œã‚‹
2. **å¤–éƒ¨éšœå®³ã®å½±éŸ¿**: å¤–éƒ¨APIã®éšœå®³ãŒãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã«å½±éŸ¿ã™ã‚‹
3. **ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã®å›°é›£**: å¤–éƒ¨APIãŒæˆåŠŸã—ãŸå¾Œã«ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ãŒå¤±æ•—ã—ãŸå ´åˆã€å¤–éƒ¨APIã®ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒå›°é›£
4. **ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã®ãƒªã‚¹ã‚¯**: å¤–éƒ¨APIã®å¿œç­”ãŒé…ã„å ´åˆã€ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã™ã‚‹

**å½±éŸ¿:**

- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ä½ä¸‹
- ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯ã®ç™ºç”Ÿ
- ãƒ‡ãƒ¼ã‚¿ã®ä¸æ•´åˆ
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã®ä½ä¸‹

#### è§£æ±ºç­–: Outboxãƒ‘ã‚¿ãƒ¼ãƒ³

**æ”¹å–„ã•ã‚ŒãŸå®Ÿè£…:**

```typescript
// âœ… è‰¯ã„ä¾‹: Outboxãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä½¿ç”¨
async function createOrder(orderData: OrderData) {
  return await db.transaction(async (tx) => {
    // 1. æ³¨æ–‡ã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜
    const order = await tx.order.create({ data: orderData });
    
    // 2. Outboxãƒ†ãƒ¼ãƒ–ãƒ«ã«å¤–éƒ¨APIå‘¼ã³å‡ºã—ã®ã‚¿ã‚¹ã‚¯ã‚’è¨˜éŒ²
    await tx.outbox.create({
      data: {
        eventType: 'PAYMENT_CHARGE',
        payload: JSON.stringify({ orderId: order.id, amount: orderData.amount }),
        status: 'PENDING',
        idempotencyKey: `payment-${order.id}-${Date.now()}`,
      },
    });
    
    // 3. ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚’ã‚³ãƒŸãƒƒãƒˆï¼ˆå¤–éƒ¨APIã¯å‘¼ã°ãªã„ï¼‰
    return order;
  });
}

// åˆ¥ã®ãƒ—ãƒ­ã‚»ã‚¹/ãƒ¯ãƒ¼ã‚«ãƒ¼ã§Outboxã‚’å‡¦ç†
async function processOutbox() {
  const pendingEvents = await db.outbox.findMany({
    where: { status: 'PENDING' },
    orderBy: { createdAt: 'asc' },
    take: 10,
  });
  
  for (const event of pendingEvents) {
    try {
      // å¤–éƒ¨APIã‚’å‘¼ã¶
      const response = await fetch('https://payment-api.example.com/charge', {
        method: 'POST',
        body: event.payload,
        headers: {
          'Idempotency-Key': event.idempotencyKey,
        },
      });
      
      if (response.ok) {
        // æˆåŠŸã—ãŸã‚‰Outboxã‚’æ›´æ–°
        await db.outbox.update({
          where: { id: event.id },
          data: { status: 'COMPLETED' },
        });
      } else {
        // å¤±æ•—ã—ãŸã‚‰ãƒªãƒˆãƒ©ã‚¤ç”¨ã«æ›´æ–°
        await db.outbox.update({
          where: { id: event.id },
          data: { 
            status: 'FAILED',
            retryCount: { increment: 1 },
          },
        });
      }
    } catch (error) {
      // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
      await db.outbox.update({
        where: { id: event.id },
        data: { 
          status: 'FAILED',
          retryCount: { increment: 1 },
        },
      });
    }
  }
}
```

**ãƒ¡ãƒªãƒƒãƒˆ:**

- ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®çŸ­ç¸®: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒ­ãƒƒã‚¯æ™‚é–“ãŒçŸ­ç¸®ã•ã‚Œã‚‹
- å¤–éƒ¨éšœå®³ã®åˆ†é›¢: å¤–éƒ¨APIã®éšœå®³ãŒãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã«å½±éŸ¿ã—ãªã„
- å†å®Ÿè¡Œã®å®¹æ˜“ã•: Outboxãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰å†å®Ÿè¡Œå¯èƒ½
- å†ªç­‰æ€§ã®ä¿è¨¼: å†ªç­‰ã‚­ãƒ¼ã«ã‚ˆã‚Šé‡è¤‡å®Ÿè¡Œã‚’é˜²æ­¢

### 2. Outboxãƒ‘ã‚¿ãƒ¼ãƒ³ã®å½¹å‰²ã¨ã€ãªãœServerlessç’°å¢ƒã¨ç›¸æ€§ãŒè‰¯ã„ã‹

#### Outboxãƒ‘ã‚¿ãƒ¼ãƒ³ã®å½¹å‰²

**å®šç¾©:**
Outboxãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ã€ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å†…ã§å¤–éƒ¨APIå‘¼ã³å‡ºã—ã‚„éåŒæœŸå‡¦ç†ã‚’è¨˜éŒ²ã—ã€åˆ¥ã®ãƒ—ãƒ­ã‚»ã‚¹ã§å‡¦ç†ã™ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã™ã€‚

**å½¹å‰²:**

1. **ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®åˆ†é›¢**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã¨å¤–éƒ¨APIå‘¼ã³å‡ºã—ã‚’åˆ†é›¢
2. **ç¢ºå®Ÿãªé…ä¿¡**: ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ãŒã‚³ãƒŸãƒƒãƒˆã•ã‚ŒãŸã‚‰ã€ç¢ºå®Ÿã«å¤–éƒ¨APIãŒå‘¼ã°ã‚Œã‚‹
3. **å†å®Ÿè¡Œã®ä¿è¨¼**: å¤±æ•—ã—ãŸå‡¦ç†ã‚’å†å®Ÿè¡Œå¯èƒ½
4. **å†ªç­‰æ€§ã®ä¿è¨¼**: å†ªç­‰ã‚­ãƒ¼ã«ã‚ˆã‚Šé‡è¤‡å®Ÿè¡Œã‚’é˜²æ­¢

#### Serverlessç’°å¢ƒã¨ã®ç›¸æ€§

**ãªãœServerlessç’°å¢ƒã¨ç›¸æ€§ãŒè‰¯ã„ã‹:**

1. **ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•**: Serverlessã¯ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•ã§å‹•ä½œã™ã‚‹ãŸã‚ã€Outboxãƒ†ãƒ¼ãƒ–ãƒ«ã®å¤‰æ›´ã‚’ãƒˆãƒªã‚¬ãƒ¼ã«ã§ãã‚‹
2. **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£**: éœ€è¦ã«å¿œã˜ã¦è‡ªå‹•çš„ã«ã‚¹ã‚±ãƒ¼ãƒ«ã™ã‚‹
3. **ã‚³ã‚¹ãƒˆåŠ¹ç‡**: å‡¦ç†ãŒå¿…è¦ãªæ™‚ã ã‘å®Ÿè¡Œã•ã‚Œã‚‹
4. **éšœå®³è€æ€§**: å€‹åˆ¥ã®é–¢æ•°ãŒå¤±æ•—ã—ã¦ã‚‚ã€ä»–ã®å‡¦ç†ã«å½±éŸ¿ã—ãªã„

**å®Ÿè·µä¾‹ï¼ˆVercelï¼‰:**

```typescript
// Outboxãƒ†ãƒ¼ãƒ–ãƒ«ã®å®šç¾©
CREATE TABLE outbox (
  id SERIAL PRIMARY KEY,
  event_type VARCHAR(100) NOT NULL,
  payload JSONB NOT NULL,
  status VARCHAR(50) NOT NULL DEFAULT 'PENDING',
  idempotency_key VARCHAR(255) UNIQUE NOT NULL,
  retry_count INTEGER DEFAULT 0,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

// Vercel Cronã§Outboxã‚’å‡¦ç†
// vercel.json
{
  "crons": [{
    "path": "/api/process-outbox",
    "schedule": "*/1 * * * *"  // 1åˆ†ã”ã¨
  }]
}

// api/process-outbox.ts
export default async function handler(req: Request) {
  const pendingEvents = await db.outbox.findMany({
    where: { status: 'PENDING' },
    orderBy: { createdAt: 'asc' },
    take: 10,
  });
  
  for (const event of pendingEvents) {
    await processEvent(event);
  }
  
  return Response.json({ processed: pendingEvents.length });
}
```

### 3. Vercelã®åˆ¶ç´„

#### ãƒ—ãƒ­ã‚»ã‚¹å¯¿å‘½ã®åˆ¶ç´„

**åˆ¶ç´„:**

```typescript
// Vercelã®Serverlessé–¢æ•°ã®åˆ¶ç´„
// - å®Ÿè¡Œæ™‚é–“: æœ€å¤§10ç§’ï¼ˆHobbyï¼‰ã€60ç§’ï¼ˆProï¼‰ã€300ç§’ï¼ˆEnterpriseï¼‰
// - ãƒ¡ãƒ¢ãƒª: æœ€å¤§1024MB
// - ãƒ—ãƒ­ã‚»ã‚¹çŠ¶æ…‹: å®Ÿè¡Œé–“ã§ä¿æŒã•ã‚Œãªã„
```

**å•é¡Œã®ã‚ã‚‹å®Ÿè£…:**

```typescript
// âŒ æ‚ªã„ä¾‹: é•·æ™‚é–“å®Ÿè¡ŒãŒå¿…è¦ãªå‡¦ç†
export default async function handler(req: Request) {
  // 10åˆ†ã‹ã‹ã‚‹å‡¦ç†ï¼ˆVercelã§ã¯ä¸å¯èƒ½ï¼‰
  await longRunningProcess();
  
  return Response.json({ success: true });
}
```

**å½±éŸ¿:**

- é•·æ™‚é–“å®Ÿè¡ŒãŒå¿…è¦ãªå‡¦ç†ãŒå®Ÿè¡Œã§ããªã„
- ãƒ—ãƒ­ã‚»ã‚¹çŠ¶æ…‹ã‚’ä¿æŒã§ããªã„
- æ¥ç¶šãƒ—ãƒ¼ãƒ«ãªã©ã®çŠ¶æ…‹ç®¡ç†ãŒå›°é›£

#### å†å®Ÿè¡Œã®ä¸ç¢ºå®Ÿæ€§

**å•é¡Œ:**

```typescript
// Vercelã®Serverlessé–¢æ•°ã¯ã€ä»¥ä¸‹ã®å ´åˆã«å†å®Ÿè¡Œã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹
// 1. ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
// 2. ãƒ¡ãƒ¢ãƒªä¸è¶³
// 3. ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ
// 4. ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®éƒ½åˆ

// å•é¡Œ: å†å®Ÿè¡ŒãŒä¿è¨¼ã•ã‚Œãªã„ã€ã¾ãŸã¯äºˆæœŸã—ãªã„å†å®Ÿè¡ŒãŒç™ºç”Ÿã™ã‚‹
```

**å®Ÿè·µä¾‹:**

```typescript
// âŒ æ‚ªã„ä¾‹: å†ªç­‰æ€§ãŒãªã„å‡¦ç†
export default async function handler(req: Request) {
  // å†ªç­‰ã‚­ãƒ¼ãŒãªã„å ´åˆã€å†å®Ÿè¡Œã§é‡è¤‡å‡¦ç†ãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§
  await processPayment(req.body.orderId);
  
  return Response.json({ success: true });
}

// âœ… è‰¯ã„ä¾‹: å†ªç­‰ã‚­ãƒ¼ã‚’ä½¿ç”¨
export default async function handler(req: Request) {
  const idempotencyKey = req.headers['idempotency-key'];
  
  if (!idempotencyKey) {
    return Response.json({ error: 'Idempotency-Key required' }, { status: 400 });
  }
  
  // å†ªç­‰ã‚­ãƒ¼ã§é‡è¤‡å®Ÿè¡Œã‚’é˜²æ­¢
  const existing = await db.processedEvents.findUnique({
    where: { idempotencyKey },
  });
  
  if (existing) {
    return Response.json({ success: true, cached: true });
  }
  
  await processPayment(req.body.orderId);
  
  await db.processedEvents.create({
    data: { idempotencyKey, result: 'success' },
  });
  
  return Response.json({ success: true });
}
```

#### éåŒæœŸå‡¦ç†ã®ä¸ç¢ºå®Ÿæ€§

**å•é¡Œ:**

```typescript
// Vercelã®Serverlessé–¢æ•°ã¯ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã™ã¨çµ‚äº†ã™ã‚‹
// ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å‡¦ç†ã¯ä¿è¨¼ã•ã‚Œãªã„

// âŒ æ‚ªã„ä¾‹: ãƒ¬ã‚¹ãƒãƒ³ã‚¹å¾Œã«å‡¦ç†ã‚’ç¶šè¡Œ
export default async function handler(req: Request) {
  // ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã™
  const response = Response.json({ success: true });
  
  // ã“ã®å‡¦ç†ã¯å®Ÿè¡Œã•ã‚Œãªã„å¯èƒ½æ€§ãŒã‚ã‚‹
  await sendEmail(req.body.email);
  
  return response;
}
```

**è§£æ±ºç­–:**

```typescript
// âœ… è‰¯ã„ä¾‹: Outboxãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä½¿ç”¨
export default async function handler(req: Request) {
  await db.transaction(async (tx) => {
    await tx.order.create({ data: req.body });
    
    // Outboxã«è¨˜éŒ²
    await tx.outbox.create({
      data: {
        eventType: 'SEND_EMAIL',
        payload: JSON.stringify({ email: req.body.email }),
        status: 'PENDING',
      },
    });
  });
  
  // ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã™ï¼ˆãƒ¡ãƒ¼ãƒ«é€ä¿¡ã¯åˆ¥ãƒ—ãƒ­ã‚»ã‚¹ã§å‡¦ç†ï¼‰
  return Response.json({ success: true });
}
```

### 4. Render.comã®ç‰¹æ€§

#### å¸¸é§ãƒ—ãƒ­ã‚»ã‚¹

**ç‰¹å¾´:**

```typescript
// Render.comã®Webã‚µãƒ¼ãƒ“ã‚¹
// - å¸¸é§ãƒ—ãƒ­ã‚»ã‚¹: 24æ™‚é–“å®Ÿè¡Œã•ã‚Œã‚‹
// - ãƒ—ãƒ­ã‚»ã‚¹çŠ¶æ…‹: ä¿æŒã•ã‚Œã‚‹
// - å®Ÿè¡Œæ™‚é–“: åˆ¶é™ãªã—ï¼ˆå®Ÿè³ªçš„ï¼‰
// - ãƒ¡ãƒ¢ãƒª: ãƒ—ãƒ©ãƒ³ã«å¿œã˜ã¦è¨­å®šå¯èƒ½
```

**ãƒ¡ãƒªãƒƒãƒˆ:**

- é•·æ™‚é–“å®Ÿè¡ŒãŒå¯èƒ½
- ãƒ—ãƒ­ã‚»ã‚¹çŠ¶æ…‹ã‚’ä¿æŒã§ãã‚‹
- æ¥ç¶šãƒ—ãƒ¼ãƒ«ãªã©ã®çŠ¶æ…‹ç®¡ç†ãŒå®¹æ˜“
- ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å‡¦ç†ãŒå¯èƒ½

**å®Ÿè·µä¾‹:**

```typescript
// Render.comã®Webã‚µãƒ¼ãƒ“ã‚¹ã§Outboxã‚’å‡¦ç†
// server.ts
import express from 'express';

const app = express();

// Outboxã‚’å®šæœŸçš„ã«å‡¦ç†
setInterval(async () => {
  const pendingEvents = await db.outbox.findMany({
    where: { status: 'PENDING' },
    orderBy: { createdAt: 'asc' },
    take: 10,
  });
  
  for (const event of pendingEvents) {
    await processEvent(event);
  }
}, 5000); // 5ç§’ã”ã¨

app.listen(3000);
```

#### Worker

**ç‰¹å¾´:**

```typescript
// Render.comã®Workerã‚µãƒ¼ãƒ“ã‚¹
// - å°‚ç”¨ã®ãƒ¯ãƒ¼ã‚«ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹
// - ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£: è¤‡æ•°ã®ãƒ¯ãƒ¼ã‚«ãƒ¼ã‚’å®Ÿè¡Œå¯èƒ½
// - ã‚­ãƒ¥ãƒ¼å‡¦ç†ã¨ã®ç›¸æ€§ãŒè‰¯ã„
```

**å®Ÿè·µä¾‹:**

```typescript
// Render.comã®Workerã§Outboxã‚’å‡¦ç†
// worker.ts
import Bull from 'bull';

const outboxQueue = new Bull('outbox', {
  redis: {
    host: process.env.REDIS_HOST,
    port: parseInt(process.env.REDIS_PORT || '6379'),
  },
});

// Outboxãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ç›£è¦–ã—ã¦ã‚­ãƒ¥ãƒ¼ã«è¿½åŠ 
setInterval(async () => {
  const pendingEvents = await db.outbox.findMany({
    where: { status: 'PENDING' },
    orderBy: { createdAt: 'asc' },
    take: 10,
  });
  
  for (const event of pendingEvents) {
    await outboxQueue.add(event);
  }
}, 5000);

// ã‚­ãƒ¥ãƒ¼ã‹ã‚‰å‡¦ç†
outboxQueue.process(async (job) => {
  const event = job.data;
  await processEvent(event);
});
```

#### ã‚­ãƒ¥ãƒ¼å‡¦ç†ã¨ã®ç›¸æ€§

**å®Ÿè·µä¾‹:**

```typescript
// Render.comã®Workerã¨Bull/BullMQã®çµ„ã¿åˆã‚ã›
import Bull from 'bull';

const paymentQueue = new Bull('payment', {
  redis: {
    host: process.env.REDIS_HOST,
    port: parseInt(process.env.REDIS_PORT || '6379'),
  },
});

// ã‚¸ãƒ§ãƒ–ã®å‡¦ç†
paymentQueue.process(async (job) => {
  const { orderId, amount } = job.data;
  
  // å¤–éƒ¨APIã‚’å‘¼ã¶
  const response = await fetch('https://payment-api.example.com/charge', {
    method: 'POST',
    body: JSON.stringify({ orderId, amount }),
    headers: {
      'Idempotency-Key': job.id, // ã‚¸ãƒ§ãƒ–IDã‚’å†ªç­‰ã‚­ãƒ¼ã¨ã—ã¦ä½¿ç”¨
    },
  });
  
  if (!response.ok) {
    throw new Error('Payment failed');
  }
  
  return { success: true };
});

// ãƒªãƒˆãƒ©ã‚¤è¨­å®š
paymentQueue.on('failed', async (job, err) => {
  if (job.attemptsMade < 3) {
    // 3å›ã¾ã§ãƒªãƒˆãƒ©ã‚¤
    await job.retry();
  } else {
    // 3å›å¤±æ•—ã—ãŸã‚‰ã‚¢ãƒ©ãƒ¼ãƒˆ
    await sendAlert(`Payment failed for order ${job.data.orderId}`);
  }
});
```

### 5. å†ªç­‰ã‚­ãƒ¼ãŒãªã„å ´åˆã«èµ·ã“ã‚Šå¾—ã‚‹äº‹æ•…

#### äº‹æ•…ã®ã‚·ãƒŠãƒªã‚ª

**ã‚·ãƒŠãƒªã‚ª1: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã«ã‚ˆã‚‹é‡è¤‡å®Ÿè¡Œ**

```typescript
// âŒ æ‚ªã„ä¾‹: å†ªç­‰ã‚­ãƒ¼ãŒãªã„
async function chargePayment(orderId: string, amount: number) {
  // å¤–éƒ¨APIã‚’å‘¼ã¶
  const response = await fetch('https://payment-api.example.com/charge', {
    method: 'POST',
    body: JSON.stringify({ orderId, amount }),
  });
  
  // ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ
  // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚¨ãƒ©ãƒ¼ã‚’å—ä¿¡
  // ã—ã‹ã—ã€ã‚µãƒ¼ãƒãƒ¼å´ã§ã¯å‡¦ç†ãŒå®Œäº†ã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹
  
  // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒå†è©¦è¡Œ
  // â†’ é‡è¤‡æ±ºæ¸ˆãŒç™ºç”Ÿ
}
```

**å½±éŸ¿:**

- é‡è¤‡æ±ºæ¸ˆ
- ãƒ‡ãƒ¼ã‚¿ã®ä¸æ•´åˆ
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä¸æº€
- è²¡å‹™çš„ãªæå¤±

**è§£æ±ºç­–:**

```typescript
// âœ… è‰¯ã„ä¾‹: å†ªç­‰ã‚­ãƒ¼ã‚’ä½¿ç”¨
async function chargePayment(orderId: string, amount: number, idempotencyKey: string) {
  // å†ªç­‰ã‚­ãƒ¼ã§é‡è¤‡å®Ÿè¡Œã‚’é˜²æ­¢
  const existing = await db.payments.findUnique({
    where: { idempotencyKey },
  });
  
  if (existing) {
    return existing; // æ—¢ã«å‡¦ç†æ¸ˆã¿
  }
  
  // å¤–éƒ¨APIã‚’å‘¼ã¶ï¼ˆå†ªç­‰ã‚­ãƒ¼ã‚’ãƒ˜ãƒƒãƒ€ãƒ¼ã«å«ã‚ã‚‹ï¼‰
  const response = await fetch('https://payment-api.example.com/charge', {
    method: 'POST',
    body: JSON.stringify({ orderId, amount }),
    headers: {
      'Idempotency-Key': idempotencyKey,
    },
  });
  
  // çµæœã‚’ä¿å­˜
  const payment = await db.payments.create({
    data: {
      orderId,
      amount,
      idempotencyKey,
      status: 'completed',
    },
  });
  
  return payment;
}
```

**ã‚·ãƒŠãƒªã‚ª2: Serverlessé–¢æ•°ã®å†å®Ÿè¡Œ**

```typescript
// Vercelã®Serverlessé–¢æ•°ãŒå†å®Ÿè¡Œã•ã‚Œã‚‹å ´åˆ
// 1. ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
// 2. ãƒ¡ãƒ¢ãƒªä¸è¶³
// 3. ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®éƒ½åˆ

// âŒ æ‚ªã„ä¾‹: å†ªç­‰ã‚­ãƒ¼ãŒãªã„
export default async function handler(req: Request) {
  // å‡¦ç†ãŒå®Œäº†ã™ã‚‹å‰ã«ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
  await longRunningProcess();
  
  // é–¢æ•°ãŒå†å®Ÿè¡Œã•ã‚Œã‚‹
  // â†’ é‡è¤‡å‡¦ç†ãŒç™ºç”Ÿ
}
```

**è§£æ±ºç­–:**

```typescript
// âœ… è‰¯ã„ä¾‹: å†ªç­‰ã‚­ãƒ¼ã‚’ä½¿ç”¨
export default async function handler(req: Request) {
  const idempotencyKey = req.headers['idempotency-key'] || generateIdempotencyKey();
  
  // å†ªç­‰ã‚­ãƒ¼ã§é‡è¤‡å®Ÿè¡Œã‚’é˜²æ­¢
  const existing = await db.processedEvents.findUnique({
    where: { idempotencyKey },
  });
  
  if (existing) {
    return Response.json(existing.result);
  }
  
  const result = await longRunningProcess();
  
  // çµæœã‚’ä¿å­˜
  await db.processedEvents.create({
    data: {
      idempotencyKey,
      result: JSON.stringify(result),
    },
  });
  
  return Response.json(result);
}
```

### 6. æ§‹é€ ã‚’ç›´ã›ã°Vercelã§å•é¡Œãªã„ã‚±ãƒ¼ã‚¹

#### ã‚±ãƒ¼ã‚¹1: Outboxãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å®Ÿè£…ã§ãã‚‹å ´åˆ

**æ¡ä»¶:**

- Outboxãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å®Ÿè£…ã§ãã‚‹
- å‡¦ç†æ™‚é–“ãŒ10ç§’ä»¥å†…ï¼ˆHobbyï¼‰ã€60ç§’ä»¥å†…ï¼ˆProï¼‰ã€300ç§’ä»¥å†…ï¼ˆEnterpriseï¼‰
- å†ªç­‰ã‚­ãƒ¼ã‚’å®Ÿè£…ã§ãã‚‹
- éåŒæœŸå‡¦ç†ãŒVercel Cronã§å‡¦ç†å¯èƒ½

**å®Ÿè·µä¾‹:**

```typescript
// âœ… Vercelã§å•é¡Œãªã„ã‚±ãƒ¼ã‚¹
// 1. Outboxãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å®Ÿè£…
async function createOrder(orderData: OrderData) {
  return await db.transaction(async (tx) => {
    const order = await tx.order.create({ data: orderData });
    
    // Outboxã«è¨˜éŒ²
    await tx.outbox.create({
      data: {
        eventType: 'PAYMENT_CHARGE',
        payload: JSON.stringify({ orderId: order.id, amount: orderData.amount }),
        status: 'PENDING',
        idempotencyKey: `payment-${order.id}-${Date.now()}`,
      },
    });
    
    return order;
  });
}

// 2. Vercel Cronã§Outboxã‚’å‡¦ç†
// vercel.json
{
  "crons": [{
    "path": "/api/process-outbox",
    "schedule": "*/1 * * * *"
  }]
}

// api/process-outbox.ts
export default async function handler(req: Request) {
  const pendingEvents = await db.outbox.findMany({
    where: { status: 'PENDING' },
    orderBy: { createdAt: 'asc' },
    take: 10,
  });
  
  for (const event of pendingEvents) {
    // 10ç§’ä»¥å†…ã§å‡¦ç†å¯èƒ½
    await processEvent(event);
  }
  
  return Response.json({ processed: pendingEvents.length });
}
```

#### ã‚±ãƒ¼ã‚¹2: åŒæœŸå‡¦ç†ã®ã¿ã®å ´åˆ

**æ¡ä»¶:**

- å¤–éƒ¨APIå‘¼ã³å‡ºã—ãŒåŒæœŸå‡¦ç†ã®ã¿
- å‡¦ç†æ™‚é–“ãŒçŸ­ã„ï¼ˆ10ç§’ä»¥å†…ï¼‰
- å†ªç­‰ã‚­ãƒ¼ã‚’å®Ÿè£…ã§ãã‚‹

**å®Ÿè·µä¾‹:**

```typescript
// âœ… Vercelã§å•é¡Œãªã„ã‚±ãƒ¼ã‚¹
export default async function handler(req: Request) {
  const idempotencyKey = req.headers['idempotency-key'];
  
  // å†ªç­‰ã‚­ãƒ¼ã§é‡è¤‡å®Ÿè¡Œã‚’é˜²æ­¢
  const existing = await db.processedEvents.findUnique({
    where: { idempotencyKey },
  });
  
  if (existing) {
    return Response.json(existing.result);
  }
  
  // çŸ­æ™‚é–“ã®åŒæœŸå‡¦ç†
  const result = await shortSyncProcess();
  
  await db.processedEvents.create({
    data: {
      idempotencyKey,
      result: JSON.stringify(result),
    },
  });
  
  return Response.json(result);
}
```

### 7. æ§‹é€ ã‚’ç›´ã—ã¦ã‚‚Vercelã§ã¯å³ã—ã„ã‚±ãƒ¼ã‚¹

#### ã‚±ãƒ¼ã‚¹1: é•·æ™‚é–“å®Ÿè¡ŒãŒå¿…è¦ãªå‡¦ç†

**æ¡ä»¶:**

- å‡¦ç†æ™‚é–“ãŒ10åˆ†ä»¥ä¸Š
- ãƒ—ãƒ­ã‚»ã‚¹çŠ¶æ…‹ã‚’ä¿æŒã™ã‚‹å¿…è¦ãŒã‚ã‚‹
- ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å‡¦ç†ãŒå¿…è¦

**å®Ÿè·µä¾‹:**

```typescript
// âŒ Vercelã§ã¯å›°é›£ãªã‚±ãƒ¼ã‚¹
// 1. é•·æ™‚é–“å®Ÿè¡ŒãŒå¿…è¦ãªå‡¦ç†
async function processLargeFile(fileId: string) {
  // 10åˆ†ã‹ã‹ã‚‹å‡¦ç†
  await processFile(fileId);
  
  // Vercelã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆæœ€å¤§300ç§’ï¼‰ã‚’è¶…ãˆã‚‹
}

// 2. ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å‡¦ç†
async function streamData() {
  // ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å‡¦ç†ã¯Vercelã§ã¯å›°é›£
  const stream = createReadStream('large-file.csv');
  // å‡¦ç†...
}
```

**è§£æ±ºç­–: Render.comã‚’ä½¿ç”¨**

```typescript
// âœ… Render.comã§è§£æ±º
// Render.comã®Webã‚µãƒ¼ãƒ“ã‚¹ã§é•·æ™‚é–“å®Ÿè¡Œ
app.post('/api/process-large-file', async (req, res) => {
  const { fileId } = req.body;
  
  // ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§å‡¦ç†
  processLargeFile(fileId).then(() => {
    // å®Œäº†é€šçŸ¥
  });
  
  res.json({ status: 'processing' });
});
```

#### ã‚±ãƒ¼ã‚¹2: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å‡¦ç†ãŒå¿…è¦ãªå ´åˆ

**æ¡ä»¶:**

- WebSocketæ¥ç¶šãŒå¿…è¦
- é•·æ™‚é–“ã®æ¥ç¶šã‚’ä¿æŒã™ã‚‹å¿…è¦ãŒã‚ã‚‹
- ãƒ—ãƒ­ã‚»ã‚¹çŠ¶æ…‹ã‚’ä¿æŒã™ã‚‹å¿…è¦ãŒã‚ã‚‹

**å®Ÿè·µä¾‹:**

```typescript
// âŒ Vercelã§ã¯å›°é›£ãªã‚±ãƒ¼ã‚¹
// WebSocketæ¥ç¶šã¯Vercelã§ã¯å›°é›£
import { WebSocketServer } from 'ws';

const wss = new WebSocketServer({ port: 8080 });

wss.on('connection', (ws) => {
  // é•·æ™‚é–“ã®æ¥ç¶šã‚’ä¿æŒ
  // Vercelã®Serverlessé–¢æ•°ã§ã¯å›°é›£
});
```

**è§£æ±ºç­–: Render.comã‚’ä½¿ç”¨**

```typescript
// âœ… Render.comã§è§£æ±º
// Render.comã®Webã‚µãƒ¼ãƒ“ã‚¹ã§WebSocket
import { WebSocketServer } from 'ws';

const wss = new WebSocketServer({ port: 8080 });

wss.on('connection', (ws) => {
  // é•·æ™‚é–“ã®æ¥ç¶šã‚’ä¿æŒå¯èƒ½
  ws.on('message', (message) => {
    // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‡¦ç†
  });
});
```

#### ã‚±ãƒ¼ã‚¹3: è¤‡é›‘ãªã‚­ãƒ¥ãƒ¼å‡¦ç†ãŒå¿…è¦ãªå ´åˆ

**æ¡ä»¶:**

- å„ªå…ˆåº¦ä»˜ãã‚­ãƒ¥ãƒ¼
- é…å»¶å®Ÿè¡Œ
- è¤‡é›‘ãªãƒªãƒˆãƒ©ã‚¤ãƒ­ã‚¸ãƒƒã‚¯

**å®Ÿè·µä¾‹:**

```typescript
// âŒ Vercelã§ã¯å›°é›£ãªã‚±ãƒ¼ã‚¹
// è¤‡é›‘ãªã‚­ãƒ¥ãƒ¼å‡¦ç†ã¯Vercel Cronã§ã¯å›°é›£
// - å„ªå…ˆåº¦ä»˜ãã‚­ãƒ¥ãƒ¼
// - é…å»¶å®Ÿè¡Œ
// - è¤‡é›‘ãªãƒªãƒˆãƒ©ã‚¤ãƒ­ã‚¸ãƒƒã‚¯
```

**è§£æ±ºç­–: Render.comã‚’ä½¿ç”¨**

```typescript
// âœ… Render.comã§è§£æ±º
// Render.comã®Workerã§Bull/BullMQã‚’ä½¿ç”¨
import Bull from 'bull';

const queue = new Bull('tasks', {
  redis: {
    host: process.env.REDIS_HOST,
    port: parseInt(process.env.REDIS_PORT || '6379'),
  },
});

// å„ªå…ˆåº¦ä»˜ãã‚­ãƒ¥ãƒ¼
queue.add({ task: 'high-priority' }, { priority: 1 });
queue.add({ task: 'low-priority' }, { priority: 10 });

// é…å»¶å®Ÿè¡Œ
queue.add({ task: 'delayed' }, { delay: 60000 }); // 1åˆ†å¾Œ

// è¤‡é›‘ãªãƒªãƒˆãƒ©ã‚¤ãƒ­ã‚¸ãƒƒã‚¯
queue.process(async (job) => {
  try {
    await processTask(job.data);
  } catch (error) {
    if (job.attemptsMade < 3) {
      throw error; // ãƒªãƒˆãƒ©ã‚¤
    } else {
      // 3å›å¤±æ•—ã—ãŸã‚‰åˆ¥ã®ã‚­ãƒ¥ãƒ¼ã«ç§»å‹•
      await failedQueue.add(job.data);
    }
  }
});
```

### 8. Render.comï¼ˆã¾ãŸã¯å¸¸é§ç’°å¢ƒï¼‰ã‚’é¸ã¶ã¹ãåˆ¤æ–­åŸºæº–

#### åˆ¤æ–­åŸºæº–

**1. å‡¦ç†æ™‚é–“ãŒé•·ã„ï¼ˆ5åˆ†ä»¥ä¸Šï¼‰**

```typescript
// åˆ¤æ–­åŸºæº–: å‡¦ç†æ™‚é–“ãŒ5åˆ†ä»¥ä¸Š
// â†’ Render.comã‚’é¸ã¶

// ä¾‹: å¤§å®¹é‡ãƒ•ã‚¡ã‚¤ãƒ«ã®å‡¦ç†
async function processLargeFile(fileId: string) {
  // 10åˆ†ã‹ã‹ã‚‹å‡¦ç†
  await processFile(fileId);
}
```

**2. ãƒ—ãƒ­ã‚»ã‚¹çŠ¶æ…‹ã‚’ä¿æŒã™ã‚‹å¿…è¦ãŒã‚ã‚‹**

```typescript
// åˆ¤æ–­åŸºæº–: ãƒ—ãƒ­ã‚»ã‚¹çŠ¶æ…‹ã‚’ä¿æŒã™ã‚‹å¿…è¦ãŒã‚ã‚‹
// â†’ Render.comã‚’é¸ã¶

// ä¾‹: æ¥ç¶šãƒ—ãƒ¼ãƒ«ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
const connectionPool = new ConnectionPool();

// ãƒ—ãƒ­ã‚»ã‚¹é–“ã§çŠ¶æ…‹ã‚’ä¿æŒ
app.use((req, res, next) => {
  req.db = connectionPool.getConnection();
  next();
});
```

**3. ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å‡¦ç†ãŒå¿…è¦**

```typescript
// åˆ¤æ–­åŸºæº–: WebSocketã€Server-Sent EventsãŒå¿…è¦
// â†’ Render.comã‚’é¸ã¶

// ä¾‹: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒãƒ£ãƒƒãƒˆ
const wss = new WebSocketServer({ port: 8080 });
wss.on('connection', (ws) => {
  // é•·æ™‚é–“ã®æ¥ç¶šã‚’ä¿æŒ
});
```

**4. è¤‡é›‘ãªã‚­ãƒ¥ãƒ¼å‡¦ç†ãŒå¿…è¦**

```typescript
// åˆ¤æ–­åŸºæº–: å„ªå…ˆåº¦ä»˜ãã‚­ãƒ¥ãƒ¼ã€é…å»¶å®Ÿè¡Œã€è¤‡é›‘ãªãƒªãƒˆãƒ©ã‚¤ãƒ­ã‚¸ãƒƒã‚¯
// â†’ Render.comã‚’é¸ã¶

// ä¾‹: Bull/BullMQã‚’ä½¿ç”¨ã—ãŸã‚­ãƒ¥ãƒ¼å‡¦ç†
const queue = new Bull('tasks');
queue.add({ task: 'high-priority' }, { priority: 1 });
```

**5. ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å†…ã§å¤–éƒ¨APIã‚’å‘¼ã¶å¿…è¦ãŒã‚ã‚‹ï¼ˆæ§‹é€ æ”¹å–„ãŒå›°é›£ï¼‰**

```typescript
// åˆ¤æ–­åŸºæº–: æ§‹é€ æ”¹å–„ãŒå›°é›£ã§ã€ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å†…ã§å¤–éƒ¨APIã‚’å‘¼ã¶å¿…è¦ãŒã‚ã‚‹
// â†’ Render.comã‚’é¸ã¶

// ä¾‹: ãƒ¬ã‚¬ã‚·ãƒ¼ã‚³ãƒ¼ãƒ‰ã®ç§»è¡ŒãŒå›°é›£
async function legacyFunction() {
  return await db.transaction(async (tx) => {
    // æ§‹é€ æ”¹å–„ãŒå›°é›£ãªå ´åˆ
    const result = await externalAPI.call();
    // ...
  });
}
```

### 9. æ®µéšçš„ãªæ”¹å–„ã‚¹ãƒ†ãƒƒãƒ—ï¼ˆå…¨ç§»è¡Œã—ãªã„ç¾å®Ÿè§£ï¼‰

#### ã‚¹ãƒ†ãƒƒãƒ—1: ç¾çŠ¶åˆ†æã¨å„ªå…ˆåº¦ä»˜ã‘

**å®Ÿæ–½å†…å®¹:**

```typescript
// 1. ç¾çŠ¶ã®ã‚³ãƒ¼ãƒ‰ã‚’åˆ†æ
// - ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å†…ã§å¤–éƒ¨APIã‚’å‘¼ã‚“ã§ã„ã‚‹ç®‡æ‰€ã‚’ç‰¹å®š
// - å‡¦ç†æ™‚é–“ãŒé•·ã„ç®‡æ‰€ã‚’ç‰¹å®š
// - å†ªç­‰ã‚­ãƒ¼ãŒãªã„ç®‡æ‰€ã‚’ç‰¹å®š

// 2. å„ªå…ˆåº¦ã‚’æ±ºå®š
const priorities = [
  { issue: 'ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å†…ã§å¤–éƒ¨APIã‚’å‘¼ã¶', priority: 'HIGH' },
  { issue: 'å†ªç­‰ã‚­ãƒ¼ãŒãªã„', priority: 'HIGH' },
  { issue: 'å‡¦ç†æ™‚é–“ãŒé•·ã„', priority: 'MEDIUM' },
  { issue: 'ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒä¸ååˆ†', priority: 'MEDIUM' },
];
```

#### ã‚¹ãƒ†ãƒƒãƒ—2: ç·Šæ€¥åº¦ã®é«˜ã„ç®‡æ‰€ã‹ã‚‰æ”¹å–„

**å®Ÿæ–½å†…å®¹:**

```typescript
// 1. ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å†…ã§å¤–éƒ¨APIã‚’å‘¼ã‚“ã§ã„ã‚‹ç®‡æ‰€ã‚’Outboxãƒ‘ã‚¿ãƒ¼ãƒ³ã«å¤‰æ›´
// ä¾‹: æ±ºæ¸ˆå‡¦ç†
async function createOrder(orderData: OrderData) {
  return await db.transaction(async (tx) => {
    const order = await tx.order.create({ data: orderData });
    
    // Outboxã«è¨˜éŒ²
    await tx.outbox.create({
      data: {
        eventType: 'PAYMENT_CHARGE',
        payload: JSON.stringify({ orderId: order.id, amount: orderData.amount }),
        status: 'PENDING',
        idempotencyKey: `payment-${order.id}-${Date.now()}`,
      },
    });
    
    return order;
  });
}

// 2. å†ªç­‰ã‚­ãƒ¼ã‚’è¿½åŠ 
// ã™ã¹ã¦ã®å¤–éƒ¨APIå‘¼ã³å‡ºã—ã«å†ªç­‰ã‚­ãƒ¼ã‚’è¿½åŠ 
async function callExternalAPI(data: any, idempotencyKey: string) {
  const response = await fetch('https://api.example.com/endpoint', {
    method: 'POST',
    body: JSON.stringify(data),
    headers: {
      'Idempotency-Key': idempotencyKey,
    },
  });
  
  return response.json();
}
```

#### ã‚¹ãƒ†ãƒƒãƒ—3: Vercel Cronã§Outboxã‚’å‡¦ç†

**å®Ÿæ–½å†…å®¹:**

```typescript
// 1. Vercel Cronã‚’è¨­å®š
// vercel.json
{
  "crons": [{
    "path": "/api/process-outbox",
    "schedule": "*/1 * * * *"  // 1åˆ†ã”ã¨
  }]
}

// 2. Outboxå‡¦ç†é–¢æ•°ã‚’å®Ÿè£…
// api/process-outbox.ts
export default async function handler(req: Request) {
  const pendingEvents = await db.outbox.findMany({
    where: { status: 'PENDING' },
    orderBy: { createdAt: 'asc' },
    take: 10,
  });
  
  for (const event of pendingEvents) {
    try {
      await processEvent(event);
    } catch (error) {
      // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
      await db.outbox.update({
        where: { id: event.id },
        data: { 
          status: 'FAILED',
          retryCount: { increment: 1 },
        },
      });
    }
  }
  
  return Response.json({ processed: pendingEvents.length });
}
```

#### ã‚¹ãƒ†ãƒƒãƒ—4: å›°é›£ãªç®‡æ‰€ã‚’Render.comã«ç§»è¡Œ

**å®Ÿæ–½å†…å®¹:**

```typescript
// 1. é•·æ™‚é–“å®Ÿè¡ŒãŒå¿…è¦ãªå‡¦ç†ã‚’Render.comã«ç§»è¡Œ
// Render.comã®Webã‚µãƒ¼ãƒ“ã‚¹ã§å‡¦ç†
app.post('/api/process-large-file', async (req, res) => {
  const { fileId } = req.body;
  
  // ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§å‡¦ç†
  processLargeFile(fileId).then(() => {
    // å®Œäº†é€šçŸ¥
  });
  
  res.json({ status: 'processing' });
});

// 2. Vercelã‹ã‚‰Render.comã®APIã‚’å‘¼ã¶
// api/process-file.ts
export default async function handler(req: Request) {
  const { fileId } = await req.json();
  
  // Render.comã®APIã‚’å‘¼ã¶
  const response = await fetch('https://your-app.onrender.com/api/process-large-file', {
    method: 'POST',
    body: JSON.stringify({ fileId }),
  });
  
  return Response.json(await response.json());
}
```

#### ã‚¹ãƒ†ãƒƒãƒ—5: ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ§‹æˆ

**å®Ÿæ–½å†…å®¹:**

```typescript
// 1. Vercel: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã€APIã€çŸ­æ™‚é–“å‡¦ç†
// - ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: Next.js
// - API: çŸ­æ™‚é–“ã®åŒæœŸå‡¦ç†
// - Outboxå‡¦ç†: Vercel Cron

// 2. Render.com: é•·æ™‚é–“å‡¦ç†ã€ã‚­ãƒ¥ãƒ¼å‡¦ç†
// - é•·æ™‚é–“å®Ÿè¡ŒãŒå¿…è¦ãªå‡¦ç†
// - ã‚­ãƒ¥ãƒ¼å‡¦ç†ï¼ˆBull/BullMQï¼‰
// - WebSocketæ¥ç¶š

// 3. é€£æºæ–¹æ³•
// - Vercelã‹ã‚‰Render.comã®APIã‚’å‘¼ã¶
// - Render.comã‹ã‚‰Vercelã®APIã‚’å‘¼ã¶
// - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’å…±æœ‰
```

### Vercelå‘ã / ä¸å‘ãã®æ•´ç†

#### Vercelå‘ã

**æ¡ä»¶:**

- å‡¦ç†æ™‚é–“ãŒçŸ­ã„ï¼ˆ10ç§’ä»¥å†…ã€Hobbyï¼‰
- åŒæœŸå‡¦ç†ã®ã¿
- Outboxãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å®Ÿè£…ã§ãã‚‹
- å†ªç­‰ã‚­ãƒ¼ã‚’å®Ÿè£…ã§ãã‚‹
- ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£ãŒé‡è¦
- ã‚³ã‚¹ãƒˆã‚’æŠ‘ãˆãŸã„

**å®Ÿè·µä¾‹:**

```typescript
// âœ… Vercelå‘ã
// 1. çŸ­æ™‚é–“ã®åŒæœŸå‡¦ç†
export default async function handler(req: Request) {
  const result = await shortSyncProcess();
  return Response.json(result);
}

// 2. Outboxãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å®Ÿè£…ã—ãŸéåŒæœŸå‡¦ç†
export default async function handler(req: Request) {
  await db.transaction(async (tx) => {
    await tx.order.create({ data: req.body });
    await tx.outbox.create({ data: { eventType: 'SEND_EMAIL', ... } });
  });
  return Response.json({ success: true });
}
```

#### Vercelä¸å‘ã

**æ¡ä»¶:**

- å‡¦ç†æ™‚é–“ãŒé•·ã„ï¼ˆ5åˆ†ä»¥ä¸Šï¼‰
- ãƒ—ãƒ­ã‚»ã‚¹çŠ¶æ…‹ã‚’ä¿æŒã™ã‚‹å¿…è¦ãŒã‚ã‚‹
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å‡¦ç†ãŒå¿…è¦
- è¤‡é›‘ãªã‚­ãƒ¥ãƒ¼å‡¦ç†ãŒå¿…è¦
- ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å†…ã§å¤–éƒ¨APIã‚’å‘¼ã¶å¿…è¦ãŒã‚ã‚‹ï¼ˆæ§‹é€ æ”¹å–„ãŒå›°é›£ï¼‰

**å®Ÿè·µä¾‹:**

```typescript
// âŒ Vercelä¸å‘ã
// 1. é•·æ™‚é–“å®Ÿè¡ŒãŒå¿…è¦ãªå‡¦ç†
export default async function handler(req: Request) {
  // 10åˆ†ã‹ã‹ã‚‹å‡¦ç†ï¼ˆVercelã§ã¯ä¸å¯èƒ½ï¼‰
  await longRunningProcess();
  return Response.json({ success: true });
}

// 2. WebSocketæ¥ç¶š
const wss = new WebSocketServer({ port: 8080 });
// Vercelã§ã¯å›°é›£
```

### Render.comå‘ã / ä¸å‘ãã®æ•´ç†

#### Render.comå‘ã

**æ¡ä»¶:**

- å‡¦ç†æ™‚é–“ãŒé•·ã„ï¼ˆ5åˆ†ä»¥ä¸Šï¼‰
- ãƒ—ãƒ­ã‚»ã‚¹çŠ¶æ…‹ã‚’ä¿æŒã™ã‚‹å¿…è¦ãŒã‚ã‚‹
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å‡¦ç†ãŒå¿…è¦
- è¤‡é›‘ãªã‚­ãƒ¥ãƒ¼å‡¦ç†ãŒå¿…è¦
- ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å†…ã§å¤–éƒ¨APIã‚’å‘¼ã¶å¿…è¦ãŒã‚ã‚‹ï¼ˆæ§‹é€ æ”¹å–„ãŒå›°é›£ï¼‰

**å®Ÿè·µä¾‹:**

```typescript
// âœ… Render.comå‘ã
// 1. é•·æ™‚é–“å®Ÿè¡ŒãŒå¿…è¦ãªå‡¦ç†
app.post('/api/process-large-file', async (req, res) => {
  const { fileId } = req.body;
  await processLargeFile(fileId); // 10åˆ†ã‹ã‹ã‚‹å‡¦ç†
  res.json({ success: true });
});

// 2. WebSocketæ¥ç¶š
const wss = new WebSocketServer({ port: 8080 });
wss.on('connection', (ws) => {
  // é•·æ™‚é–“ã®æ¥ç¶šã‚’ä¿æŒ
});
```

#### Render.comä¸å‘ã

**æ¡ä»¶:**

- ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£ãŒæœ€é‡è¦
- ã‚³ã‚¹ãƒˆã‚’æœ€å°é™ã«æŠ‘ãˆãŸã„
- çŸ­æ™‚é–“ã®åŒæœŸå‡¦ç†ã®ã¿
- ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ãŒä¸å®‰å®š

**å®Ÿè·µä¾‹:**

```typescript
// âŒ Render.comä¸å‘ã
// 1. çŸ­æ™‚é–“ã®åŒæœŸå‡¦ç†ã®ã¿ï¼ˆVercelã®æ–¹ãŒé©ã—ã¦ã„ã‚‹ï¼‰
app.get('/api/health', (req, res) => {
  res.json({ status: 'ok' });
});
```

### æ¨å¥¨ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ§‹æˆ

#### ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ§‹æˆï¼ˆæ¨å¥¨ï¼‰

**æ§‹æˆ:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Vercel        â”‚
â”‚   - Frontend    â”‚
â”‚   - API Routes  â”‚
â”‚   - Cron Jobs   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ HTTP API
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Render.com    â”‚
â”‚   - Web Service â”‚
â”‚   - Workers     â”‚
â”‚   - Queue       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Database      â”‚
â”‚   - PostgreSQL  â”‚
â”‚   - Redis       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®Ÿè£…ä¾‹:**

```typescript
// Vercel: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¨API
// app/api/orders/route.ts
export async function POST(req: Request) {
  const orderData = await req.json();
  
  // Outboxãƒ‘ã‚¿ãƒ¼ãƒ³ã§è¨˜éŒ²
  const order = await db.transaction(async (tx) => {
    const order = await tx.order.create({ data: orderData });
    await tx.outbox.create({
      data: {
        eventType: 'PROCESS_ORDER',
        payload: JSON.stringify({ orderId: order.id }),
        status: 'PENDING',
        idempotencyKey: `order-${order.id}`,
      },
    });
    return order;
  });
  
  return Response.json(order);
}

// Vercel Cron: Outboxå‡¦ç†
// api/process-outbox.ts
export default async function handler(req: Request) {
  const pendingEvents = await db.outbox.findMany({
    where: { status: 'PENDING' },
    take: 10,
  });
  
  for (const event of pendingEvents) {
    // Render.comã®APIã‚’å‘¼ã¶ï¼ˆé•·æ™‚é–“å‡¦ç†ãŒå¿…è¦ãªå ´åˆï¼‰
    if (event.eventType === 'PROCESS_LARGE_FILE') {
      await fetch('https://your-app.onrender.com/api/process', {
        method: 'POST',
        body: event.payload,
      });
    } else {
      // çŸ­æ™‚é–“å‡¦ç†ã¯Vercelã§å‡¦ç†
      await processEvent(event);
    }
  }
  
  return Response.json({ processed: pendingEvents.length });
}

// Render.com: é•·æ™‚é–“å‡¦ç†ã¨ã‚­ãƒ¥ãƒ¼
// server.ts
import express from 'express';
import Bull from 'bull';

const app = express();
const queue = new Bull('tasks', {
  redis: {
    host: process.env.REDIS_HOST,
    port: parseInt(process.env.REDIS_PORT || '6379'),
  },
});

// é•·æ™‚é–“å‡¦ç†
app.post('/api/process', async (req, res) => {
  const { orderId } = req.body;
  
  // ã‚­ãƒ¥ãƒ¼ã«è¿½åŠ 
  await queue.add({ orderId }, {
    attempts: 3,
    backoff: {
      type: 'exponential',
      delay: 2000,
    },
  });
  
  res.json({ status: 'queued' });
});

// ã‚­ãƒ¥ãƒ¼å‡¦ç†
queue.process(async (job) => {
  const { orderId } = job.data;
  
  // é•·æ™‚é–“å‡¦ç†
  await processOrder(orderId);
});
```

### ä»Šã™ãã‚„ã‚‹ã¹ãå¯¾å¿œï¼ˆå„ªå…ˆåº¦é †ï¼‰

#### å„ªå…ˆåº¦1: ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å†…ã®å¤–éƒ¨APIå‘¼ã³å‡ºã—ã‚’æ’é™¤

**å®Ÿæ–½å†…å®¹:**

```typescript
// 1. ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å†…ã§å¤–éƒ¨APIã‚’å‘¼ã‚“ã§ã„ã‚‹ç®‡æ‰€ã‚’ç‰¹å®š
// 2. Outboxãƒ‘ã‚¿ãƒ¼ãƒ³ã«å¤‰æ›´
// 3. å†ªç­‰ã‚­ãƒ¼ã‚’è¿½åŠ 

// ä¾‹: æ±ºæ¸ˆå‡¦ç†
async function createOrder(orderData: OrderData) {
  return await db.transaction(async (tx) => {
    const order = await tx.order.create({ data: orderData });
    
    // Outboxã«è¨˜éŒ²
    await tx.outbox.create({
      data: {
        eventType: 'PAYMENT_CHARGE',
        payload: JSON.stringify({ orderId: order.id, amount: orderData.amount }),
        status: 'PENDING',
        idempotencyKey: `payment-${order.id}-${Date.now()}`,
      },
    });
    
    return order;
  });
}
```

#### å„ªå…ˆåº¦2: å†ªç­‰ã‚­ãƒ¼ã®å®Ÿè£…

**å®Ÿæ–½å†…å®¹:**

```typescript
// 1. ã™ã¹ã¦ã®å¤–éƒ¨APIå‘¼ã³å‡ºã—ã«å†ªç­‰ã‚­ãƒ¼ã‚’è¿½åŠ 
// 2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«å†ªç­‰ã‚­ãƒ¼ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä½œæˆ
// 3. é‡è¤‡å®Ÿè¡Œã‚’é˜²æ­¢

// ä¾‹: å†ªç­‰ã‚­ãƒ¼ã®å®Ÿè£…
async function callExternalAPI(data: any, idempotencyKey: string) {
  // æ—¢ã«å‡¦ç†æ¸ˆã¿ã‹ç¢ºèª
  const existing = await db.processedEvents.findUnique({
    where: { idempotencyKey },
  });
  
  if (existing) {
    return existing.result;
  }
  
  // å¤–éƒ¨APIã‚’å‘¼ã¶
  const response = await fetch('https://api.example.com/endpoint', {
    method: 'POST',
    body: JSON.stringify(data),
    headers: {
      'Idempotency-Key': idempotencyKey,
    },
  });
  
  const result = await response.json();
  
  // çµæœã‚’ä¿å­˜
  await db.processedEvents.create({
    data: {
      idempotencyKey,
      result: JSON.stringify(result),
    },
  });
  
  return result;
}
```

#### å„ªå…ˆåº¦3: Outboxå‡¦ç†ã®å®Ÿè£…

**å®Ÿæ–½å†…å®¹:**

```typescript
// 1. Outboxãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆ
CREATE TABLE outbox (
  id SERIAL PRIMARY KEY,
  event_type VARCHAR(100) NOT NULL,
  payload JSONB NOT NULL,
  status VARCHAR(50) NOT NULL DEFAULT 'PENDING',
  idempotency_key VARCHAR(255) UNIQUE NOT NULL,
  retry_count INTEGER DEFAULT 0,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_outbox_status ON outbox(status);
CREATE INDEX idx_outbox_idempotency ON outbox(idempotency_key);

// 2. Vercel Cronã§Outboxã‚’å‡¦ç†
// vercel.json
{
  "crons": [{
    "path": "/api/process-outbox",
    "schedule": "*/1 * * * *"
  }]
}

// 3. Outboxå‡¦ç†é–¢æ•°ã‚’å®Ÿè£…
// api/process-outbox.ts
export default async function handler(req: Request) {
  const pendingEvents = await db.outbox.findMany({
    where: { status: 'PENDING' },
    orderBy: { createdAt: 'asc' },
    take: 10,
  });
  
  for (const event of pendingEvents) {
    try {
      await processEvent(event);
      
      await db.outbox.update({
        where: { id: event.id },
        data: { status: 'COMPLETED' },
      });
    } catch (error) {
      await db.outbox.update({
        where: { id: event.id },
        data: { 
          status: 'FAILED',
          retryCount: { increment: 1 },
        },
      });
    }
  }
  
  return Response.json({ processed: pendingEvents.length });
}
```

#### å„ªå…ˆåº¦4: é•·æ™‚é–“å‡¦ç†ã®åˆ†é›¢

**å®Ÿæ–½å†…å®¹:**

```typescript
// 1. é•·æ™‚é–“å‡¦ç†ãŒå¿…è¦ãªç®‡æ‰€ã‚’ç‰¹å®š
// 2. Render.comã«ç§»è¡Œã™ã‚‹ã‹ã€éåŒæœŸå‡¦ç†ã«å¤‰æ›´

// ä¾‹: å¤§å®¹é‡ãƒ•ã‚¡ã‚¤ãƒ«ã®å‡¦ç†
// Vercelã‹ã‚‰Render.comã®APIã‚’å‘¼ã¶
export default async function handler(req: Request) {
  const { fileId } = await req.json();
  
  // Render.comã®APIã‚’å‘¼ã¶
  const response = await fetch('https://your-app.onrender.com/api/process-large-file', {
    method: 'POST',
    body: JSON.stringify({ fileId }),
  });
  
  return Response.json(await response.json());
}
```

#### å„ªå…ˆåº¦5: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¨ãƒªãƒˆãƒ©ã‚¤ã®å®Ÿè£…

**å®Ÿæ–½å†…å®¹:**

```typescript
// 1. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’å®Ÿè£…
// 2. ãƒªãƒˆãƒ©ã‚¤ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…
// 3. ã‚¢ãƒ©ãƒ¼ãƒˆã‚’è¨­å®š

// ä¾‹: ãƒªãƒˆãƒ©ã‚¤ãƒ­ã‚¸ãƒƒã‚¯
async function processEvent(event: OutboxEvent) {
  const maxRetries = 3;
  
  for (let i = 0; i < maxRetries; i++) {
    try {
      await callExternalAPI(JSON.parse(event.payload), event.idempotencyKey);
      return;
    } catch (error) {
      if (i === maxRetries - 1) {
        // æœ€å¤§ãƒªãƒˆãƒ©ã‚¤å›æ•°ã«é”ã—ãŸã‚‰ã‚¢ãƒ©ãƒ¼ãƒˆ
        await sendAlert(`Failed to process event ${event.id} after ${maxRetries} retries`);
        throw error;
      }
      
      // æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ã§ãƒªãƒˆãƒ©ã‚¤
      await sleep(Math.pow(2, i) * 1000);
    }
  }
}
```

### ã¾ã¨ã‚

Vercelã¨Render.comã®æ¯”è¼ƒè©•ä¾¡ã®ãƒã‚¤ãƒ³ãƒˆï¼š

- **çµè«–**: Vercelã¯é©åˆ‡ãªè¨­è¨ˆã«ã‚ˆã‚Šä¸€éƒ¨ã®å•é¡Œã¯è§£æ±ºã§ãã‚‹ãŒã€ãƒ—ãƒ­ã‚»ã‚¹å¯¿å‘½ã®åˆ¶ç´„ã«ã‚ˆã‚ŠRender.comãŒé©åˆ‡ãªã‚±ãƒ¼ã‚¹ãŒã‚ã‚‹
- **åˆ¤æ–­ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ**: ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã€å‡¦ç†æ™‚é–“ã€ãƒ—ãƒ­ã‚»ã‚¹çŠ¶æ…‹ã€Outboxãƒ‘ã‚¿ãƒ¼ãƒ³ã€ã‚³ã‚¹ãƒˆã€ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£ã‚’è€ƒæ…®
- **Vercelå‘ã**: çŸ­æ™‚é–“å‡¦ç†ã€Outboxãƒ‘ã‚¿ãƒ¼ãƒ³å®Ÿè£…å¯èƒ½ã€ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£é‡è¦–
- **Render.comå‘ã**: é•·æ™‚é–“å‡¦ç†ã€ãƒ—ãƒ­ã‚»ã‚¹çŠ¶æ…‹ä¿æŒã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å‡¦ç†ã€è¤‡é›‘ãªã‚­ãƒ¥ãƒ¼å‡¦ç†
- **æ¨å¥¨ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**: ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ§‹æˆï¼ˆVercel + Render.comï¼‰
- **ä»Šã™ãã‚„ã‚‹ã¹ãå¯¾å¿œ**: ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å†…ã®å¤–éƒ¨APIå‘¼ã³å‡ºã—ã‚’æ’é™¤ã€å†ªç­‰ã‚­ãƒ¼ã®å®Ÿè£…ã€Outboxå‡¦ç†ã®å®Ÿè£…ã€é•·æ™‚é–“å‡¦ç†ã®åˆ†é›¢ã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¨ãƒªãƒˆãƒ©ã‚¤ã®å®Ÿè£…

é©åˆ‡ãªè¨­è¨ˆã¨å®Ÿè¡Œç’°å¢ƒã®é¸æŠã«ã‚ˆã‚Šã€åŠ¹ç‡çš„ã§å®‰å…¨ãªã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã§ãã¾ã™ã€‚

