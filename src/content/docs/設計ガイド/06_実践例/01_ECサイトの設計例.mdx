---
title: "ECã‚µã‚¤ãƒˆã®è¨­è¨ˆä¾‹"
label: "ECã‚µã‚¤ãƒˆã®è¨­è¨ˆä¾‹"
---

## ğŸ›’ ECã‚µã‚¤ãƒˆã®è¨­è¨ˆä¾‹

å®Ÿéš›ã®ECã‚µã‚¤ãƒˆã‚’ä¾‹ã«ã€`APIè¨­è¨ˆ`ã€`ãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆ`ã€`ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³è¨­è¨ˆ`ã‚’èª¬æ˜ã—ã¾ã™ã€‚

### ğŸ“‹ è¦ä»¶å®šç¾©

#### âœ… æ©Ÿèƒ½è¦ä»¶

- ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ï¼ˆç™»éŒ²ã€ãƒ­ã‚°ã‚¤ãƒ³ã€ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ï¼‰
- ğŸ“¦ å•†å“ç®¡ç†ï¼ˆå•†å“ä¸€è¦§ã€å•†å“è©³ç´°ã€æ¤œç´¢ï¼‰
- ğŸ›’ æ³¨æ–‡ç®¡ç†ï¼ˆã‚«ãƒ¼ãƒˆã€æ³¨æ–‡ã€æ±ºæ¸ˆï¼‰
- ğŸ“Š åœ¨åº«ç®¡ç†ï¼ˆåœ¨åº«ç¢ºèªã€åœ¨åº«æ›´æ–°ï¼‰

### ğŸŒ APIè¨­è¨ˆ

#### ğŸ‘¤ 1. ãƒ¦ãƒ¼ã‚¶ãƒ¼API

```javascript
// ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²
POST /api/v1/users
{
  "username": "john_doe",
  "email": "john@example.com",
  "password": "password123"
}

// ãƒ¦ãƒ¼ã‚¶ãƒ¼å–å¾—
GET /api/v1/users/:id

// ãƒ¦ãƒ¼ã‚¶ãƒ¼æ›´æ–°
PUT /api/v1/users/:id
{
  "name": "John Doe",
  "email": "john@example.com"
}
```

#### 2. å•†å“API

```javascript
// å•†å“ä¸€è¦§
GET /api/v1/products?page=1&limit=20&category=electronics

// å•†å“è©³ç´°
GET /api/v1/products/:id

// å•†å“æ¤œç´¢
GET /api/v1/products/search?q=laptop
```

#### 3. æ³¨æ–‡API

```javascript
// ã‚«ãƒ¼ãƒˆè¿½åŠ 
POST /api/v1/cart/items
{
  "product_id": 1,
  "quantity": 2
}

// æ³¨æ–‡ä½œæˆ
POST /api/v1/orders
{
  "items": [
    { "product_id": 1, "quantity": 2 },
    { "product_id": 2, "quantity": 1 }
  ],
  "shipping_address": "...",
  "payment_method": "credit_card"
}
```

### ãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆ

#### 1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«

```sql
CREATE TABLE users (
  id INT PRIMARY KEY AUTO_INCREMENT,
  username VARCHAR(50) UNIQUE NOT NULL,
  email VARCHAR(255) UNIQUE NOT NULL,
  password_hash VARCHAR(255) NOT NULL,
  first_name VARCHAR(100),
  last_name VARCHAR(100),
  is_active BOOLEAN DEFAULT TRUE,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_email (email),
  INDEX idx_username (username)
);
```

#### 2. å•†å“ãƒ†ãƒ¼ãƒ–ãƒ«

```sql
CREATE TABLE products (
  id INT PRIMARY KEY AUTO_INCREMENT,
  name VARCHAR(255) NOT NULL,
  description TEXT,
  price DECIMAL(10,2) NOT NULL,
  stock_quantity INT NOT NULL DEFAULT 0,
  category_id INT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (category_id) REFERENCES categories(id),
  INDEX idx_category (category_id),
  INDEX idx_name (name)
);
```

#### 3. æ³¨æ–‡ãƒ†ãƒ¼ãƒ–ãƒ«

```sql
CREATE TABLE orders (
  id INT PRIMARY KEY AUTO_INCREMENT,
  user_id INT NOT NULL,
  status VARCHAR(20) NOT NULL DEFAULT 'pending',
  total_amount DECIMAL(10,2) NOT NULL,
  shipping_address TEXT NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES users(id),
  INDEX idx_user_id (user_id),
  INDEX idx_status (status),
  INDEX idx_created_at (created_at)
);

CREATE TABLE order_items (
  id INT PRIMARY KEY AUTO_INCREMENT,
  order_id INT NOT NULL,
  product_id INT NOT NULL,
  quantity INT NOT NULL,
  price DECIMAL(10,2) NOT NULL,
  FOREIGN KEY (order_id) REFERENCES orders(id) ON DELETE CASCADE,
  FOREIGN KEY (product_id) REFERENCES products(id),
  INDEX idx_order_id (order_id),
  INDEX idx_product_id (product_id)
);
```

### ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³è¨­è¨ˆ

#### 1. æ³¨æ–‡å‡¦ç†ã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³

```sql
-- æ³¨æ–‡å‡¦ç†
BEGIN TRANSACTION;

-- åœ¨åº«ã‚’ç¢ºèªãƒ»ãƒ­ãƒƒã‚¯
SELECT stock_quantity FROM products WHERE id = 1 FOR UPDATE;

-- åœ¨åº«ãŒååˆ†ã‹ç¢ºèª
-- (ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å´ã§ç¢ºèª)

-- åœ¨åº«ã‚’æ¸›ã‚‰ã™
UPDATE products SET stock_quantity = stock_quantity - 2 WHERE id = 1;

-- æ³¨æ–‡ã‚’ä½œæˆ
INSERT INTO orders (user_id, status, total_amount, shipping_address)
VALUES (1, 'pending', 200.00, '...');

SET @order_id = LAST_INSERT_ID();

-- æ³¨æ–‡æ˜ç´°ã‚’ä½œæˆ
INSERT INTO order_items (order_id, product_id, quantity, price)
VALUES (@order_id, 1, 2, 100.00);

COMMIT;
```

#### 2. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

```javascript
async function createOrder(userId, items, shippingAddress) {
  const connection = await db.getConnection();
  
  try {
    await connection.beginTransaction();
    
    // åœ¨åº«ç¢ºèªã¨ãƒ­ãƒƒã‚¯
    for (const item of items) {
      const [product] = await connection.query(
        'SELECT stock_quantity FROM products WHERE id = ? FOR UPDATE',
        [item.product_id]
      );
      
      if (product.stock_quantity < item.quantity) {
        throw new Error('Insufficient stock');
      }
    }
    
    // åœ¨åº«ã‚’æ¸›ã‚‰ã™
    for (const item of items) {
      await connection.query(
        'UPDATE products SET stock_quantity = stock_quantity - ? WHERE id = ?',
        [item.quantity, item.product_id]
      );
    }
    
    // æ³¨æ–‡ã‚’ä½œæˆ
    const [order] = await connection.query(
      'INSERT INTO orders (user_id, status, total_amount, shipping_address) VALUES (?, ?, ?, ?)',
      [userId, 'pending', calculateTotal(items), shippingAddress]
    );
    
    // æ³¨æ–‡æ˜ç´°ã‚’ä½œæˆ
    for (const item of items) {
      await connection.query(
        'INSERT INTO order_items (order_id, product_id, quantity, price) VALUES (?, ?, ?, ?)',
        [order.insertId, item.product_id, item.quantity, item.price]
      );
    }
    
    await connection.commit();
    return order;
  } catch (error) {
    await connection.rollback();
    throw error;
  } finally {
    connection.release();
  }
}
```

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

#### 1. ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¨­è¨ˆ

```sql
-- ã‚ˆãæ¤œç´¢ã•ã‚Œã‚‹ã‚«ãƒ©ãƒ ã«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_products_category ON products(category_id);
CREATE INDEX idx_orders_user_status ON orders(user_id, status);
CREATE INDEX idx_order_items_order ON order_items(order_id);
```

#### 2. ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°

```javascript
// å•†å“ä¸€è¦§ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥
async function getProducts(categoryId, page, limit) {
  const cacheKey = `products:${categoryId}:${page}:${limit}`;
  
  const cached = await redis.get(cacheKey);
  if (cached) {
    return JSON.parse(cached);
  }
  
  const products = await db.query(`
    SELECT * FROM products
    WHERE category_id = ?
    ORDER BY created_at DESC
    LIMIT ? OFFSET ?
  `, [categoryId, limit, (page - 1) * limit]);
  
  await redis.setex(cacheKey, 3600, JSON.stringify(products));
  return products;
}
```

### ã¾ã¨ã‚

ECã‚µã‚¤ãƒˆã®è¨­è¨ˆä¾‹ï¼š

- **APIè¨­è¨ˆ**: RESTful APIã€é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- **ãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆ**: æ­£è¦åŒ–ã€é©åˆ‡ãªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
- **ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³è¨­è¨ˆ**: ACIDç‰¹æ€§ã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–**: ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã€ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°

ã“ã®è¨­è¨ˆä¾‹ã‚’å‚è€ƒã«ã€å®Ÿéš›ã®ECã‚µã‚¤ãƒˆã‚’æ§‹ç¯‰ã§ãã¾ã™ã€‚

