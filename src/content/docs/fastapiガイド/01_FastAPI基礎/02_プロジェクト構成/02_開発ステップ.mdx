---
title: "é–‹ç™ºã‚¹ãƒ†ãƒƒãƒ—"
label: "é–‹ç™ºã‚¹ãƒ†ãƒƒãƒ—"
---

## é–‹ç™ºã‚¹ãƒ†ãƒƒãƒ—

### 1. é–‹ç™ºç’°å¢ƒã®æº–å‚™ã¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®åˆæœŸè¨­å®š ğŸ› ï¸

ã¾ãšã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã€`requirements.txt` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€ä»¥ä¸‹ã®å†…å®¹ã‚’è¨˜è¿°ã—ã¾ã™ã€‚

```plaintext
fastapi
uvicorn
pydantic
```

æ¬¡ã«ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ã“ã‚Œã‚‰ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```bash
pip install -r requirements.txt
```

### 2. Pydanticãƒ¢ãƒ‡ãƒ«ã®å®šç¾© (Model) ğŸ“

`app/schemas/user.py` ã«ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚„ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ãƒ‡ãƒ¼ã‚¿ã®å‹å®šç¾©ã‚’è¡Œã†Pydanticãƒ¢ãƒ‡ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ‡ãƒ¼ã‚¿ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ãŒè‡ªå‹•çš„ã«è¡Œã‚ã‚Œã¾ã™ã€‚

```python
# app/schemas/user.py

from pydantic import BaseModel

class User(BaseModel):
    id: int
    name: str
    email: str

class UserCreate(BaseModel):
    name: str
    email: str
```

### 3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œãªã©ã®ãƒ­ã‚¸ãƒƒã‚¯ã®å®šç¾© (Model) ğŸ’¾

`app/services/db_service.py` ã«ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œã‚„ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’è¨˜è¿°ã—ã¾ã™ã€‚ã“ã“ã§ã¯ã€ç°¡å˜ãªä¾‹ã¨ã—ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ã®ãƒªã‚¹ãƒˆã‚’ä¿æŒã™ã‚‹ãƒ€ãƒŸãƒ¼ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

```python
# app/services/db_service.py

from typing import List
from app.schemas.user import User, UserCreate

# ãƒ€ãƒŸãƒ¼ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
users_db: List[User] = [
    User(id=1, name="Alice", email="alice@example.com"),
    User(id=2, name="Bob", email="bob@example.com"),
]

def get_users() -> List[User]:
    """ã™ã¹ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å–å¾—ã™ã‚‹"""
    return users_db

def create_user(user_data: UserCreate) -> User:
    """æ–°ã—ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆã™ã‚‹"""
    new_id = max([user.id for user in users_db]) + 1 if users_db else 1
    new_user = User(id=new_id, **user_data.model_dump())
    users_db.append(new_user)
    return new_user
```

### 4. ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®åˆ†å‰²ã¨ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚° ğŸ—ºï¸

APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã”ã¨ã«åˆ†å‰²ã—ã€`APIRouter` ã‚’ä½¿ã£ã¦æ•´ç†ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€`main.py`ã‚’ã‚·ãƒ³ãƒ—ãƒ«ã«ä¿ã¡ã€ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ€§ã‚’å‘ä¸Šã•ã›ã¾ã™ã€‚

#### ãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆã®å¤‰æ›´

```plaintext
.
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ endpoints/
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â””â”€â”€ user.py
â”‚   â””â”€â”€ schemas/
â”‚       â””â”€â”€ user.py
â”‚   â””â”€â”€ services/
â”‚       â””â”€â”€ db_service.py
â””â”€â”€ requirements.txt
```

#### ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®å®šç¾© (user.py)

`app/api/endpoints/user.py` ã«ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼é–¢é€£ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å®šç¾©ã—ã¾ã™ã€‚

```python
# app/api/endpoints/user.py

from fastapi import APIRouter
from typing import List

from app.schemas.user import User, UserCreate
from app.services.db_service import get_users, create_user

router = APIRouter()

@router.get("/", response_model=List[User])
def read_users():
    """å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒªã‚¹ãƒˆã‚’å–å¾—ã™ã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ"""
    return get_users()

@router.post("/", response_model=User, status_code=201)
def create_new_user(user_data: UserCreate):
    """æ–°ã—ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆã™ã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ"""
    return create_user(user_data)
```

### 5. CORSè¨­å®šã¨ãƒ«ãƒ¼ã‚¿ãƒ¼ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ (main.py) ğŸš€

`app/main.py` ã«ã€FastAPIã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã—ã€CORSè¨­å®šã¨ã€å…ˆã»ã©ä½œæˆã—ãŸãƒ«ãƒ¼ã‚¿ãƒ¼ã‚’`app.include_router()`ã§èª­ã¿è¾¼ã¿ã¾ã™ã€‚

```python
# app/main.py

from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
from app.api.endpoints import user

app = FastAPI()

# CORSè¨­å®š
origins = [
    "http://localhost",
    "http://localhost:8000",
    "http://localhost:3000", # ä¾‹: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ãƒãƒ¼ãƒˆ
]

app.add_middleware(
    CORSMiddleware,
    allow_origins=origins,
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# ãƒ«ãƒ¼ã‚¿ãƒ¼ã‚’ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ãƒ‰
# prefix="/users" ã§ã€ã“ã®ãƒ«ãƒ¼ã‚¿ãƒ¼å†…ã®å…¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã« /users ãŒä»˜åŠ ã•ã‚Œã‚‹
app.include_router(user.router, prefix="/users", tags=["users"])
```

`prefix="/users"` ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ã€`user.py` å†…ã®ãƒ‘ã‚¹ã« `/users` ãŒä»˜åŠ ã•ã‚Œã€`http://127.0.0.1:8000/users/` ã¨ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚`tags=["users"]` ã¯ã€Swagger UIã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è‡ªå‹•çš„ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã™ã‚‹ã®ã«å½¹ç«‹ã¡ã¾ã™ã€‚

### 6. ã‚µãƒ¼ãƒãƒ¼ã®å®Ÿè¡Œ ğŸ’»

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã€Uvicornã‚’ä½¿ã£ã¦é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã—ã¾ã™ã€‚

```bash
uvicorn app.main:app --reload
```

`--reload` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«ã‚ˆã‚Šã€ã‚³ãƒ¼ãƒ‰å¤‰æ›´æ™‚ã«ã‚µãƒ¼ãƒãƒ¼ãŒè‡ªå‹•çš„ã«å†èµ·å‹•ã—ã¾ã™ã€‚ã‚µãƒ¼ãƒãƒ¼èµ·å‹•å¾Œã€ãƒ–ãƒ©ã‚¦ã‚¶ã§ `http://127.0.0.1:8000/docs` ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã€APIãŒæ­£ã—ãå‹•ä½œã—ã¦ã„ã‚‹ã‹ç¢ºèªã§ãã¾ã™ã€‚