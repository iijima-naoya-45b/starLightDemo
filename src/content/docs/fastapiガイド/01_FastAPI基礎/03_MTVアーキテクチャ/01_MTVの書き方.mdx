---
title: "MTVã«ã¤ã„ã¦"
label: "MTVã«ã¤ã„ã¦"
---

## FastAPIã«ãŠã‘ã‚‹MTVã®è€ƒãˆæ–¹

FastAPIã¯ã€Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®UIã‚’ã‚µãƒ¼ãƒãƒ¼å´ã§ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹ã®ã§ã¯ãªãã€APIã‚’æä¾›ã™ã‚‹ã“ã¨ã«ç‰¹åŒ–ã—ã¦ã„ã‚‹ãŸã‚ã€MVCï¼ˆModel-View-Controllerï¼‰ã‚ˆã‚Šã‚‚**MTVï¼ˆModel-Template-Viewï¼‰**ã®æ¦‚å¿µã§å½¹å‰²ã‚’æ‰ãˆã‚‹æ–¹ãŒã‚ˆã‚Šé©åˆ‡ã§ã™ã€‚

### ãªãœMTVãƒ‘ã‚¿ãƒ¼ãƒ³ãŒå¿…è¦ãªã®ã‹

#### å•é¡Œã®ã‚ã‚‹ã‚³ãƒ¼ãƒ‰ï¼ˆãƒ‘ã‚¿ãƒ¼ãƒ³ãŒãªã„å ´åˆï¼‰

**å•é¡Œã®ã‚ã‚‹ã‚³ãƒ¼ãƒ‰:**

```python
# å•é¡Œ: ã™ã¹ã¦ã®ãƒ­ã‚¸ãƒƒã‚¯ãŒ1ã¤ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«æ··åœ¨
from fastapi import FastAPI
from sqlalchemy import create_engine, text

app = FastAPI()
engine = create_engine("postgresql://user:pass@localhost/db")

@app.get("/users/{user_id}")
def get_user(user_id: int):
    # HTTPå‡¦ç†
    # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œ
    with engine.connect() as conn:
        result = conn.execute(text(f"SELECT * FROM users WHERE id = {user_id}"))
        user = result.fetchone()
    
    # ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
    if user and user['age'] < 18:
        user['status'] = 'minor'
    else:
        user['status'] = 'adult'
    
    # ãƒ¬ã‚¹ãƒãƒ³ã‚¹ç”Ÿæˆ
    return {"id": user['id'], "name": user['name'], "status": user['status']}

# å•é¡Œç‚¹:
# 1. ãƒ†ã‚¹ãƒˆãŒå›°é›£ï¼ˆHTTPã€DBã€ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ãŒæ··åœ¨ï¼‰
# 2. SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒªã‚¹ã‚¯
# 3. å†åˆ©ç”¨æ€§ãŒä½ã„
# 4. è²¬å‹™ãŒä¸æ˜ç¢º
```

**è§£æ±º: MTVãƒ‘ã‚¿ãƒ¼ãƒ³**

```python
# Model: ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã¨ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
from pydantic import BaseModel
from sqlalchemy.orm import Session

class User(BaseModel):
    id: int
    name: str
    age: int
    
    @property
    def status(self) -> str:
        return 'minor' if self.age < 18 else 'adult'

# View: ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆHTTPå‡¦ç†ï¼‰
@app.get("/users/{user_id}", response_model=User)
def get_user(user_id: int, db: Session = Depends(get_db)):
    user = db.query(UserModel).filter(UserModel.id == user_id).first()
    if not user:
        raise HTTPException(status_code=404, detail="User not found")
    return User.from_orm(user)

# ãƒ¡ãƒªãƒƒãƒˆ:
# 1. å„ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ç‹¬ç«‹ã—ã¦ãƒ†ã‚¹ãƒˆå¯èƒ½
# 2. ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®å†åˆ©ç”¨ãŒå®¹æ˜“
# 3. è²¬å‹™ãŒæ˜ç¢º
# 4. å‹å®‰å…¨æ€§ãŒå‘ä¸Š
```

#### MTV vs MVC vs ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

**MTVãŒé©ã—ã¦ã„ã‚‹å ´åˆ:**

```python
# FastAPIã®æ¨™æº–çš„ãªãƒ‘ã‚¿ãƒ¼ãƒ³
# - APIã‚µãƒ¼ãƒãƒ¼ã¨ã—ã¦æ©Ÿèƒ½
# - ã‚·ãƒ³ãƒ—ãƒ«ãªæ§‹é€ 
# - è¿…é€Ÿãªé–‹ç™º

# æ§‹é€ 
View (Endpoint) â†’ Service â†’ Model (Pydantic/SQLAlchemy)
```

**ãƒ¡ãƒªãƒƒãƒˆ:**
- FastAPIã®æ¨™æº–ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ä¸€è‡´
- ã‚·ãƒ³ãƒ—ãƒ«ã§ç†è§£ã—ã‚„ã™ã„
- é–‹ç™ºé€Ÿåº¦ãŒé€Ÿã„

**ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ:**
- è¤‡é›‘ãªãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã«ã¯ä¸å‘ã
- å¤§è¦æ¨¡ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã¯é™ç•Œ

**ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãŒé©ã—ã¦ã„ã‚‹å ´åˆ:**

```python
# é©ç”¨ç¯„å›²:
# - è¤‡é›‘ãªãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
# - è¤‡æ•°ã®å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ ã¨ã®çµ±åˆ
# - é•·æœŸçš„ãªä¿å®ˆæ€§ã‚’æœ€å„ªå…ˆ

# æ§‹é€ 
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Endpoint (Interface)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      Use Case (Application)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      Domain (Business Logic)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      Repository (Interface)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      Infrastructure (Implementation) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®Ÿè£…ä¾‹:**

```python
# Domainå±¤: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
class User:
    def __init__(self, id: int, name: str, age: int):
        self.id = id
        self.name = name
        self.age = age
    
    def is_minor(self) -> bool:
        return self.age < 18

# Use Caseå±¤: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚¸ãƒƒã‚¯
class GetUserUseCase:
    def __init__(self, repo: UserRepository):
        self.repo = repo
    
    def execute(self, user_id: int) -> User:
        return self.repo.find_by_id(user_id)

# Endpoint: HTTPå‡¦ç†
@app.get("/users/{user_id}")
def get_user(user_id: int, use_case: GetUserUseCase = Depends()):
    user = use_case.execute(user_id)
    return {"id": user.id, "name": user.name}
```

**åˆ¤æ–­åŸºæº–:**

| è¦³ç‚¹ | MTV | ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ |
|------|-----|---------------------|
| **å­¦ç¿’ã‚³ã‚¹ãƒˆ** | ä½ã„ | é«˜ã„ |
| **é–‹ç™ºé€Ÿåº¦** | é«˜ã„ | ä¸­ç¨‹åº¦ |
| **ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®è¡¨ç¾åŠ›** | ä¸­ç¨‹åº¦ | é«˜ã„ |
| **é©ç”¨ç¯„å›²** | å°ã€œä¸­è¦æ¨¡ | å¤§è¦æ¨¡ |
| **FastAPIã¨ã®è¦ªå’Œæ€§** | éå¸¸ã«é«˜ã„ | ä¸­ç¨‹åº¦ |

**å®Ÿè·µçš„ãªé¸æŠæŒ‡é‡:**

```python
# MTVã‚’é¸ã¶ã¹ãå ´åˆ:
# 1. ã‚·ãƒ³ãƒ—ãƒ«ãªCRUDã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
# 2. é–‹ç™ºé€Ÿåº¦ã‚’å„ªå…ˆã™ã‚‹
# 3. å°è¦æ¨¡ã‹ã‚‰ä¸­è¦æ¨¡ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ
# 4. FastAPIã®æ¨™æº–ãƒ‘ã‚¿ãƒ¼ãƒ³ã«å¾“ã„ãŸã„

# ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’é¸ã¶ã¹ãå ´åˆ:
# 1. è¤‡é›‘ãªãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ãŒã‚ã‚‹
# 2. è¤‡æ•°ã®å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ ã¨çµ±åˆã™ã‚‹å¿…è¦ãŒã‚ã‚‹
# 3. é•·æœŸçš„ãªä¿å®ˆæ€§ã‚’æœ€å„ªå…ˆã™ã‚‹
# 4. å¤§è¦æ¨¡ãªã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
```

### MTVã®å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

1. **Modelï¼ˆãƒ¢ãƒ‡ãƒ«ï¼‰** ğŸ’¾
   - ãƒ¢ãƒ‡ãƒ«ã¯ãƒ‡ãƒ¼ã‚¿ã®æ§‹é€ ã¨ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ‰±ã„ã¾ã™ã€‚FastAPIã§ã¯ã€ä»¥ä¸‹ã®ã‚‚ã®ãŒãƒ¢ãƒ‡ãƒ«ã«ç›¸å½“ã—ã¾ã™ã€‚
   - **Pydanticãƒ¢ãƒ‡ãƒ«**: ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã‚„ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ãƒ‡ãƒ¼ã‚¿ã®æ§‹é€ ã‚’å®šç¾©ã—ã€è‡ªå‹•çš„ãªãƒ‡ãƒ¼ã‚¿æ¤œè¨¼ã‚’è¡Œã„ã¾ã™ã€‚
   - **ORMï¼ˆSQLAlchemyãªã©ï¼‰ãƒ¢ãƒ‡ãƒ«**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã¨Pythonã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒãƒƒãƒ”ãƒ³ã‚°ã—ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œã‚’æŠ½è±¡åŒ–ã—ã¾ã™ã€‚

2. **Templateï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼‰** ğŸ–¼ï¸
   - ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯ã€HTMLã‚„UIã‚’æŒ‡ã—ã¾ã™ã€‚FastAPIã¯ä¸»ã«APIã‚µãƒ¼ãƒãƒ¼ã¨ã—ã¦æ©Ÿèƒ½ã™ã‚‹ãŸã‚ã€é€šå¸¸ã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯ä½¿ç”¨ã—ã¾ã›ã‚“ã€‚ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ï¼ˆä¾‹ï¼šReactã€Vue.jsï¼‰ãŒUIã‚’æ§‹ç¯‰ã—ã€FastAPIã®APIã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¾ã™ã€‚ã“ã®ãŸã‚ã€MTVã®è¦³ç‚¹ã§ã¯ã“ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯å­˜åœ¨ã—ãªã„ã‹ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã®è²¬å‹™ã¨ãªã‚Šã¾ã™ã€‚

3. **Viewï¼ˆãƒ“ãƒ¥ãƒ¼ï¼‰** ğŸ–¥ï¸
   - ãƒ“ãƒ¥ãƒ¼ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘å–ã‚Šã€ãƒ¢ãƒ‡ãƒ«ã¨é€£æºã—ã¦ã€æœ€çµ‚çš„ãªãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã™ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ‹…ã„ã¾ã™ã€‚FastAPIã«ãŠã„ã¦ã¯ã€APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆé–¢æ•°ãŒã“ã®ãƒ“ãƒ¥ãƒ¼ã«ç›¸å½“ã—ã¾ã™ã€‚

**ä¸»ãªå½¹å‰²:**

- ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‹ã‚‰ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚„ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¾ã™ã€‚
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚„å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚
- ãƒ‡ãƒ¼ã‚¿ã®æ•´åˆæ€§ã‚’ç¢ºèªã—ã€ã‚¨ãƒ©ãƒ¼ã‚’è¿”ã—ã¾ã™ã€‚
- Pydanticãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ã£ã¦ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å½¢å¼ã‚’å®šç¾©ãƒ»ä¿è¨¼ã—ã¾ã™ã€‚

**ä¾‹: Viewã¨ã—ã¦ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆé–¢æ•°**

```python
from fastapi import FastAPI, Depends, HTTPException
from typing import List

# ä»¥ä¸‹ã¯ãƒ¢ãƒ‡ãƒ«ã¨ã‚µãƒ¼ãƒ“ã‚¹ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹ã¨ä»®å®š
from .schemas import UserResponse
from .services import get_user_from_db

app = FastAPI()

@app.get("/users/{user_id}", response_model=UserResponse)
def get_user_view(user_id: int):
    """
    ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—ã™ã‚‹APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã€‚
    ã“ã®é–¢æ•°ãŒViewã®å½¹å‰²ã‚’æ‹…ã†ã€‚
    """
    user = get_user_from_db(user_id) # ãƒ¢ãƒ‡ãƒ«ã‚„ã‚µãƒ¼ãƒ“ã‚¹ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
    if not user:
        raise HTTPException(status_code=404, detail="User not found")
    return user
```


ã“ã®ä¾‹ã§ã¯ã€`get_user_view`é–¢æ•°ãŒãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’å—ã‘å–ã‚Šã€ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä»‹ã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã™ä¸€é€£ã®å‡¦ç†ã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚

**ä¾‹: FastAPI ã§ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’èª­ã¿è¾¼ã‚€ä¾‹**
```py
from fastapi import FastAPI, Request
from fastapi.templating import Jinja2Templates
from fastapi.responses import HTMLResponse

app = FastAPI()

# templatesãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æŒ‡å®š
templates = Jinja2Templates(directory="app/templates")

@app.get("/", response_class=HTMLResponse)
def read_root(request: Request):
    # index.html ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
    return templates.TemplateResponse("index.html", {"request": request, "title": "Home"})

```
## ğŸ“¦ MTVã«åŸºã¥ã„ãŸãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

MTVã®è€ƒãˆæ–¹ã§æ•´ç†ã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã«ãªã‚Šã¾ã™ã€‚

```
.
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py             # View (ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ)
â”‚   â”œâ”€â”€ schemas/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ user.py         # Model (Pydanticãƒ¢ãƒ‡ãƒ«)
â”‚   â””â”€â”€ services/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ db_service.py   # Model (ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œãªã©ã®ãƒ­ã‚¸ãƒƒã‚¯)
â”‚       â””â”€â”€ templates/      # Template(apiã§ã¯ä½¿ç”¨ã—ãªã„)
â”‚        â”œâ”€â”€ index.html
â”‚        â””â”€â”€ user.html
â””â”€â”€ requirements.txt
```

ã“ã®ã‚ˆã†ã«ã€Viewã‚’æ‹…ã†ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆé–¢æ•°ã€Modelã‚’æ‹…ã†Pydanticãƒ¢ãƒ‡ãƒ«ã‚„ã‚µãƒ¼ãƒ“ã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ˜ç¢ºã«åˆ†ã‘ã‚‹ã“ã¨ã§ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®æ§‹é€ ã‚’ã‚ˆã‚Šã‚·ãƒ³ãƒ—ãƒ«ã«ä¿ã¤ã“ã¨ãŒã§ãã¾ã™ã€‚

### 4. ã‚µãƒ¼ãƒ“ã‚¹ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å°å…¥ ğŸ› ï¸

MTVãƒ¢ãƒ‡ãƒ«ã‚’ã•ã‚‰ã«æ´—ç·´ã•ã›ã‚‹ãŸã‚ã«ã€ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’ãƒ“ãƒ¥ãƒ¼ï¼ˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼‰ã‹ã‚‰å®Œå…¨ã«åˆ†é›¢ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’å°å…¥ã™ã‚‹ã“ã¨ãŒæ¨å¥¨ã•ã‚Œã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã‚³ãƒ¼ãƒ‰ã®å†åˆ©ç”¨æ€§ãŒé«˜ã¾ã‚Šã€ãƒ†ã‚¹ãƒˆãŒå®¹æ˜“ã«ãªã‚Šã¾ã™ã€‚

**å½¹å‰²:** ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œã€å¤–éƒ¨APIå‘¼ã³å‡ºã—ã€è¤‡é›‘ãªè¨ˆç®—ãªã©ã€ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆé–¢æ•°ãŒç›´æ¥è¡Œã†ã¹ãã§ã¯ãªã„å‡¦ç†ã‚’æ‹…ã„ã¾ã™ã€‚

**ãƒ¡ãƒªãƒƒãƒˆ:**

- **è²¬å‹™ã®åˆ†é›¢**: ãƒ“ãƒ¥ãƒ¼é–¢æ•°ã¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å‡¦ç†ã«é›†ä¸­ã—ã€ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã¯ã‚µãƒ¼ãƒ“ã‚¹ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ä¸€ä»»ã•ã‚Œã¾ã™ã€‚
- **å†åˆ©ç”¨æ€§**: åŒã˜ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’è¤‡æ•°ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚„ã‚¿ã‚¹ã‚¯ï¼ˆä¾‹ï¼šãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¸ãƒ§ãƒ–ï¼‰ã§å…±æœ‰ã§ãã¾ã™ã€‚
- **ãƒ†ã‚¹ãƒˆã®å®¹æ˜“æ€§**: ã‚µãƒ¼ãƒ“ã‚¹ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®é–¢æ•°ã¯å˜ç‹¬ã§ãƒ†ã‚¹ãƒˆã§ãã‚‹ãŸã‚ã€å˜ä½“ãƒ†ã‚¹ãƒˆã®ä½œæˆãŒç°¡å˜ã«ãªã‚Šã¾ã™ã€‚

**ä¾‹: ã‚µãƒ¼ãƒ“ã‚¹ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å°å…¥**

`app/services/user_service.py`

```python
from sqlalchemy.orm import Session
from .. import models, schemas

def create_user_service(db: Session, user_data: schemas.UserCreate):
    """
    ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆã®ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
    """
    # ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ—¢ã«å­˜åœ¨ã™ã‚‹ã‹ç¢ºèª
    existing_user = db.query(models.User).filter_by(email=user_data.email).first()
    if existing_user:
        return None # ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ—¢ã«å­˜åœ¨ã™ã‚‹å ´åˆã¯Noneã‚’è¿”ã™
    
    # æ–°ã—ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆã—ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜
    db_user = models.User(email=user_data.email, name=user_data.name)
    db.add(db_user)
    db.commit()
    db.refresh(db_user)
    return db_user
```

ã“ã®`create_user_service`é–¢æ•°ã¯ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’å—ã‘å–ã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆã«é–¢é€£ã™ã‚‹ã™ã¹ã¦ã®ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆæ¤œè¨¼ã€ä¿å­˜ãªã©ï¼‰ã‚’å‡¦ç†ã—ã¾ã™ã€‚

### 5. ä¾å­˜æ€§æ³¨å…¥ã®æ´»ç”¨ï¼ˆãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ï¼‰ ğŸ’‰

ã‚µãƒ¼ãƒ“ã‚¹ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’å°å…¥ã™ã‚‹éš›ã€FastAPIã®ä¾å­˜æ€§æ³¨å…¥ã‚’ç©æ¥µçš„ã«æ´»ç”¨ã™ã‚‹ã“ã¨ã§ã€ãƒ“ãƒ¥ãƒ¼ã¨ã‚µãƒ¼ãƒ“ã‚¹ã®é€£æºãŒéå¸¸ã«ã‚¹ãƒ ãƒ¼ã‚ºã«ãªã‚Šã¾ã™ã€‚

**å½¹å‰²:** ãƒ“ãƒ¥ãƒ¼é–¢æ•°ãŒã‚µãƒ¼ãƒ“ã‚¹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚„ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ç›´æ¥ä½œæˆã™ã‚‹ã®ã§ã¯ãªãã€ä¾å­˜æ€§æ³¨å…¥ã‚’é€šã˜ã¦ãã‚Œã‚‰ã‚’å—ã‘å–ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

**ãƒ¡ãƒªãƒƒãƒˆ:**

- **ç–çµåˆ**: ãƒ“ãƒ¥ãƒ¼ã¯å…·ä½“çš„ãªã‚µãƒ¼ãƒ“ã‚¹ã®å®Ÿè£…ã«ä¾å­˜ã›ãšã€å¿…è¦ãªæ©Ÿèƒ½ã ã‘ã‚’è¦æ±‚ã§ãã¾ã™ã€‚
- **ãƒ†ã‚¹ãƒˆã®ãƒ¢ãƒƒã‚¯åŒ–**: ãƒ†ã‚¹ãƒˆæ™‚ã«æœ¬ç‰©ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã§ã¯ãªãã€ãƒ¢ãƒƒã‚¯ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚„ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ç°¡å˜ã«æ³¨å…¥ã§ãã¾ã™ã€‚

**ä¾‹: ã‚µãƒ¼ãƒ“ã‚¹ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ä¾å­˜æ€§æ³¨å…¥ã®çµ±åˆ**

`app/api/v1/endpoints/users.py`ï¼ˆãƒ“ãƒ¥ãƒ¼ã®å†æ§‹ç¯‰ï¼‰

```python
from fastapi import APIRouter, Depends, HTTPException
from sqlalchemy.orm import Session
from ...services import user_service
from ...database import get_db
from ...schemas import UserResponse, UserCreate

router = APIRouter()

@router.post("/users/", response_model=UserResponse, status_code=201)
def create_new_user(user_data: UserCreate, db: Session = Depends(get_db)):
    """
    æ–°ã—ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆ
    """
    # ä¾å­˜æ€§æ³¨å…¥ã‚’é€šã˜ã¦ã‚µãƒ¼ãƒ“ã‚¹é–¢æ•°ã‚’å‘¼ã³å‡ºã™
    created_user = user_service.create_user_service(db, user_data)
    if created_user is None:
        raise HTTPException(status_code=400, detail="Email already registered")
    
    return created_user
```

ã“ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ã€`create_new_user`é–¢æ•°ã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’`Depends`ã§å—ã‘å–ã‚Šã€ãã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’`user_service`ã«æ¸¡ã™ã ã‘ã§ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯ç´”ç²‹ãªã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã¨ã—ã¦ã®å½¹å‰²ã«é›†ä¸­ã§ãã¾ã™ã€‚

### MTVã®ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³

#### ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³1: Fat Viewï¼ˆå¤ªã£ãŸãƒ“ãƒ¥ãƒ¼ï¼‰

**å•é¡Œã®ã‚ã‚‹ã‚³ãƒ¼ãƒ‰:**

```python
# å•é¡Œ: ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ãŒé›†ä¸­
@app.post("/users/")
def create_user(user_data: UserCreate, db: Session = Depends(get_db)):
    # å•é¡Œ: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ãŒã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«ã‚ã‚‹
    if db.query(User).filter(User.email == user_data.email).first():
        raise HTTPException(status_code=400, detail="Email already exists")
    
    # å•é¡Œ: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ãŒã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«ã‚ã‚‹
    hashed_password = bcrypt.hashpw(user_data.password.encode(), bcrypt.gensalt())
    
    # å•é¡Œ: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œãŒã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«ã‚ã‚‹
    db_user = User(email=user_data.email, password=hashed_password)
    db.add(db_user)
    db.commit()
    db.refresh(db_user)
    
    # å•é¡Œ: ãƒ¡ãƒ¼ãƒ«é€ä¿¡ãƒ­ã‚¸ãƒƒã‚¯ãŒã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«ã‚ã‚‹
    send_welcome_email(db_user.email)
    
    return db_user

# è§£æ±º: ã‚µãƒ¼ãƒ“ã‚¹ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’ç§»å‹•
class UserService:
    def __init__(self, db: Session):
        self.db = db
    
    def create_user(self, user_data: UserCreate) -> User:
        # ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
        if self.db.query(User).filter(User.email == user_data.email).first():
            raise ValueError("Email already exists")
        
        # ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
        hashed_password = bcrypt.hashpw(user_data.password.encode(), bcrypt.gensalt())
        
        # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œ
        db_user = User(email=user_data.email, password=hashed_password)
        self.db.add(db_user)
        self.db.commit()
        self.db.refresh(db_user)
        
        # å‰¯ä½œç”¨ï¼ˆãƒ¡ãƒ¼ãƒ«é€ä¿¡ï¼‰
        send_welcome_email(db_user.email)
        
        return db_user

# ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯ã‚·ãƒ³ãƒ—ãƒ«ã«
@app.post("/users/")
def create_user(user_data: UserCreate, db: Session = Depends(get_db)):
    service = UserService(db)
    try:
        user = service.create_user(user_data)
        return user
    except ValueError as e:
        raise HTTPException(status_code=400, detail=str(e))
```

#### ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³2: Modelã«Viewãƒ­ã‚¸ãƒƒã‚¯ãŒæ··åœ¨

**å•é¡Œã®ã‚ã‚‹ã‚³ãƒ¼ãƒ‰:**

```python
# å•é¡Œ: Pydanticãƒ¢ãƒ‡ãƒ«ã«ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ãŒå«ã¾ã‚Œã¦ã„ã‚‹
class User(BaseModel):
    id: int
    name: str
    email: str
    
    def send_email(self, subject: str, body: str):
        # å•é¡Œ: Viewãƒ­ã‚¸ãƒƒã‚¯ãŒModelã«ã‚ã‚‹
        send_email(self.email, subject, body)
    
    def format_for_display(self):
        # å•é¡Œ: ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒ­ã‚¸ãƒƒã‚¯ãŒModelã«ã‚ã‚‹
        return f"{self.name} ({self.email})"

# è§£æ±º: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã¯Serviceå±¤ã«ã€ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¯Viewå±¤ã«
class User(BaseModel):
    id: int
    name: str
    email: str

class UserService:
    def send_welcome_email(self, user: User):
        send_email(user.email, "Welcome", "Welcome to our service!")

# Viewå±¤ã§ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
@app.get("/users/{user_id}")
def get_user(user_id: int, db: Session = Depends(get_db)):
    user = db.query(UserModel).filter(UserModel.id == user_id).first()
    return {
        "id": user.id,
        "display_name": f"{user.name} ({user.email})"  # Viewå±¤ã§ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
    }
```

### ã¾ã¨ã‚

FastAPIã«ãŠã‘ã‚‹MTVãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ã€APIé–‹ç™ºã«ãŠã„ã¦æ˜ç¢ºãªè²¬å‹™åˆ†é›¢ã‚’å®Ÿç¾ã™ã‚‹é‡è¦ãªè¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã™ã€‚

**ã‚·ãƒ‹ã‚¢ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã¨ã—ã¦è€ƒæ…®ã™ã¹ãç‚¹:**

1. **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¦æ¨¡ã«å¿œã˜ãŸé¸æŠ**: å°è¦æ¨¡ãªã‚‰MTVã€å¤§è¦æ¨¡ãªã‚‰ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
2. **è²¬å‹™ã®æ˜ç¢ºåŒ–**: å„ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®è²¬å‹™ã‚’æ˜ç¢ºã«ã—ã€æ··åœ¨ã‚’é¿ã‘ã‚‹
3. **ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§**: å„ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ç‹¬ç«‹ã—ã¦ãƒ†ã‚¹ãƒˆã§ãã‚‹ã‚ˆã†ã«è¨­è¨ˆ
4. **æ®µéšçš„ãªæ”¹å–„**: æ—¢å­˜ã®ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã«æ®µéšçš„ã«ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’é©ç”¨