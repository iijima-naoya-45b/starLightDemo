---
title: "FastAPIのセキュリティ強化"
label: "FastAPIのセキュリティ強化"
---

## FastAPIのセキュリティ強化

FastAPIは、デフォルトで高いセキュリティを提供しますが、より堅牢なAPIを構築するためには、追加のセキュリティ対策を実装することが重要です。

### 1. 認証と認可 🔑

FastAPIは、OAuth2やJWT（JSON Web Tokens）などの認証スキームを`Depends`機能と組み合わせて簡単に実装できます。これにより、APIエンドポイントへのアクセスを保護できます。

- **OAuth2**: トークンベースの認証プロトコルで、パスワードを直接送ることなくユーザーを認証します。FastAPIの`OAuth2PasswordBearer`クラスは、これを利用するためのものです。
- **JWT**: サーバーがユーザーの情報を安全に符号化してトークンとして発行し、クライアントはこのトークンを使って認証されたリクエストを送ります。

### 2. CORS（オリジン間リソース共有） 🌐

CORSは、異なるドメインからAPIへのアクセスを制御する仕組みです。これにより、悪意のあるWebサイトがあなたのAPIを悪用するのを防ぎます。FastAPIの**CORSMiddleware**を使って、許可するオリジン、メソッド、ヘッダーを柔軟に設定できます。

```python
from fastapi.middleware.cors import CORSMiddleware

app.add_middleware(
    CORSMiddleware,
    allow_origins=["https://your-frontend.com"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

### 3. セキュリティヘッダーの適用 🛡️

Webブラウザにセキュリティを強化するよう指示するHTTPヘッダーを追加することで、XSSやクリックジャッキングといった一般的なWeb攻撃を防げます。

- **X-Content-Type-Options**: ブラウザがMIMEタイプを推測するのを防ぎます。
- **X-Frame-Options**: サイトが`<iframe>`に埋め込まれるのを制御し、クリックジャッキング攻撃を阻止します。
- **Content-Security-Policy (CSP)**: どのドメインからリソースをロードできるかを指定し、XSS攻撃を軽減します。

これらはFastAPIのミドルウェアとして追加できます。

### 4. 入力データの検証とサニタイズ 🧹

悪意のある入力を防ぐため、ユーザーから受け取るデータは常に検証する必要があります。FastAPIのPydanticモデルは、型ヒントに基づいてデータの形式や構造を自動的に検証するため、このプロセスを大幅に簡素化します。

- **Pydantic**: 必須フィールドやデータ型が正しいかを確認します。
- **ORM**: SQLインジェクションを防ぐため、SQLAlchemyなどのORMを使用し、プリペアドステートメントやパラメーター化されたクエリを利用します。

### 5. レートリミット ⏱️

レートリミットは、一定期間内のリクエスト数を制限することで、ブルートフォース攻撃やDoS（サービス拒否）攻撃からAPIを保護します。FastAPI自体にはこの機能は含まれていませんが、**fastapi-limiter**のようなサードパーティライブラリや、Redisなどのキャッシュシステムと組み合わせることで簡単に実装できます。